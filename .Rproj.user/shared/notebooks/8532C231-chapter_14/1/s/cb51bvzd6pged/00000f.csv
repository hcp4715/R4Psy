"0","permutation_test <- function(data, n = 1000) {"
"0","      # 计算原始均值差"
"0","      original_diff <- data %>%"
"0","            dplyr::group_by(Valence) %>%"
"0","            dplyr::summarise("
"0","                  Mean = mean(RT),"
"0","                  SD = sd(RT),"
"0","                  N = n()) %>%"
"0","            dplyr::ungroup() %>%"
"0","            dplyr::summarise(diff = Mean[1] - Mean[2]) %>%"
"0","            dplyr::pull(diff)"
"0","      "
"0","      # 初始化一个向量来存储每次置换的均值差"
"0","      permuted_diffs <- numeric(n)"
"0","      "
"0","      # 进行n次置换"
"0","      for (i in 1:n) {"
"0","            permuted_data <- data %>%"
"0","                  dplyr::mutate(RT = sample(RT)) # permutate RT"
"0","            permuted_diff <- permuted_data %>%"
"0","                  dplyr::group_by(Valence) %>%"
"0","                  dplyr::summarise("
"0","                        Mean = mean(RT),"
"0","                        SD = sd(RT),"
"0","                        N = n()) %>%"
"0","                  dplyr::ungroup() %>%"
"0","                  dplyr::summarise(diff = Mean[1] - Mean[2]) %>%"
"0","                  dplyr::pull(diff)"
"0","            "
"0","            # 存储每次置换的均值差"
"0","            permuted_diffs[i] <- permuted_diff"
"0","      }"
"0","      "
"0","      # 返回原始均值差和置换后的均值差"
"0","      return(list(original_diff = original_diff, permuted_diffs = permuted_diffs))"
"0","}"
"0",""
"0","data <- df7305 %>% "
"0","      dplyr::filter(Identity == ""Self"") %>%"
"0","      dplyr::mutate(RT = RT * 1000)"
"0","      "
"0","perRes <- permutation_test(data = data, n = 5000)"
"0",""
"0","# 画出置换后的均值差的分布"
"0",""
"0","ggplot(data.frame(perRes$permuted_diffs), aes(x = perRes.permuted_diffs)) +"
"0","      geom_histogram(aes(y = after_stat(density)), "
"0","                     binwidth = 10, "
"0","                     # position = 'Valence', "
"0","                     alpha = 0.5) +"
"0","      geom_density(aes(y = after_stat(density)),"
"0","                   size = 1,"
"0","                   alpha = 0.2) +"
"0","      # add means as two vertical lines:"
"0","      geom_vline(aes(xintercept = perRes$original_diff),"
"0","                 linetype = 'dashed', size = 1) +"
"0","      ggplot2::scale_y_continuous(expand=c(0, 0)) +"
"0","      labs(title = 'RT Distribution of Moral vs Immoral Self',"
"0","           x = 'RT (s)', y = 'Density') +"
"0","      papaja::theme_apa()"

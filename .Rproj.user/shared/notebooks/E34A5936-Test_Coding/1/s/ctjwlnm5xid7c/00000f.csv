"0","library(dplyr)"
"0","library(tidyr)"
"0",""
"0","# Step 1-4: 计算每个 Sub × Shape 条件下的 d′ 值"
"0","df_dprime <- df3 %>%"
"0","  dplyr::filter(!is.na(ACC), !is.na(Match)) %>%"
"0","  dplyr::group_by(Sub, Shape) %>%"
"0","  dplyr::summarise("
"0","    hit  = sum(Match == ""match"" & ACC == 1),"
"0","    cr   = sum(Match == ""mismatch"" & ACC == 0),"
"0","    miss = sum(Match == ""match"" & ACC == 0),"
"0","    fa   = sum(Match == ""mismatch"" & ACC == 1),"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  dplyr::mutate("
"0","    # 击中率、虚报率"
"0","    hit_rate = ifelse((hit + miss) > 0,"
"0","                      ifelse(hit / (hit + miss) < 1, hit / (hit + miss), 1 - 1 / (2 * (hit + miss))),"
"0","                      NA),"
"0","    fa_rate = ifelse((fa + cr) > 0,"
"0","                     ifelse(fa / (fa + cr) > 0, fa / (fa + cr), 1 / (2 * (fa + cr))),"
"0","                     NA),"
"0","    # 计算 d' 值"
"0","    dprime = qnorm(hit_rate) - qnorm(fa_rate)"
"0","  ) %>%"
"0","  dplyr::select(Sub, Shape, dprime)"
"0",""
"0","# Step 5: 长转宽，每个 shape 一个列"
"0","df_dprime_wide <- df_dprime %>%"
"0","  tidyr::pivot_wider(names_from = Shape, values_from = dprime, names_prefix = ""d_"")"
"0",""
"0","# 查看结果"
"0","head(df_dprime_wide)"

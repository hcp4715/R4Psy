---
title: ""
author: ""
date: ""
output:
  xaringan::moon_reader:
    css: [default, css/zh-CN.css, css/Custumed_Style.css]
    lib_dir: libs
    nature:
      highlightLines: true
      highlightStyle: github
      countIncrementalSlides: false
      seal: true
      ratio: 16:9
params:
  output_dir: "../output"
---

class: center, middle
<span style="font-size: 50px;">**ç¬¬åç« **</span> <br>
<span style="font-size: 50px;">å›å½’æ¨¡å‹(ä¸‰)ï¼šå¹¿ä¹‰çº¿æ€§æ¨¡å‹</span> <br>
<span style="font-size: 30px;">èƒ¡ä¼ é¹</span> <br>
<span style="font-size: 20px;"> </span> <br>
<span style="font-size: 30px;">`r Sys.Date()`</span> <br>
<span style="font-size: 20px;"> Made with Rmarkdown</span> <br>

---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  fig.align = 'center',
  fig.height=6, fig.width=7.5,
  fig.retina=2
)
```

```{css extra.css, echo=FALSE}
.bigfont {
  font-size: 30px;
}
.size5{
font-size: 24px;
}
.tit_font{
font-size: 60px;
}

```

```{r, echo = FALSE}
## å‡†å¤‡å·¥ä½œ
# Packages
if (!requireNamespace('pacman', quietly = TRUE)) {
    install.packages('pacman')
}

pacman::p_load(
  # æœ¬èŠ‚è¯¾éœ€è¦ç”¨åˆ°çš„ packages
  here, tidyverse, ggplot2,
  # ANOVA & HLM
  bruceR, lmerTest, lme4, broom, afex, interactions, easystats, caret, 
  # ç”Ÿæˆè¯¾ä»¶
  xaringan, xaringanthemer, xaringanExtra, knitr)

options(scipen=99999,digits = 5)
```

```{r, echo = FALSE}
#è¯»å–æ•°æ®
df.match <- bruceR::import(here::here('data','match','match_raw.csv')) %>% 
  tidyr::extract(Shape, 
                 into = c('Valence', 'Identity'),
                 regex = '(moral|immoral)(Self|Other)',
                 remove = FALSE) %>% #å°†Shapeåˆ—åˆ†ä¸ºä¸¤åˆ—
  dplyr::mutate(Valence = factor(Valence, levels = c('moral','immoral'), labels = c('moral','immoral')),
                Identity = factor(Identity, levels = c('Self','Other'), labels = c('Self','Other'))) %>%
  dplyr::filter(ACC == 0 | ACC == 1, 
                RT >= 0.2 & RT <= 1.5,
                Match == 'match',
                (!Sub %in% c(7302,7303,7338))
                )#ç­›é€‰
```

```{r, echo = FALSE}
df.match.aov <- df.match %>%
  dplyr::group_by(Sub, Valence, Identity) %>%
  dplyr::summarise(mean_ACC = mean(ACC)) %>%
  dplyr::ungroup()
```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

# è¡¥å……å†…å®¹: easystatsç³»ç»ŸåŒ…çš„ç®€ä»‹
```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('./picture/chp10/bilibili.png')
```

<br>
<br>
<center>
https://www.bilibili.com/video/BV1rz421D7iJ/?spm_id_from=333.337.search-card.all.click
</center>
---
class: center, middle
.tit_font[
å½“å› å˜é‡ä¸æœä»æ­£æ€åˆ†å¸ƒ(å¦‚æ­£ç¡®ç‡)æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ
]
---
.panelset[
.panel[.panel-name[df.match]
```{r}
head(df.match[c(3,11:17)],5) %>% DT::datatable()
```

.panel[.panel-name[df.match.aov]
```{r}
df.match.aov %>%
  dplyr::select(1:4) %>%
  head(5) %>% 
  DT::datatable()
```

]]]
---
.tit_font[  Contents</h1>]
<br>
<br>
.bigfont[
    10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹<br>
<br>
    10.2 äºŒé¡¹åˆ†å¸ƒ<br>
<br>
    10.3 å…¶ä»–åˆ†å¸ƒ<br>
<br>
    10.4 ä»£ç å®æ“<br>
<br>
    10.5 æ–¹æ³•æ¯”è¾ƒ<br>
]
---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
##å¤šå…ƒçº¿æ€§å›å½’ï¼ˆMultiple Linear Regressionï¼‰
<br>
.normal[
$$Y = b_0 + b_{1}X_{1} + b_{2}X_{2} +... + b_{p}X_{p} + \epsilon$$
- $Y$ : å› å˜é‡ï¼ŒDependent variable
- $X_i$ : è‡ªå˜é‡ï¼ŒIndependent (explanatory) variable
- $b_0$ : æˆªè·ï¼ŒIntercept
- $b_i$ : æ–œç‡ï¼ŒSlope
- $\epsilon$ : æ®‹å·®ï¼ŒResidual (error)
]
---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
##çº¿æ€§æ¨¡å‹çš„ç»„æˆéƒ¨åˆ†
![](./picture/chp10/formula.png)
---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
##çº¿æ€§æ¨¡å‹çš„ç»„æˆéƒ¨åˆ†
```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('./picture/chp10/plot.png')
```

---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
##å›å½’æ–¹ç¨‹çš„å¤šç§å½¢å¼<br>
.bigfont[
- ç®€å•çº¿æ€§å›å½’ï¼š
$$Y = b_0+b_1 X_1+ b_2 X_2+â€¦+b_p X_p + \epsilon$$ 
- çº¿æ€§ä»£æ•°è¡¨è¾¾ï¼š
$$y_i = b_0 + b_1 X_{i1} + b_2 X_{i2} + â€¦ + b_p X_{ip} + \epsilon$$ 
- çŸ©é˜µè¡¨è¾¾ï¼š
$$Y= X\beta + \epsilon$$
- ä»£ç è¡¨è¾¾(r)ï¼š
$$Y \sim X_1 + X_2 + ... + X_n$$
]
---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
##å›å½’æ–¹ç¨‹çš„å¤šç§è¡¨è¾¾å½¢å¼<br>
<br>
.bigfont[
- å›å½’æ¨¡å‹å½¢å¼ï¼šè§‚æµ‹é¡¹ = é¢„æµ‹é¡¹ + è¯¯å·®é¡¹ <br>
- å‡å®šè§‚æµ‹é¡¹æ˜¯æ­£æ€åˆ†å¸ƒï¼Œä¸Šè¿°å…¬å¼å¯ä»¥é‡æ–°è¡¨è¾¾ä¸ºï¼š <br>
$$y \sim N(\mu, \epsilon)$$ 
  - å…¶ä¸­ï¼Œ$\mu$ä¸ºé¢„æµ‹å€¼ï¼Œå³
  $$Î¼ = \beta_0 + \beta_1 x$$
- è§‚æµ‹å€¼æœä»ä»¥é¢„æµ‹é¡¹ä¸ºå‡å€¼çš„**æ­£æ€åˆ†å¸ƒ**ï¼Œè§‚æµ‹å€¼ä¸é¢„æµ‹å€¼ä¹‹é—´çš„å·®å€¼å°±æ˜¯æ®‹å·®ã€‚<br>
]
--

.bigfont[
å¦‚æœå› å˜é‡ä¸æœä»æ­£æ€åˆ†å¸ƒï¼Œå¦‚ä½•æ„å»ºå›å½’æ¨¡å‹ï¼Ÿ
]
---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)

![](./picture/chp10/function1.png)
---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
![](./picture/chp10/function.png)

---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
![](./picture/chp10/function2.png)

---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
##Generalized Linear Model, GLM
###åœ¨ç®€å•çº¿æ€§å›å½’ä¸­ï¼Œé¢„æµ‹é¡¹çš„è¿æ¥å‡½æ•°ç­‰äºå®ƒæœ¬èº«
![](./picture/chp10/lm.png)
---
#10.1 å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)
.bigfont[
- ç®€å•çº¿æ€§æ¨¡å‹å¯è§†ä¸ºGLMçš„ç‰¹æ®Šå½¢å¼ï¼Œé¢„æµ‹é¡¹çš„è¿æ¥å‡½æ•°ç­‰äºå®ƒæœ¬èº«ï¼Œè§‚æµ‹é¡¹ä¸ºæ­£æ€åˆ†å¸ƒã€‚
- åœ¨å¹¿ä¹‰çº¿æ€§æ¨¡å‹ä¸­ï¼š
  - è§‚æµ‹é¡¹ä¸ä¸€å®šæ˜¯æ­£æ€åˆ†å¸ƒï¼ˆæ®‹å·®ä¸ä¸€å®šæ˜¯æ­£æ€åˆ†å¸ƒï¼‰
  - è¿æ¥å‡½æ•°ä¸ç­‰äºå…¶è‡ªèº«

- å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œèƒ½å¤Ÿå¯¹éæ­£æ€åˆ†å¸ƒçš„å› å˜é‡è¿›è¡Œå»ºæ¨¡
]
---
#10.2 äºŒé¡¹åˆ†å¸ƒ(Binomial Distribution)
##ä¼¯åŠªåˆ©è¯•éªŒ
<br>
.bigfont[
- åŒæ ·çš„æ¡ä»¶ä¸‹é‡å¤åœ°ã€ç›¸äº’ç‹¬ç«‹åœ°è¿›è¡Œçš„ä¸€ç§éšæœºè¯•éªŒã€‚
<br>
<br>
- è¯¥éšæœºè¯•éªŒåªæœ‰ä¸¤ç§å¯èƒ½ç»“æœï¼šå‘ç”Ÿæˆ–è€…ä¸å‘ç”Ÿã€‚
<br>
<br>
- å‡è®¾è¯¥é¡¹è¯•éªŒç‹¬ç«‹é‡å¤åœ°è¿›è¡Œäº†næ¬¡ï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸€ç³»åˆ—é‡å¤ç‹¬ç«‹çš„éšæœºè¯•éªŒä¸ºné‡ä¼¯åŠªåˆ©è¯•éªŒ(n-fold bernoulli trials)ã€‚
<br>
<br>
- næ¬¡ç‹¬ç«‹é‡å¤çš„ä¼¯åŠªåˆ©è¯•éªŒçš„æ¦‚ç‡åˆ†å¸ƒæœä»äºŒé¡¹åˆ†å¸ƒ
]
---
#10.2 äºŒé¡¹åˆ†å¸ƒ(Binomial Distribution)
.bigfont[
- æ¯æ¬¡è¯•éªŒä¸­äº‹ä»¶Aå‘ç”Ÿçš„æ¦‚ç‡ä¸ºp
<br><br>
- Xè¡¨ç¤ºné‡ä¼¯åŠªåˆ©è¯•éªŒä¸­äº‹ä»¶Aå‘ç”Ÿçš„æ¬¡æ•°ï¼ŒXçš„å¯èƒ½å–å€¼ä¸º0ï¼Œ1ï¼Œâ€¦ï¼Œn
<br><br>
- å¯¹æ¯ä¸€ä¸ªkï¼ˆ0 â‰¤ k â‰¤ nï¼‰,äº‹ä»¶{X = k} æŒ‡â€næ¬¡è¯•éªŒä¸­äº‹ä»¶Aæ°å¥½å‘ç”Ÿkæ¬¡â€
<br><br>
- éšæœºå˜é‡Xæœä»ä»¥n, pä¸ºå‚æ•°çš„äºŒé¡¹åˆ†å¸ƒï¼Œå†™ä½œ $X \sim B(n, p)$ 
<br><br>
- $p \in [0,1]$, $n \in N$ 

$$P(X=k )=ğ¶_ğ‘›^ğ‘˜ ğ‘^ğ‘˜ ğ‘^{ğ‘›âˆ’ğ‘˜}= ğ¶_ğ‘›^ğ‘˜ ğ‘^ğ‘˜ (1âˆ’ğ‘)^{ğ‘›âˆ’ğ‘˜}$$
$$ğ¶_ğ‘›^ğ‘˜= ğ‘›!/ğ‘˜!(ğ‘›âˆ’ğ‘˜)! $$
]
---
#10.2 äºŒé¡¹åˆ†å¸ƒ(Binomial Distribution)
##æŠ›ç¡¬å¸
```{r, echo=FALSE}
simulate_coin_toss <- function(prob_head, num_people, num_tosses) {
  # åˆå§‹åŒ–ä¸€ä¸ªå‘é‡æ¥å­˜å‚¨æ¯ä¸ªäººæ­£é¢æœä¸Šçš„æ€»æ¬¡æ•°
  total_heads <- rep(0, num_people)
  # æ¨¡æ‹Ÿæ¯ä¸ªäººæŠ›ç¡¬å¸çš„æ¬¡æ•°ï¼Œå¹¶è®¡ç®—æ­£é¢æœä¸Šçš„æ€»æ¬¡æ•°
  for (i in 1:num_people) {
    tosses <- rbinom(num_tosses, size = 1, prob = prob_head)
    total_heads[i] <- sum(tosses)
  }
  
  # ç»˜åˆ¶ç›´æ–¹å›¾
  hist(total_heads, main = "Coin Toss Results for All People", xlab = "ç¡¬å¸æ­£é¢æœä¸Šçš„æ¬¡æ•°", ylab = "äººæ•°", col = 'white', border = 'black', breaks = seq(min(total_heads), max(total_heads) + 1, by = 1), xlim = c(0,max(total_heads) + 1))
  
  # è¿”å›æ¯ä¸ªäººæ­£é¢æœä¸Šçš„æ€»æ¬¡æ•°
}
```

.panelset[
.panel[.panel-name[5äººï¼Œæ¯äºº10æ¬¡]
```{r}
simulate_coin_toss(prob_head = 0.5,num_people = 5, num_tosses = 10)
```

.panel[.panel-name[10äººï¼Œæ¯äºº10æ¬¡]

```{r}
simulate_coin_toss(prob_head = 0.5,num_people = 10, num_tosses = 10)
```

.panel[.panel-name[1000äººï¼Œæ¯äºº10æ¬¡]

```{r}
simulate_coin_toss(prob_head = 0.5,num_people = 1000, num_tosses = 10)
```

]]]]

---
#10.2 äºŒé¡¹åˆ†å¸ƒ(Binomial Distribution)
.bigfont[
- å·²çŸ¥ä¸€æ¬¡è¯•éªŒä¸­çš„æ¯æ¬¡å°è¯•ä¸­äº‹ä»¶Aå‘ç”Ÿçš„æ¦‚ç‡$p$ï¼Œå…±è¿›è¡Œ$n$æ¬¡ç‹¬ç«‹é‡å¤çš„ä¼¯åŠªåˆ©è¯•éªŒ
- äº‹ä»¶Aåœ¨ä¸€æ¬¡è¯•éªŒä¸­å‡ºç°kæ¬¡ï¼Œäº‹ä»¶Aåœ¨næ¬¡è¯•éªŒä¸­å‡ºç°æ¬¡æ•°çš„å¹³å‡æ•°
$$ï¼ˆğ‘˜_1+ğ‘˜_2+ğ‘˜_3+...+ğ‘˜_ğ‘›/ğ‘›)$$
- å½“n â†’ âˆï¼Œ$p$ â‰  qï¼Œ$np$ â‰¥ 5ä¸”$nq$ â‰¥ 5ï¼Œäº‹ä»¶Aåœ¨$n$æ¬¡è¯•éªŒä¸­å‡ºç°æ¬¡æ•°çš„å¹³å‡æ•°ï¼š
$$\mu = np$$
- äº‹ä»¶Aå‡ºç°æ¬¡æ•°æ‰€å±åˆ†å¸ƒçš„æ ‡å‡†å·®ï¼š
$$ \sigma = \sqrt{ğ‘›ğ‘ğ‘}$$
]
---
#10.2 äºŒé¡¹åˆ†å¸ƒ(Binomial Distribution)
## å¦‚ä½•å°†$z$ä¸äºŒåˆ†å˜é‡è¿›è¡Œè¿æ¥ï¼Ÿ
### (1)å°†é¢„æµ‹é¡¹æ˜ å°„åˆ°(0,1)ä¹‹é—´ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨
$$\frac{1}{1+exp(-z)}$$
### (2)æ‰¾åˆ°ä¸€ä¸ªåˆ†å¸ƒï¼Œèƒ½æ ¹æ®(0,1)ä¹‹é—´çš„å€¼è½¬æˆäºŒåˆ†å˜é‡ï¼Œä¾‹å¦‚ï¼Œä¼¯åŠªåˆ©åˆ†å¸ƒã€‚
.pull-left[
![](./picture/chp10/func.png)
]
.pull-right[
![](./picture/chp10/bernoulli.png)
]
---
#10.2 äºŒé¡¹åˆ†å¸ƒ(Binomial Distribution)
```{r echo=FALSE, out.width='80%'}
knitr::include_graphics('./picture/chp10/func2.png')
```

---
#10.2 äºŒé¡¹åˆ†å¸ƒ(Binomial Distribution)
##å‚æ•°æ±‚è§£
.bigfont[
- å¯¹äºlogitå›å½’ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡å¯¹å…¶è¿›è¡Œæ±‚è§£
- è¯¥æ±‚è§£è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬ç”±è®¡ç®—æœºè‡ªåŠ¨å®Œæˆ
]
![](./picture/chp10/logit.png)
---
#10.3 å…¶ä»–åˆ†å¸ƒ
##æ³Šæ¾åˆ†å¸ƒ(Poisson distribution)
.bigfont[
- åœ¨å›ºå®šæ—¶é—´é—´éš”æˆ–ç©ºé—´åŒºåŸŸå†…å‘ç”ŸæŸç§äº‹ä»¶çš„æ¬¡æ•°çš„æ¦‚ç‡ã€‚
- é€‚ç”¨äºäº‹ä»¶ä»¥æ’å®šå¹³å‡é€Ÿç‡ç‹¬ç«‹å‘ç”Ÿçš„æƒ…å†µ
- ä¾‹å¦‚ç”µè¯å‘¼å«ã€ç½‘ç«™è®¿é—®ã€æœºå™¨æ•…éšœç­‰ã€‚
$$P(X = k) = \frac{e^{-\lambda} \lambda^k}{k!}$$
- Î»:äº‹ä»¶åœ¨ç»™å®šæ—¶é—´æˆ–ç©ºé—´å†…çš„å¹³å‡å‘ç”Ÿç‡ï¼ˆæˆ–å¹³å‡æ•°é‡ï¼‰ã€‚
- k:å¯èƒ½çš„äº‹ä»¶å‘ç”Ÿæ¬¡æ•°ï¼Œå¯ä»¥æ˜¯0, 1, 2, â€¦
]
---
#10.3 å…¶ä»–åˆ†å¸ƒ
##æ³Šæ¾åˆ†å¸ƒ(Poisson distribution)

```{r}
set.seed(123) # è®¾ç½®éšæœºç§å­ä»¥è·å¾—å¯é‡å¤çš„ç»“æœ
random_samples <- rpois(1000, lambda = 5)
hist(random_samples,col = 'white', border = 'black',)
```

---
#10.3 å…¶ä»–åˆ†å¸ƒ
##æ³Šæ¾åˆ†å¸ƒ(Poisson distribution)
![](./picture/chp10/poission.png)
---
#10.3 å…¶ä»–åˆ†å¸ƒ
##ä¼½é©¬åˆ†å¸ƒ(Gamma distribution)
<br>
.bigfont[
- ä¼½é©¬åˆ†å¸ƒï¼ˆGamma Distributionï¼‰æ˜¯ç»Ÿè®¡å­¦çš„ä¸€ç§è¿ç»­æ¦‚ç‡å‡½æ•°ï¼Œæ˜¯æ¦‚ç‡ç»Ÿè®¡ä¸­ä¸€ç§éå¸¸é‡è¦çš„åˆ†å¸ƒã€‚
- â€œæŒ‡æ•°åˆ†å¸ƒâ€å’Œâ€œå¡æ–¹åˆ†å¸ƒâ€éƒ½æ˜¯ä¼½é©¬åˆ†å¸ƒçš„ç‰¹ä¾‹ã€‚
$$f(x | \alpha, \beta) = \frac{\beta^\alpha x^{\alpha-1} e^{-\beta x}}{\Gamma(\alpha)}$$
- Î±:å½¢çŠ¶å‚æ•°ï¼ˆshape parameterï¼‰ï¼Œå†³å®šäº†åˆ†å¸ƒçš„æ›²çº¿å½¢æ€ï¼Œå°¤å…¶æ˜¯å³°å€¼çš„ä½ç½®å’Œæ›²çº¿çš„å°–å³­ç¨‹åº¦ã€‚
- Î²:å°ºåº¦å‚æ•°ï¼ˆscale parameterï¼‰ï¼Œå½±å“åˆ†å¸ƒçš„å®½åº¦ï¼›å½“å°ºåº¦å‚æ•°å¢å¤§æ—¶ï¼Œåˆ†å¸ƒä¼šå˜å¾—æ›´å®½ä¸”çŸ®å¹³ï¼›å°ºåº¦å‚æ•°å‡å°æ—¶ï¼Œåˆ†å¸ƒä¼šå˜å¾—æ›´çª„ä¸”é«˜è€¸ã€‚
]
---
#10.3 å…¶ä»–åˆ†å¸ƒ
##ä¼½é©¬åˆ†å¸ƒ(Gamma distribution)
```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('./picture/chp10/gamma.webp')
```



---
#10.4 ä»£ç å®æ“
##é¦–å…ˆåˆ†æä¸€ä¸ªè¢«è¯•çš„æ•°æ®
```{r}
df.match.7304 <- df.match %>%
  dplyr::filter(Sub == 7304)
mod_7304_full <- stats::glm(data = df.match.7304,
                          formula = ACC ~ 1 + Identity * Valence,
                          family = binomial)
summary(mod_7304_full) %>%
  capture.output() %>% .[c(6:11,15:19)]
```

---
#10.4 ä»£ç å®æ“

.panelset[
.panel[.panel-name[mod_null]
```{r}
#æ— å›ºå®šæ•ˆåº”
mod_null <- lme4::glmer(data = df.match,
                   formula = ACC ~ (1 + Identity * Valence|Sub),
                   family = binomial)
#performance::model_performance(mod_null)
summary(mod_null) %>%
  capture.output()%>% .[c(7:8,14:24)]
```

.panel[.panel-name[mod]
```{r}
#éšæœºæˆªè·ï¼Œå›ºå®šæ–œç‡
mod <- lme4::glmer(data = df.match,
                     formula = ACC ~ 1 + Identity * Valence + (1|Sub), 
                     family = binomial)
#performance::model_performance(mod)
summary(mod) %>%
  capture.output() %>% .[c(7:8,14:24,28:32)]
```

.panel[.panel-name[model_full]
```{r}
#éšæœºæˆªè·ï¼Œéšæœºæ–œç‡
mod_full <- lme4::glmer(data = df.match,
                          formula = ACC ~ 1 + Identity * Valence + (1 + Identity * Valence|Sub), 
                          family = binomial)
##performance::model_performance(mod_full)
summary(mod_full) %>%
  capture.output() %>% .[c(6:7,13:18,21:26,30:34)]
```

.panel[.panel-name[æ¨¡å‹æ¯”è¾ƒanova]
```{r}
stats::anova(mod_null, mod, mod_full)
```

.panel[.panel-name[æ¨¡å‹æ¯”è¾ƒcompare_performance]
```{r,results='hide'}
performance::compare_performance(mod_null, mod, mod_full, rank = TRUE, verbose = FALSE)
```

![](./picture/chp10/performance1.png)
]]]]]]

---
#10.4 ä»£ç å®æ“
##ç»“æœè§£è¯»
```{r}
summary(mod_full) %>% capture.output() %>% .[c(21:26)]
```

```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('./picture/chp10/logit2.png')
```
.pull-left[
- MoralSelf:
$P=\frac{e^{2.73}}{1+e^{2.73}} = 0.939$
<br>
- ImmoralSelf:
$P=\frac{e^{2.73-1.10 }}{1+e^{2.73-1.10}} = 0.836$
]
.pull-right[
- MoralOther:
$P=\frac{e^{2.73-0.76 }}{1+e^{2.73-0.76 }} = 0.878$
<br>
- ImmoralOther:
$P=\frac{e^{2.73-0.76-1.10+0.89}}{1+e^{2.73-0.76-1.10+0.89}} = 0.853$
]
---
#10.4 ä»£ç å®æ“

```{r}
#äº¤äº’ä½œç”¨
interactions::cat_plot(model = mod_full,
                       pred = Identity,
                       modx = Valence)
```


---
#10.5 æ–¹æ³•æ¯”è¾ƒ

.panelset[
.panel[.panel-name[anova]
```{r, results = 'hide'}
res <- bruceR::MANOVA(data = df.match.aov,
       subID = 'Sub', # è¢«è¯•ç¼–å·
       dv= 'mean_ACC', # dependent variable
       within = c('Identity', 'Valence')) 
```

```{r}
capture.output(res) %>% .[3:8]
```


.panel[.panel-name[EMMAMNS]
```{r}
res %>%
  bruceR::EMMEANS(effect = 'Valence', by = 'Identity') %>%
  capture.output()
```

.panel[.panel-name[GLM]
```{r}
stats::anova(mod_full)
```

.panel[.panel-name[HLM]


```{r}
mod_anova <- lme4::lmer(data = df.match,
                        formula = ACC ~ 1 + Identity * Valence + (1 + Identity * Valence|Sub))
stats::anova(mod_anova)
```

.panel[.panel-name[HLM_mean]
```{r}
mod_mean <- lme4::lmer(data = df.match.aov,
                          formula = mean_ACC ~ 1 + Identity * Valence + (1|Sub) + (1|Identity:Sub) + (1|Valence:Sub))
stats::anova(mod_mean)

```

.panel[.panel-name[compare]
```{r, results='hide'}
performance::compare_performance(mod_full, mod_anova, rank = TRUE, verbose = FALSE)
```

![](./picture/chp10/performance2.png)

```{r}
stats::anova(mod_full, mod_anova)
```


]]]]]]]

---
#10.5 æ–¹æ³•æ¯”è¾ƒ
## ç•™å‡ºæ³•
```{r model prediction}
# è®¾ç½®ç§å­ä»¥ç¡®ä¿ç»“æœçš„å¯é‡å¤æ€§
set.seed(456)

# éšæœºé€‰æ‹©70%çš„æ•°æ®ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä½™çš„30%ä½œä¸ºæµ‹è¯•é›†
train_index <- caret::createDataPartition(df.match$Sub, p = 0.7, list = FALSE)
train_data <- df.match[train_index, ]
test_data <- df.match[-train_index, ]

# æ ¹æ®è®­ç»ƒé›†ç”Ÿæˆæ¨¡å‹
model_full <- lme4::glmer(data = train_data,
                          formula = ACC ~ 1 + Identity * Valence + (1 + Identity * Valence|Sub), 
                          family = binomial)
model_anova <- lme4::lmer(data = train_data,
                          formula = ACC ~ 1 + Identity * Valence + (1 + Identity * Valence|Sub))

# ä½¿ç”¨ç•™å‡ºæ³•è¯„ä¼°æ¨¡å‹æ€§èƒ½
pre_mod_full <- predict(model_full, newdata = test_data)
pre_mod_anova <- predict(model_anova, newdata = test_data)

```

---
#10.5 æ–¹æ³•æ¯”è¾ƒ
## ç•™å‡ºæ³•
.pull-left[
```{r}
# è®¡ç®—æ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡
performance_mod_full <- c(RMSE = sqrt(mean((test_data$ACC - pre_mod_full)^2)),
                R2 = cor(test_data$ACC, pre_mod_full)^2)
# æ‰“å°æ€§èƒ½æŒ‡æ ‡
print(performance_mod_full)
```
]
.pull-right[
```{r}
# è®¡ç®—æ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡
performance_mod_anova <- c(RMSE = sqrt(mean((test_data$ACC - pre_mod_anova)^2)),
                R2 = cor(test_data$ACC, pre_mod_anova)^2)

# æ‰“å°æ€§èƒ½æŒ‡æ ‡
print(performance_mod_anova)
```

]

---
#10.5 æ–¹æ³•æ¯”è¾ƒ
## é‡å¤æµ‹é‡åˆ†æçš„ä¸è¶³
.bigfont[
- ä¼šäº§ç”Ÿéš¾ä»¥è§£é‡Šçš„ç»“æœ
  - å‡è®¾åœ¨10ä¸ªå›ç­”ä¸­ï¼Œæ­£ç¡®å›ç­”8æ¬¡ï¼Œé”™è¯¯å›ç­”2æ¬¡
  - æ­¤æ—¶95%CIä¸º[0.52,1.08] ( = 0.8 Â± 0.275)
- æ–¹å·®ä¸é½ï¼Œä¸æ»¡è¶³æ–¹å·®åˆ†æåŸºæœ¬å‡è®¾

$$\mu = np$$
$$ğœ = âˆš(ğ‘›ğ‘ğ‘ )$$
$$ğœ_p^2 = \frac{p(1-p)}{n}$$
]
Jaeger, T. F. (2008). Categorical data analysis: Away from ANOVAs (transformation or not) and towards logit mixed models.Â *Journal of Memory and Language, 59*(4), 434-446. doi:http://dx.doi.org/10.1016/j.jml.2007.11.007


---
class: center, middle
.tit_font[
æ€è€ƒ
]
<br>
<span style="font-size: 50px;">ä¿¡å·æ£€æµ‹è®ºæ˜¯å¦å¯ä»¥ç”¨å¹¿ä¹‰çº¿æ€§æ¨¡å‹åˆ†æï¼Ÿ</span> <br>


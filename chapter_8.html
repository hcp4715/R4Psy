<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>chapter_8.knit</title>
    <meta charset="utf-8" />
    <meta name="author" content="Pac_B" />
    <script src="libs/header-attrs-2.20/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="css/Custumed_Style.css" type="text/css" />
    <link rel="stylesheet" href="css/zh-CN.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">



class: center, middle
&lt;span style="font-size: 50px;"&gt;**第八章**&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 50px;"&gt;回归模型(一)&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;胡传鹏&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 20px;"&gt; &lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;2024-04-17&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 20px;"&gt; Made with Rmarkdown&lt;/span&gt; &lt;br&gt;


&lt;style type="text/css"&gt;
/* ---- extra.css ---- */
.bigfont {
  font-size: 30px;
}
.size5{
font-size: 20px;
}
.tit_font{
font-size: 60px;
}

&lt;/style&gt;

---
&lt;br&gt;
&lt;br&gt;
&lt;img src="pic_new/chp8/group.png" width="1440" /&gt;

---
#课堂目标
&lt;br&gt;
&lt;br&gt;
## 纯粹的代码学习 → 统计知识和代码的结合 &lt;br&gt;
&lt;br&gt;
## R：更灵活的统计分析方法，与统计知识结合更加紧密&lt;br&gt;
&lt;br&gt;
## 回归模型在数据分析中的重要占比&lt;br&gt;

---


&lt;br&gt;
&lt;h1 lang="zh-CN" style="font-size: 60px;"&gt;如果你的输出中常出现科学计数法&lt;/h1&gt;

```r
# 改变R在显示大数字和小数字时是选择常规格式还是科学计数法的倾向
options(scipen=999)
# 还原设置 options(scipen = 0)
```

---
# 需要解决的问题




.panelset[
.panel[.panel-name[清理数据]


```r
# 导入数据
df1 &lt;- bruceR::import(here::here('data', 'penguin', 'penguin_rawdata.csv'))
#清理数据
df.penguin &lt;- df1 %&gt;%
  dplyr::select(Temperature_t1, Temperature_t2, socialdiversity, Site, DEQ, romantic, ALEX1:ALEX16) %&gt;% #选择变量
  dplyr::filter(!is.na(Temperature_t1) &amp; !is.na(Temperature_t2) &amp; !is.na(DEQ)) %&gt;% #处理缺失值
  dplyr::mutate(Temperature = rowMeans(select(., starts_with("Temperature"))),#计算两次核心温度的均值
                ALEX4 = case_when(TRUE ~ 6 - ALEX4),
                ALEX12 = case_when(TRUE ~ 6 - ALEX12),
                ALEX14 = case_when(TRUE ~ 6 - ALEX14),
                ALEX16 = case_when(TRUE ~ 6 - ALEX16),
                ALEX = rowSums(select(., starts_with("ALEX"))))#反向计分后计算总分
```

.panel[.panel-name[具体问题]

&lt;br&gt;
* 在penguin数据中，是否处于恋爱关系中(romantic)对核心体温(Temperature)有无影响？
* 在penguin数据中，是否处于恋爱关系中(romantic)与离赤道的距离(DEQ)是否共同影响核心体温(Temperature)？
&lt;br&gt;
&lt;br&gt;

<div id="htmlwidget-ff56c1727bb6a92cc4f9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ff56c1727bb6a92cc4f9">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6"],[36.8,34.2,35,36.1,35.72222222,35.3],[36.7,36.6,35.2,35.8,36.44444444,35.9],[8,6,5,7,5,7],["Tsinghua","Oxford","Oxford","Oxford","Chile","Bamberg"],[26.88780212,51.75,51.75,51.75,42.07719421,51.65660095],[2,1,1,1,1,1],[2,1,2,3,1,1],[2,1,2,4,1,2],[2,1,4,1,1,1],[4,5,4,4,5,4],[2,1,2,4,1,1],[2,1,2,2,1,3],[2,1,2,3,2,4],[2,1,2,4,1,2],[2,1,2,2,2,4],[1,1,1,1,1,2],[2,1,2,2,1,2],[4,4,3,4,4,2],[2,3,2,2,2,4],[4,4,4,4,4,5],[2,3,2,4,1,1],[4,4,4,4,2,5],[36.75,35.4,35.1,35.95,36.08333333,35.6],[31,23,34,40,24,35]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Temperature_t1<\/th>\n      <th>Temperature_t2<\/th>\n      <th>socialdiversity<\/th>\n      <th>Site<\/th>\n      <th>DEQ<\/th>\n      <th>romantic<\/th>\n      <th>ALEX1<\/th>\n      <th>ALEX2<\/th>\n      <th>ALEX3<\/th>\n      <th>ALEX4<\/th>\n      <th>ALEX5<\/th>\n      <th>ALEX6<\/th>\n      <th>ALEX7<\/th>\n      <th>ALEX8<\/th>\n      <th>ALEX9<\/th>\n      <th>ALEX10<\/th>\n      <th>ALEX11<\/th>\n      <th>ALEX12<\/th>\n      <th>ALEX13<\/th>\n      <th>ALEX14<\/th>\n      <th>ALEX15<\/th>\n      <th>ALEX16<\/th>\n      <th>Temperature<\/th>\n      <th>ALEX<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"columnDefs":[{"className":"dt-right","targets":[1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

]]]

---
&lt;h1 lang="en" style="font-size: 60px;"&gt;Contents&lt;/h1&gt;
&lt;br&gt;
&lt;span style="font-size: 45px;"&gt;8.1 *t*-test &amp; linear regression&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.1.1 独立样本*t*检验&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.1.2 线性回归&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.1.3 单样本*t*检验&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.1.4 配对样本*t*检验&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.1.5 bruceR::TTEST&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 45px;"&gt;8.2 ANOVA &amp; linear regression&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.3.1 ANOVA基础知识&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.3.2 bruceR::MANOVA&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.3.3 代码实操&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;8.3.4 ANOVA与线性回归&lt;/span&gt;&lt;/center&gt; &lt;br&gt;

---
class: center, middle
&lt;span style="font-size: 60px;"&gt;8.1  8.1 *t*-test &amp; linear regression&lt;/span&gt; &lt;br&gt;


---
# 8.1 *t*-test &amp; linear regression
## 8.1.1 独立样本*t*检验(independent *t*-test)

.panelset[
.panel[.panel-name[基础知识]

&lt;br&gt;
**比较两个独立样本群体的均值是否有显著差异。**
&lt;br&gt;
**前提条件**
* 正态性：两个样本数据都应该来自正态分布的总体。样本量足够大时，即使不严格服从正态分布，结果也是稳健的。
* 同方差性：两个样本的方差应该是相等的。
* 独立性：两个样本应该是独立的，即一个样本的观测值不应影响另一个样本的观测值。&lt;br&gt;
&lt;br&gt;

**假设**
* `\(H_0\)`: 两个独立样本群体的均值没有显著差异，即 `\(μ_1\)` = `\(μ_2\)`
* `\(H_1\)`: 两个独立样本群体的均值有显著差异，即 `\(μ_1\)` ≠ `\(μ_2\)`
&lt;br&gt;
`$$t = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}$$`

.panel[.panel-name[代码实操]


```r
stats::t.test(data = df.penguin, #数据框
              Temperature ~ romantic,#因变量~自变量
              var.equal = TRUE) %&gt;%
  capture.output() #capture.output仅为输出整齐
```

```
##  [1] ""                                                                                              
##  [2] "\tTwo Sample t-test"                                                                           
##  [3] ""                                                                                              
##  [4] "data:  Temperature by romantic"                                                                
##  [5] "t = -0.34664, df = 1425, p-value = 0.7289"                                                     
##  [6] "alternative hypothesis: true difference in means between group 1 and group 2 is not equal to 0"
##  [7] "95 percent confidence interval:"                                                               
##  [8] " -0.0555949  0.0388971"                                                                        
##  [9] "sample estimates:"                                                                             
## [10] "mean in group 1 mean in group 2 "                                                              
## [11] "       36.38498        36.39333 "                                                              
## [12] ""
```


]]]

---
# 8.1 *t*-test &amp; linear regression
## 8.1.2 线性回归(linear regression)
&lt;br&gt;
**回归分析**
* 回归分析用于研究一个或多个自变量（预测变量）与一个因变量（响应变量）之间的关系。&lt;br&gt;
* 其目的是找到最佳拟合线的方程，这条线尽可能地接近所有的数据点。&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
--
&lt;br&gt;
**线性回归**
* 线性回归的基本思想是通过数据拟合一条直线，使得这条直线尽可能地接近所有的数据点，从而实现对新数据点的预测。&lt;br&gt;
* 线性回归模型可以表示为：
`$$y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... + \beta_p x_p + \epsilon$$`
* 其中，y是因变量，x是自变量， `\(β_i\)`  是模型参数，表示截距和斜率，ε是误差项，表示模型未能解释的随机误差。

---
# 8.1 *t*-test &amp; linear regression
## 8.1.2 线性回归(linear regression)
&lt;br&gt;
* 独立样本t检验是线性模型的特殊形式(自变量为二分变量）
--
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/indet-lm.png" width="55%"&gt;
&lt;/p&gt;


---
# 8.1 *t*-test &amp; linear regression
## 8.1.2 线性回归(linear regression)
.pull-left[

```r
#t检验
stats::t.test(data = df.penguin, #数据框
              Temperature ~ romantic,#因变量~自变量
              var.equal = TRUE) %&gt;%
  capture.output() #capture.output仅为输出整齐
```

&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare1.1.png" width="100%"&gt;
&lt;/p&gt;
]

.pull-right[

```r
#线性回归
model.inde &lt;- stats::lm(data = df.penguin,#数据框
                   formula = Temperature ~ romantic #因变量~自变量
                   
)
```

&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare1.2.png" width="100%"&gt;
&lt;/p&gt;

]


---
# 8.1 *t*-test &amp; linear regression
## 8.1.3 单样本*t*检验(one sample *t*-test)
* 在penguin数据中，全体被试的核心体温(Temperature)是否等于36.6？&lt;br&gt;
&lt;br&gt;
--
&lt;br&gt;
**比较单个样本的平均值(m)与已知的总体平均值(μ)之间是否存在显著差异**&lt;br&gt;
&lt;br&gt;

**前提条件**
* 正态性：样本数据应来自正态分布的总体。样本量足够大时，即使不严格服从正态分布，结果也是稳健的。
* 独立性：样本中的观测值必须是独立的，即一个观测值不应影响另一个观测值。&lt;br&gt;
&lt;br&gt;

**假设**
* `\(H_0\)`: 样本的均值(m)与给定的总体均值或假设的总体均值(μ)之间没有显著差异。
* `\(H_1\)`: 样本的均值(m)与给定的总体均值或假设的总体均值(μ)之间有显著差异。
&lt;br&gt;

`$$t = \frac{\bar{X} - \mu}{s / \sqrt{n}}$$`

---
# 8.1 *t*-test &amp; linear regression
## 8.1.3 单样本*t*检验(one sample *t*-test)
.pull-left[
&lt;br&gt;
&lt;br&gt;

`$$y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... + \beta_p x_p + \epsilon$$`

单样本t检验中，仅截距不为0。此时公式为：&lt;br&gt;
--
`$$y = \beta_0$$`
`$$H_0: \beta_0 = 0$$`
]
.pull-right[
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/singlet-lm.png" width="75%"&gt;
&lt;/p&gt;
]
---
# 8.1 *t*-test &amp; linear regression
## 8.1.3 单样本*t*检验(one sample *t*-test)

.pull-left[

```r
stats::t.test(x = df.penguin$Temperature, #核心体温均值
              mu = 36.6) 
```

&lt;br&gt;
&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare2.1.png" width="100%"&gt;
&lt;/p&gt;

]
.pull-right[

```r
model.single &lt;- lm(data = df.penguin, #数据
                   formula = Temperature-36.6 ~ 1) #公式：只有截距，没有自变量
summary(model.single) 
```

&lt;br&gt;
&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare2.2.png" width="100%"&gt;
&lt;/p&gt;

]

---
# 8.1 *t*-test &amp; linear regression
## 8.1.4 配对样本*t*检验(paired *t*-test)
* 在penguin数据中，被试报告的两次核心温度(Temperature_t1,Temperature_t2)是否有显著差异？&lt;br&gt;
&lt;br&gt;
--
**比较两个相关的样本组（例如，同一组受试者在不同条件下的测量）的平均值是否存在显著差异。**&lt;br&gt;
&lt;br&gt;
**前提条件**
* 正态性：样本数据应来自正态分布的总体。样本量足够大时，即使不严格服从正态分布，结果也是稳健的。
* 独立性：配对样本中的观测值必须是独立的，即每一对观测值不应影响其他对的观测值。
* 配对设计：数据必须是以配对形式收集的。&lt;br&gt;
&lt;br&gt;
**假设**
* `\(H_0\)`: 配对样本的总体平均差与零没有显著差异（两个配对样本的均值没有显著差异）。
* `\(H_1\)`: 配对样本的总体平均差与零有显著差异（两个配对样本的均值存在显著差异）。
&lt;br&gt;

`$$t = \frac{\bar{X} - \mu}{s / \sqrt{n}}$$`
---
# 8.1 *t*-test &amp; linear regression
## 8.1.4 配对样本*t*检验(paired *t*-test)

$$y_1 - y_2 = \beta_0 $$
$$H_0: \beta_0 = 0 $$
--
可以将配对样本*t*检验理解为对差值进行的单样本*t*检验，即单独用一个数字来预测对应的差值（见图的右半部分）。&lt;br&gt;
也可以认为这些组间之差是斜率（见图的左半部分）。&lt;br&gt;

&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/pairt-lm.png" width="70%"&gt;
&lt;/p&gt;

---
# 8.1 *t*-test &amp; linear regression
## 8.1.4 配对样本*t*检验(paired *t*-test)
.pull-left[

```r
stats::t.test(x = df.penguin$Temperature_t1, #第1次核心体温
              y = df.penguin$Temperature_t2, #第2次核心体温
              paired = TRUE)
```

&lt;br&gt;
&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare3.1.png" width="100%"&gt;
&lt;/p&gt;

]
.pull-right[

```r
model.paired &lt;- lm(data = df.penguin,
                   formula = Temperature_t1 - Temperature_t2 ~ 1)
summary(model.paired)
```

&lt;br&gt;
&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare3.2.png" width="70%"&gt;
&lt;/p&gt;

]

---
# 8.1 *t*-test &amp; linear regression
## 8.1.5 bruceR::TTEST
* 如果偏好使用t检验，推荐bruceR::TTEST函数

&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/TTEST.png" width="70%"&gt;
&lt;/p&gt;

中文帮助文档：https://zhuanlan.zhihu.com/p/281150493
---
# 8.1 *t*-test &amp; linear regression
## 8.1.5 bruceR::TTEST
.panelset[
.panel[.panel-name[独立样本t检验]
.pull-left[

```r
stats::t.test(data = df.penguin, #数据框
              Temperature ~ romantic,#因变量~自变量
              var.equal = TRUE) %&gt;%
  capture.output() #capture.output仅为输出整齐 
```


&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare1.1.png" width="100%"&gt;
&lt;/p&gt;
]
.pull-right[

```r
bruceR::TTEST(data = df.penguin, #数据
                y = "Temperature", #因变量：核心体温均值
                x = "romantic" #自变量：是否在恋爱关系中
) 
```

&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/leven.png" width="100%"&gt;
&lt;/p&gt;

&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/bruceRTTEST.png" width="100%"&gt;
&lt;/p&gt;
]
.panel[.panel-name[单样本t检验]
.pull-left[

```r
stats::t.test(x = df.penguin$Temperature, #核心体温均值
              mu = 36.6)
```


&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare2.1.png" width="100%"&gt;
&lt;/p&gt;
]
.pull-right[

```r
bruceR::TTEST(data = df.penguin, #数据
                y = "Temperature", #确定变量
                test.value = 36.6, #固定值
                test.sided = "=")  #根据研究目的，可更改为“&lt;”或“&gt;”
```

```
## t is large; approximation invoked.
```

&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/sample.png" width="100%"&gt;
&lt;/p&gt;

]
.panel[.panel-name[配对样本t检验]

.pull-left[

```r
stats::t.test(x = df.penguin$Temperature_t1, #第1次核心体温
              y = df.penguin$Temperature_t2, #第2次核心体温
              paired = TRUE) 
```


&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/compare3.1.png" width="100%"&gt;
&lt;/p&gt;
]
.pull-right[

```r
bruceR::TTEST(data = df.penguin, #数据
                 y = c("Temperature_t1",              
                       "Temperature_t2"), #变量为两次核心体温
                 paired = T)  #是否为配对样本*t*检验？默认是FALSE
```

```
## t is large; approximation invoked.
```

&lt;br&gt;
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/pair.png" width="100%"&gt;
&lt;/p&gt;
]
]]]]
---
# 8.1 *t*-test &amp; linear regression
&lt;br&gt;
&lt;br&gt;
![](./pic_new/chp8/table1.png)

参考：https://lindeloev.github.io/tests-as-linear/#61_one-way_anova_and_kruskal-wallis






---
class: center, middle
&lt;span style="font-size: 60px;"&gt;8.3  方差分析&lt;/span&gt; &lt;br&gt;


---
# 8.3  ANOVA
## 8.3.1 基础知识
.pull-left[
&lt;img src="./pic_new/chp8/ANOVA process.png" width="100%"&gt;
]

.pull-right[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
当研究者想要比较两个或多个组之间的均值差异时，可使用方差分析(Analysis of Variance，简称ANOVA)。&lt;br&gt;
&lt;br&gt;
它由英国统计学家R.A.Fisher提出，基本思想是将测量数据的总变异（即总方差）按照变异来源分为处理（组间）效应和误差（组内）效应，并作出其数量估计，从而确定实验处理对研究结果影响力的大小。
]

---
# 8.3  ANOVA
## 8.3.1 基础知识
&lt;br&gt;
&lt;br&gt;
**基本假设：**

1.正态性&lt;br&gt;
实验中的观测值应来自正态分布的总体。当观测值不是正态分布时需要对观测值做合适的转换。&lt;br&gt;

2.独立性&lt;br&gt;
每个因素的影响被看作是独立的，不受其他因素的影响。在理想情况下，如果将一个因素的效应加到总效应中去，它应该增加（或者减少）平均响应一个固定的数量，而不依赖于其他任何因素。&lt;br&gt;

3.方差齐性&lt;br&gt;
当被试随机分配给K个处理水平时，K个处理组被试的观测值的变异是同质的，即各个组的变异是相等的。&lt;br&gt;

---
# 8.3  ANOVA
## 8.3.1 基础知识
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/ANOVA es.png" width="70%"&gt;
&lt;/p&gt;

---
# 8.3  ANOVA
## 8.3.1 基础知识
平方和(SS)的计算
&lt;br&gt;
.panelset[
.panel[.panel-name[Type I SS]
&lt;br&gt;
通常用于顺序重要的模型。也就是说，解释变量的顺序会影响到类型I平方和的计算结果。&lt;br&gt;
&lt;br&gt;
**stats::aov()函数默认采用的就是Type I SS，它逐步将每一个因子引入模型进行计算。**&lt;br&gt;

.panel[.panel-name[Type II SS]
&lt;br&gt;
适用于所有主效应不涉及交互效应的情况。也就是说，它忽略了因子之间可能存在的交互作用。&lt;br&gt;
假定所有的因子都是同时进入模型的，并且它们都是等价的。&lt;br&gt;
&lt;br&gt;
**car::Anova()函数默认计算Type II SS，可以通过type = 3调整为Type III SS。**&lt;br&gt;

.panel[.panel-name[Type III SS]
&lt;br&gt;
类型III平方和是一个更全面的模型，涉及所有的主效应以及交互效应。&lt;br&gt;
它假定所有因子（以及它们的交互项）都是重要的，并考虑所有因素。&lt;br&gt;
&lt;br&gt;
**bruceR::MANOVA*()函数默认采用Type III SS，可以通过ss.type = 2调整为Type II SS。**&lt;br&gt;

]]]]

---
# 8.3  ANOVA
## 8.3.1 基础知识
按照自变量个数，可以分为单因素方差分析、双因素方差分析、以及多因素方差分析。
.panelset[
.panel[.panel-name[单因素方差分析]
最基本的方差分析形式，用于检验一个变量不同水平之间是否有显著差异。&lt;br&gt;
例如，比较三种不同的教学方法对学生学习成绩的影响。在这种情况下，自变量是“教学方法”，因变量是学生学习成绩。&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;img src="pic_new/chp8/oneway.png" width="1371" /&gt;

.panel[.panel-name[双因素方差分析]
双因素方差分析用于检验两个分类变量和它们的交互效应对因变量的影响。&lt;br&gt;
例如，要检察两种不同的教学方法和两种不同的课程难度对学生学习成绩的影响。&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;img src="pic_new/chp8/mway.png" width="971" /&gt;

.panel[.panel-name[多因素方差分析]
最复杂的ANOVA类型，用于检验多个分类变量和它们的交互效应对响应变量的影响。&lt;br&gt;
例如，要检验课程类型，教学方法，学生性别等多个因素对学习成绩的影响。&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;img src="pic_new/chp8/mway.png" width="971" /&gt;

]]]]

---
# 8.3  ANOVA
## 8.3.2 bruceR::MANOVA
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/ANOVA data.png" width="70%"&gt;
&lt;/p&gt;

---
# 8.3  ANOVA
## 8.3.2 bruceR::MANOVA
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/MANOVA.png" width="70%"&gt;
&lt;/p&gt;

---
class: center, middle
&lt;span style="font-size: 60px;"&gt;问题1&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 60px;"&gt;在match数据中，被试在匹配(match)条件和不匹配(mismatch)条件下的反应时是否存在差异？&lt;/span&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 45px;"&gt;完成这一分析需要什么方法与数据格式？&lt;/span&gt; &lt;br&gt;

---
# 8.3  ANOVA
## 8.3.3 代码实操|单因素方差分析
.panelset[
.panel[.panel-name[`tidy data`]

```r
df.match &lt;- read.csv(here::here("data", "match","match_raw.csv"),
                     header = T, sep=",", stringsAsFactors = FALSE) %&gt;%
  # 拆分单元格内字符串
  tidyr::separate(col=Shape,
                  into=c("Valence","Identity"),
                  sep="(?&lt;=moral|immoral)(?=Self|Other)") %&gt;% 
  dplyr::select(Sub, Match, Valence, Identity, everything()) %&gt;%
  dplyr::filter(ACC == 1) %&gt;%    # 只选择回答正确的数据
  dplyr::filter(!is.na(RT)) %&gt;%  # 剔除缺失值
  # remove outliers below and above 3rd sd
  dplyr::filter(RT &gt; quantile(RT, 0.0015) &amp; RT &lt; quantile(RT, 0.9985)) %&gt;%
  dplyr::mutate(RT = as.numeric(RT)) %&gt;%
  dplyr::mutate(Valence = as.factor(Valence),
                Identity = as.factor(Identity))
```
<div id="htmlwidget-b4d22fd5d351c24663ca" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b4d22fd5d351c24663ca">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302],["mismatch","mismatch","match","match","match","match","mismatch","mismatch","mismatch","match","match","match","mismatch","mismatch","match","match","mismatch","match","match","mismatch","match","match","mismatch","match"],["moral","immoral","immoral","immoral","moral","moral","moral","immoral","moral","immoral","moral","immoral","immoral","moral","moral","moral","immoral","moral","immoral","immoral","moral","immoral","immoral","immoral"],["Other","Other","Self","Self","Other","Self","Other","Self","Other","Other","Other","Other","Self","Self","Self","Other","Other","Self","Other","Other","Self","Other","Self","Other"],["02-May-2018_14:23:08","02-May-2018_14:23:10","02-May-2018_14:23:15","02-May-2018_14:23:17","02-May-2018_14:23:19","02-May-2018_14:23:21","02-May-2018_14:23:24","02-May-2018_14:23:26","02-May-2018_14:23:28","02-May-2018_14:23:30","02-May-2018_14:23:32","02-May-2018_14:23:36","02-May-2018_14:23:38","02-May-2018_14:23:40","02-May-2018_14:23:42","02-May-2018_14:23:47","02-May-2018_14:23:49","02-May-2018_14:23:51","02-May-2018_14:23:53","02-May-2018_14:23:55","02-May-2018_14:23:57","02-May-2018_14:24:02","02-May-2018_14:24:06","02-May-2018_14:24:08"],["Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp","Exp"],[22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22],["female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female"],["R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2],[2,3,5,6,7,8,9,10,11,12,13,15,16,17,18,20,21,22,23,24,1,3,5,6],["moralSelf","moralOther","immoralSelf","immoralSelf","moralOther","moralSelf","immoralSelf","moralOther","moralSelf","immoralOther","moralOther","immoralOther","moralSelf","immoralSelf","moralSelf","moralOther","moralOther","moralSelf","immoralOther","moralOther","moralSelf","immoralOther","immoralOther","immoralOther"],["n","n","m","m","m","m","n","n","n","m","m","m","n","n","m","m","n","m","m","n","m","m","n","m"],["n","n","m","m","m","m","n","n","n","m","m","m","n","n","m","m","n","m","m","n","m","m","n","m"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0.7043,0.9903,0.8207,0.7547,0.5429,0.9009,0.9551,0.6952,0.7593,0.7135,0.5656,0.8078,0.96,0.6661,0.6962,0.5785,0.7845,0.8146,0.6548,0.8789,0.7131,0.8033,0.8095,0.6176]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Match<\/th>\n      <th>Valence<\/th>\n      <th>Identity<\/th>\n      <th>Date<\/th>\n      <th>Prac<\/th>\n      <th>Age<\/th>\n      <th>Sex<\/th>\n      <th>Hand<\/th>\n      <th>Block<\/th>\n      <th>Bin<\/th>\n      <th>Trial<\/th>\n      <th>Label<\/th>\n      <th>CorrResp<\/th>\n      <th>Resp<\/th>\n      <th>ACC<\/th>\n      <th>RT<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,7,10,11,12,16,17]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

.panel[.panel-name[`preprocessing`]

```r
df.match.long1 &lt;- df.match %&gt;%
  dplyr::group_by(Sub, Match) %&gt;%
  dplyr::summarise(
    n = n(),
    rt_sd = sd(as.numeric(RT), na.rm = T),
    rt_mean = mean(as.numeric(RT), na.rm = T)
    ) %&gt;%
  dplyr::ungroup()
```

```
## `summarise()` has grouped output by 'Sub'. You can override using the `.groups`
## argument.
```
<div id="htmlwidget-bb1047a77f5ee799c572" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bb1047a77f5ee799c572">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7302,7303,7303,7304,7304,7305,7305,7306,7306,7307,7307,7308,7308,7309,7309,7310,7310,7311,7311,7312,7312,7313,7313],["match","mismatch","match","mismatch","match","mismatch","match","mismatch","match","mismatch","match","mismatch","match","mismatch","match","mismatch","match","mismatch","match","mismatch","match","mismatch","match","mismatch"],[160,149,148,133,245,194,274,226,270,252,251,249,254,260,245,197,283,277,265,215,246,249,159,214],[0.106612719566056,0.0994899939093511,0.115424425115395,0.0881816560548197,0.137261728375444,0.106883820747074,0.12827239859204,0.121570749496483,0.135007585074087,0.109344555569399,0.140682490192253,0.128227204032769,0.124296272295752,0.128918364033564,0.10566605029373,0.096720699540321,0.105462249733439,0.103813913540718,0.0888702763664029,0.101587986356471,0.139517224343454,0.115601761518419,0.110502648869666,0.125935381764594],[0.66311875,0.743634228187919,0.704106756756757,0.756554887218045,0.681796326530612,0.751001546391753,0.604401094890511,0.719050442477876,0.708901481481481,0.77705,0.684874103585657,0.749271084337349,0.70463031496063,0.741393076923077,0.663964489795918,0.732960913705584,0.598352650176678,0.642554873646209,0.529761132075472,0.5706,0.735468292682927,0.761715261044177,0.564375471698113,0.586565887850467]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Match<\/th>\n      <th>n<\/th>\n      <th>rt_sd<\/th>\n      <th>rt_mean<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

]]]

---
# 8.3  ANOVA
## 8.3.3 代码实操|单因素方差分析

```r
# 正态性检验-Shapiro-Wilk测试
# 若p &gt;.05，不能拒绝数据符合正态分布的零假设

shapiro.test(df.match.long1$rt_mean)
```

```
## 
## 	Shapiro-Wilk normality test
## 
## data:  df.match.long1$rt_mean
## W = 0.9801, p-value = 0.1951
```

---
# 8.3  ANOVA
## 8.3.3 代码实操|单因素方差分析

```r
# 正态性检验-qq图
qqnorm(df.match.long1$rt_mean)
qqline(df.match.long1$rt_mean, col = "red") # 添加理论正态分布线
```

![](chapter_8_files/figure-html/unnamed-chunk-24-1.png)&lt;!-- --&gt;


---
# 8.3  ANOVA
## 8.3.3 代码实操|单因素方差分析
.panelset[
.panel[.panel-name[`bruceR::MANOVA`]

```r
res1 &lt;- bruceR::MANOVA(data = df.match.long1,
                       subID = "Sub",    # 被试id
                       dv = "rt_mean",   # 因变量，因为是MANOVA，实际上因变量可以再后面设置很多个
                       within = "Match" # 设置条件，因素分析的条件
) 
```

```
## 
##     * Data are aggregated to mean (across items/trials)
##     if there are &gt;=2 observations per subject and cell.
##     You may use Linear Mixed Model to analyze the data,
##     e.g., with subjects and items as level-2 clusters.
```


```
## [1] "Anova Table (Type III tests)"                                  
## [2] ""                                                              
## [3] "Response: rt_mean"                                             
## [4] "  Effect    df  MSE          F  ges p.value"                   
## [5] "1  Match 1, 43 0.00 267.06 *** .206   &lt;.001"                   
## [6] "---"                                                           
## [7] "Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '+' 0.1 ' ' 1"
```

.panel[.panel-name[`stats::aov()`]

```r
aov1 &lt;- aov(rt_mean ~ Match, data = df.match.long1)
summary(aov1)
```

```
##             Df  Sum Sq Mean Sq F value     Pr(&gt;F)    
## Match        1 0.06739 0.06739    22.3 0.00000901 ***
## Residuals   86 0.25997 0.00302                       
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

.panel[.panel-name[`stats::lm()`]

```r
lm1 &lt;- lm(rt_mean ~ Match, data = df.match.long1)
summary(lm1)
```

```
## 
## Call:
## lm(formula = rt_mean ~ Match, data = df.match.long1)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.166516 -0.021544  0.006059  0.029911  0.114781 
## 
## Coefficients:
##               Estimate Std. Error t value             Pr(&gt;|t|)    
## (Intercept)   0.681769   0.008289  82.253 &lt; 0.0000000000000002 ***
## Matchmismatch 0.055348   0.011722   4.722           0.00000901 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.05498 on 86 degrees of freedom
## Multiple R-squared:  0.2059,	Adjusted R-squared:  0.1966 
## F-statistic: 22.29 on 1 and 86 DF,  p-value: 0.000009008
```

]]]]

---
# 8.3  ANOVA
## 8.3.4 ANOVA与线性回归
&lt;br&gt;
线性回归采用最小二乘法使得残差平方和最小。&lt;br&gt;
方差分析中的组内平方和是一个类似的概念——也即是尽量让各组内的数据点尽可能接近各自组的均值。&lt;br&gt;
&lt;br&gt;
单因素方差分析可以看作是一种特殊的线性回归模型，自变量是分类数据。&lt;br&gt;
实际上，线性回归模型中如果使用分类变量（dummy coding）作为预测变量，得到的结果和ANOVA是一样的。组间效应（组间平方和）就被视为线性模型中的斜率效应。&lt;br&gt;
&lt;br&gt;
同理，双因素方差分析也可以看作是一种特殊的线性回归模型，自变量为两个分类变量。&lt;br&gt;


---
# 8.3  ANOVA
## 8.3.4 ANOVA与线性回归

```
## Warning: The `fun.y` argument of `stat_summary()` is deprecated as of ggplot2 3.3.0.
## ℹ Please use the `fun` argument instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/anoLM.png" width="70%"&gt;
&lt;/p&gt;


---
# 8.3  ANOVA
## 单因素方差分析|思考
假如数据是宽数据可以完成分析吗？它和上面学习的t检验有什么区别？

```r
df.match.wide1 &lt;- df.match.long1 %&gt;%
  dplyr::select(Sub, Match, rt_mean) %&gt;%
  tidyr::pivot_wider(names_from = Match,
                     values_from = rt_mean)
```
<div id="htmlwidget-46b44fa9c62d587a098d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-46b44fa9c62d587a098d">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7303,7304,7305,7306,7307,7308,7309,7310,7311,7312,7313,7314,7315,7316,7317,7318,7319,7320,7321,7322,7323,7324,7325],[0.66311875,0.704106756756757,0.681796326530612,0.604401094890511,0.708901481481481,0.684874103585657,0.70463031496063,0.663964489795918,0.598352650176678,0.529761132075472,0.735468292682927,0.564375471698113,0.750470355731225,0.639942125984252,0.705596581196581,0.75194769874477,0.680262195121951,0.739057661290323,0.653172762645914,0.652679704797048,0.7060315,0.701437969924812,0.796549553571429,0.629812749003984],[0.743634228187919,0.756554887218045,0.751001546391753,0.719050442477876,0.77705,0.749271084337349,0.741393076923077,0.732960913705584,0.642554873646209,0.5706,0.761715261044177,0.586565887850467,0.76687680608365,0.69973625498008,0.744763503649635,0.843459685863874,0.737527235772358,0.78079926199262,0.705956828193833,0.722975982532751,0.754075217391304,0.759718490566038,0.82098201754386,0.662783908045977]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>match<\/th>\n      <th>mismatch<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---
class: center, middle
&lt;span style="font-size: 60px;"&gt;问题2&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 60px;"&gt;在match数据中，被试在不同身份与不同效价的条件组合下反应时是否存在差异？&lt;/span&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 45px;"&gt;2(self vs other) * 2(moral vs immoral) 的被试内设计&lt;/span&gt; &lt;br&gt;


---
# 8.3  ANOVA
## 8.3.3 代码实操|双因素方差分析
.panelset[
.panel[.panel-name[`long data`]

```r
df.match.long2 &lt;- df.match %&gt;%
    dplyr::filter(Match == "match") %&gt;%
  dplyr::group_by(Sub, Valence, Identity) %&gt;%
  dplyr::summarise(
    n = n(),
    rt_sd = sd(as.numeric(RT), na.rm = T),
    rt_mean = mean(as.numeric(RT), na.rm = T)
    ) %&gt;%
  dplyr::ungroup()
```

```
## `summarise()` has grouped output by 'Sub', 'Valence'. You can override using
## the `.groups` argument.
```
<div id="htmlwidget-a44853a31c38089c20ff" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a44853a31c38089c20ff">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7302,7302,7302,7303,7303,7303,7303,7304,7304,7304,7304,7305,7305,7305,7305,7306,7306,7306,7306,7307,7307,7307,7307],["immoral","immoral","moral","moral","immoral","immoral","moral","moral","immoral","immoral","moral","moral","immoral","immoral","moral","moral","immoral","immoral","moral","moral","immoral","immoral","moral","moral"],["Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self"],[40,38,43,39,35,32,39,42,51,60,60,74,72,63,70,69,67,70,74,59,55,70,62,64],[0.0932144562080037,0.0990216011966893,0.0940192826762158,0.109690118232167,0.100254813836937,0.111282410103246,0.136596027875297,0.0915320296751142,0.096282833890371,0.119565303008924,0.107579773317844,0.0900190380127392,0.122293680106755,0.131146958723358,0.134209135407822,0.119346352460789,0.112452907496169,0.118077769193188,0.0857433190319101,0.121205987052979,0.144395606273567,0.118263349506256,0.152376962876419,0.111336652259751],[0.666395,0.701607894736842,0.597913953488372,0.694148717948718,0.725122857142857,0.73799375,0.71568717948718,0.650021428571429,0.772743137254902,0.701163333333333,0.74875,0.549127027027027,0.640694444444444,0.605468253968254,0.591458571428571,0.578685507246377,0.757010447761194,0.746868571428571,0.579809459459459,0.771135593220339,0.769,0.629395714285714,0.699329032258065,0.6592546875]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Valence<\/th>\n      <th>Identity<\/th>\n      <th>n<\/th>\n      <th>rt_sd<\/th>\n      <th>rt_mean<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"columnDefs":[{"className":"dt-right","targets":[1,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

.panel[.panel-name[`wide data`]

```r
df.match.wide2 &lt;- df.match.long2 %&gt;%
  dplyr::select(Sub, Valence, Identity, rt_mean) %&gt;%
  dplyr::mutate(Valence = paste("A_", Valence, sep = ""),#将变量的名称进行修改转换，不生产新的变量
                Identity = paste("B_", Identity, sep = "")) %&gt;%
  # 将morality和identity组合名称起来生成一个新的变量"Condition"
  unite("Condition", Valence, Identity, sep = "&amp;") %&gt;%
  tidyr::pivot_wider(names_from = Condition,
                     values_from = rt_mean)
```
<div id="htmlwidget-64b50f952d1d95ecbd2e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-64b50f952d1d95ecbd2e">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7303,7304,7305,7306,7307,7308,7309,7310,7311,7312,7313,7314,7315,7316,7317,7318,7319,7320,7321,7322,7323,7324,7325],[0.666395,0.725122857142857,0.772743137254902,0.640694444444444,0.757010447761194,0.769,0.713426865671642,0.6783734375,0.621974626865672,0.587834426229508,0.790755555555556,0.519925862068966,0.756528070175439,0.765558490566038,0.753016363636364,0.685283098591549,0.729656603773585,0.762432203389831,0.647690909090909,0.612847222222222,0.807092,0.662083783783784,0.79752641509434,0.648301612903226],[0.701607894736842,0.73799375,0.701163333333333,0.605468253968254,0.746868571428571,0.629395714285714,0.770714,0.726181481481481,0.665611111111111,0.470285915492958,0.792693939393939,0.602826923076923,0.820516949152542,0.679273846153846,0.7637,0.792044642857143,0.671980952380952,0.794236956521739,0.670518333333333,0.778338709677419,0.771136538461539,0.748093333333333,0.809016363636364,0.6573984375],[0.597913953488372,0.71568717948718,0.74875,0.591458571428571,0.579809459459459,0.699329032258065,0.735087878787879,0.671419298245614,0.539376388888889,0.52511884057971,0.772635849056604,0.585624444444444,0.687525714285714,0.664106349206349,0.729033928571429,0.80645652173913,0.679652307692308,0.73110985915493,0.662614285714286,0.624849295774648,0.608397014925373,0.708556666666667,0.835757407407407,0.643961016949153],[0.694148717948718,0.650021428571429,0.549127027027027,0.578685507246377,0.771135593220339,0.6592546875,0.621478873239437,0.596724285714286,0.568088888888889,0.5453953125,0.615847945205479,0.585113333333333,0.749397014925373,0.492865753424658,0.614141891891892,0.75165,0.648623076923077,0.6924875,0.634441176470588,0.608028787878788,0.717273214285714,0.697073611111111,0.750506451612903,0.57304696969697]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>A_immoral&amp;B_Other<\/th>\n      <th>A_immoral&amp;B_Self<\/th>\n      <th>A_moral&amp;B_Other<\/th>\n      <th>A_moral&amp;B_Self<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

]]]


---
# 8.3  ANOVA
## 8.3.3 代码实操|双因素方差分析

```r
# 正态性检验-Shapiro-Wilk测试
# 若p &gt;.05，不能拒绝数据符合正态分布的零假设

shapiro.test(df.match.long1$rt_mean)
```

```
## 
## 	Shapiro-Wilk normality test
## 
## data:  df.match.long1$rt_mean
## W = 0.9801, p-value = 0.1951
```


---
# 8.3  ANOVA
## 8.3.3 代码实操|双因素方差分析

```r
# 正态性检验-qq图
qqnorm(df.match.long1$rt_mean)
qqline(df.match.long1$rt_mean, col = "red") # 添加理论正态分布线
```

![](chapter_8_files/figure-html/unnamed-chunk-34-1.png)&lt;!-- --&gt;


---
# 8.3  ANOVA
## 8.3.3 代码实操|双因素方差分析
.panelset[
.panel[.panel-name[`bruceR::MANOVA()`]

```r
res2 &lt;- bruceR::MANOVA(data=df.match.long2,
                            dv="rt_mean",
                            within=c("Valence","Identity"),
                            subID="Sub")
```

```
## 
##     * Data are aggregated to mean (across items/trials)
##     if there are &gt;=2 observations per subject and cell.
##     You may use Linear Mixed Model to analyze the data,
##     e.g., with subjects and items as level-2 clusters.
```

```
## [1] "Anova Table (Type III tests)"                                  
## [2] ""                                                              
## [3] "Response: rt_mean"                                             
## [4] "            Effect    df  MSE         F  ges p.value"          
## [5] "1          Valence 1, 43 0.00 65.20 *** .133   &lt;.001"          
## [6] "2         Identity 1, 43 0.00      2.60 .010    .114"          
## [7] "3 Valence:Identity 1, 43 0.00 14.55 *** .039   &lt;.001"          
## [8] "---"                                                           
## [9] "Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '+' 0.1 ' ' 1"
```


.panel[.panel-name[`car::Anova()`]

```r
aov2 &lt;- car::Anova(aov(rt_mean ~ Valence * Identity, data = df.match.long2), type = 3)
aov2
```

```
## Anova Table (Type III tests)
## 
## Response: rt_mean
##                   Sum Sq  Df   F value                Pr(&gt;F)    
## (Intercept)      21.9618   1 4537.7851 &lt; 0.00000000000000022 ***
## Valence           0.0151   1    3.1214              0.079043 .  
## Identity          0.0044   1    0.9065              0.342382    
## Valence:Identity  0.0336   1    6.9471              0.009163 ** 
## Residuals         0.8324 172                                    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

.panel[.panel-name[`stats::lm()`]

```r
lm2 &lt;- lm(rt_mean ~ Valence * Identity, data = df.match.long2)
summary(lm2)
```

```
## 
## Call:
## lm(formula = rt_mean ~ Valence * Identity, data = df.match.long2)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.250328 -0.050386  0.008862  0.050598  0.155470 
## 
## Coefficients:
##                           Estimate Std. Error t value             Pr(&gt;|t|)    
## (Intercept)                0.70649    0.01049  67.363 &lt; 0.0000000000000002 ***
## Valencemoral              -0.02620    0.01483  -1.767              0.07904 .  
## IdentitySelf               0.01412    0.01483   0.952              0.34238    
## Valencemoral:IdentitySelf -0.05529    0.02098  -2.636              0.00916 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.06957 on 172 degrees of freedom
## Multiple R-squared:  0.169,	Adjusted R-squared:  0.1545 
## F-statistic: 11.66 on 3 and 172 DF,  p-value: 0.0000005427
```

]]]]


---
# 8.3  ANOVA
## 8.3.3 代码实操|双因素方差分析

```r
# 宽数据
res2_wide &lt;- bruceR::MANOVA(data = df.match.wide2,
                            dvs = "A_immoral&amp;B_Other:A_moral&amp;B_Self",
                            dvs.pattern = "A_(.+)B_(.+)",#正则表达式
                            within = c("A_","B_"))
```

```
## 
## Note:
## dvs="A_immoral&amp;B_Other:A_moral&amp;B_Self" is matched to variables:
## A_immoral&amp;B_Other, A_immoral&amp;B_Self, A_moral&amp;B_Other, A_moral&amp;B_Self
```

```
## [1] "Anova Table (Type III tests)"                                  
## [2] ""                                                              
## [3] "Response: bruceR.Y"                                            
## [4] "  Effect    df  MSE         F  ges p.value"                    
## [5] "1     A_ 1, 43 0.00 65.20 *** .133   &lt;.001"                    
## [6] "2     B_ 1, 43 0.00      2.60 .010    .114"                    
## [7] "3  A_:B_ 1, 43 0.00 14.55 *** .039   &lt;.001"                    
## [8] "---"                                                           
## [9] "Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '+' 0.1 ' ' 1"
```



---
# 8.3  ANOVA
## 8.3.2 bruceR::EMMEANS
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/EMMEANS.png" width="80%"&gt;
&lt;/p&gt;

---
# 8.3  ANOVA
## 8.3.3 代码实操|双因素方差分析
简单效应分析
.panelset[
.panel[.panel-name[`长数据`]

```r
sim_eff_long &lt;- res2 %&gt;% 
  bruceR::EMMEANS("Identity", by = "Valence")
```


```
## [1] "Anova Table (Type III tests)"                                  
## [2] ""                                                              
## [3] "Response: rt_mean"                                             
## [4] "            Effect    df  MSE         F  ges p.value"          
## [5] "1          Valence 1, 43 0.00 65.20 *** .133   &lt;.001"          
## [6] "2         Identity 1, 43 0.00      2.60 .010    .114"          
## [7] "3 Valence:Identity 1, 43 0.00 14.55 *** .039   &lt;.001"          
## [8] "---"                                                           
## [9] "Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '+' 0.1 ' ' 1"
```


.panel[.panel-name[`宽数据`]

```r
sim_eff_wide &lt;- res2_wide %&gt;%
  bruceR::EMMEANS("A_", by = "B_") 
```


```
## [1] "Anova Table (Type III tests)"                                  
## [2] ""                                                              
## [3] "Response: bruceR.Y"                                            
## [4] "  Effect    df  MSE         F  ges p.value"                    
## [5] "1     A_ 1, 43 0.00 65.20 *** .133   &lt;.001"                    
## [6] "2     B_ 1, 43 0.00      2.60 .010    .114"                    
## [7] "3  A_:B_ 1, 43 0.00 14.55 *** .039   &lt;.001"                    
## [8] "---"                                                           
## [9] "Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '+' 0.1 ' ' 1"
```


]]]


---
# 8.3  ANOVA
## 8.3.4 ANOVA与线性回归
&lt;p align="center"&gt;
  &lt;img src="./pic_new/chp8/LM2.png" width="80%"&gt;
&lt;/p&gt;

![](./pic_new/chp8/LM2.png)


---
class: center, middle
&lt;span style="font-size: 60px;"&gt;思考&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 60px;"&gt;如何从线性回归的角度理解重复测量方差分析呢？&lt;/span&gt; &lt;br&gt;


---
# &lt;h1 lang="zh-CN"&gt;课堂练习2&lt;/h1&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;h2 lang="zh-CN"&gt;在match数据中，以性别，身份为自变量，反应时为因变量进行方差分析&lt;/h2&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightLines": true,
"highlightStyle": "github",
"countIncrementalSlides": false,
"seal": true,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>

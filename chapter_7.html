<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Lecture 7</title>
    <meta charset="utf-8" />
    <meta name="author" content="Hu Chuan-Peng (PhD)" />
    <script src="libs/header-attrs-2.29/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.33/datatables.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="css/Font_Style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Lecture 7
]
.subtitle[
## Data Preprocessing
]
.author[
### Hu Chuan-Peng (PhD)
]
.institute[
### Nanjing Normal University
]
.date[
### 2025/04/02
]

---

class: center, middle
&lt;span style="font-size: 60px;"&gt;第七讲&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 50px;"&gt;Tidyverse数据预处理与函数&lt;/span&gt; &lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;胡传鹏&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;2025/04/02&lt;/span&gt; &lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
---
&lt;br&gt;
&lt;span style="font-size: 40px;"&gt;回顾：问卷数据的处理和实验数据的导入&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 40px;"&gt;问卷数据的处理&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp; Step1：选择变量[select]&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp; Step2：检查数据类型[glimpse, as族函数]&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp; Step3：处理缺失值[filter, is.na]&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp; Step4：反向计分[mutate, case_when]&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp; Step5：计算所需变量[mutate]&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp; Step6：分组求统计量 [group_by, summarise]
&lt;br&gt;
---
&lt;br&gt;
&lt;span style="font-size: 40px;"&gt;回顾：问卷数据的处理和实验数据的导入&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 40px;"&gt;实验数据的导入&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
- ## &lt;font size = 5.0&gt; (1) 找到所有要读取的文件名；&lt;/font&gt;
&lt;br&gt;
- ## &lt;font size = 5.0&gt; (2) 以文件名形成的向量为基础，使用for loop逐个文件进行操作;&lt;/font&gt;
&lt;br&gt;
- ## &lt;font size = 5.0&gt; (3) 将每次循环中读取的数据与之前已经读取的数据进行合并;&lt;/font&gt;
&lt;br&gt;
- ## &lt;font size = 5.0&gt; (4) 循环每个文件，直到全部读取完成，删除中间变量.&lt;/font&gt;
&lt;br&gt;
---
- 那么要如何利用for loop批量导入数据呢？&lt;br&gt;
      - (1) 找到所有要读取的文件名 --&gt; &lt;br&gt;
      - (2) 以文件名形成的向量为基础，使用for loop逐个文件进行操作 --&gt; &lt;br&gt;
      - (3) 将每次循环中读取的数据与之前已经读取的数据进行合并 --&gt; &lt;br&gt;
      - (4) 循环每个文件，直到全部读取完成，删除中间变量。


``` r
# 可以将清华的镜像设置为下载的镜像
# options(repos = c(CRAN = "https://mirrors.tuna.tsinghua.edu.cn/CRAN/"))
# 导入所需R包
library(tidyverse)
```

```
## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ readr     2.1.5
## ✔ forcats   1.0.0     ✔ stringr   1.5.1
## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
## ✔ purrr     1.0.2     
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
```


``` r
# 找到所有要读取的文件名
# 使用 full.names 参数获取完整路径的文件列表
files &lt;- list.files(here::here("data", "match"), pattern = "data_exp7_rep_match_.*\\.out$", full.names = TRUE)
```
*P.S.尽管函数叫list.files，但它得到的变量的属性是value，而不是list*

---
- # &lt;font size = 5.5&gt; 实验数据的导入  &lt;/font&gt;
- 定义函数用于数据类转换

``` r
# 定义函数用于数据类型转换，可以暂时不管
convert_data_types = function(df) {
  df &lt;- df %&gt;%
    dplyr::mutate(Date = as.character(Date),
                  Prac = as.character(Prac),
                  Sub = as.numeric(Sub),
                  Age = as.numeric(Age),
                  Sex = as.character(Sex),
                  Hand = as.character(Hand),
                  Block = as.numeric(Block),
                  Bin = as.numeric(Bin),
                  Trial = as.numeric(Trial),
                  Shape = as.character(Shape),
                  Label = as.character(Label),
                  Match = as.character(Match),
                  CorrResp = as.character(CorrResp),
                  Resp = as.character(Resp),
                  ACC = as.numeric(ACC),
                  RT = as.numeric(RT))
  return(df)
}
```

---
- # &lt;font size = 5.5&gt; 实验数据的导入  &lt;/font&gt;
- 建立并将数据存入数据框

``` r
# 创建一个空的数据框来存储读取的数据
df3 &lt;- data.frame()

# 循环读取每个文件，处理数据并添加到数据框中
for (i in seq_along(files)) { # 重复"读取到的.out个数"的次数
  # 读取数据文件
  df &lt;- read.table(files[i], header = TRUE) 
  # 使用 filter 函数过滤掉 Date 列值为 "Date" 的行
  df &lt;- dplyr::filter(df, Date != "Date") 
  # 调用函数进行数据类型转换
  df &lt;- convert_data_types(df)
  # 使用 bind_rows() 函数将当前数据框与之前的数据框合并
  df3 &lt;- dplyr::bind_rows(df3, df)
}

# 清除中间变量
rm(df, files, i)
```

---
- # &lt;font size = 5.5&gt; 实验数据的导入  &lt;/font&gt;
- 使用lapply也能完成批量导入与合并。lapply思维难度更高，但代码更简洁。&lt;br&gt;


``` r
# 获取所有的.out文件名
files &lt;- list.files(here::here("data", "match"), pattern = "data_exp7_rep_match_.*\\.out$", full.names = TRUE)

# 读取每个.out文件，并进行数据清洗
df3 &lt;- lapply(files, function(file) {
  df &lt;- read.table(file, header = TRUE)
  df &lt;- dplyr::filter(df, Date != "Date") # 过滤掉 Date 列值为 "Date" 的行
  df &lt;- mutate(df, 
               convert_data_types(df)
              ) # 进行数据类型转换和数据清洗
  return(df)
})

# 合并所有数据框
df3 &lt;- dplyr::bind_rows(df3)

# 清除中间变量
rm(files)
```
---
- # &lt;font size = 5.5&gt; 实验数据的导入  &lt;/font&gt;
- 保存合并的数据文件。&lt;br&gt;


``` r
write.csv(df3, 
          file = here::here("data", "match","match_raw.csv"),
          row.names = FALSE)
```
---
&lt;h1 lang="en" style="font-size: 60px;"&gt;Contents&lt;/h1&gt;
&lt;br&gt;
&lt;span style="font-size: 40px;"&gt;7.1 基于Tidyverse的数据预处理（续）&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;7.1.1 研究问题 &amp; 数据情况回顾&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;7.1.2 操作步骤 (tidyr)&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;7.1.3 小结 &lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 40px;"&gt;7.2 函数的概念与自定义函数&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;7.2.1 函数的概念与类别 &lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;7.2.2 调用函数 &lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;&amp;emsp;7.2.3 自定义函数 &lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;

---
# &lt;h1 lang="en"&gt;7.1 基于Tidyverse处理反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.1 问题 &amp; 数据&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
- 以[Hu et al.,2020](https://doi.org/10.1525/collabra.301)中的反应时数据作为示例&lt;br&gt;
&lt;br&gt;
- **研究问题**：探究人们对自我相关刺激的优先加工是否仅在某些条件下发生&lt;br&gt;
- **研究假设**：无论参与何种任务，与积极概念（好我）建立联结的自我形状会在反应时间和准确性上表现更快更准确&lt;br&gt;
&lt;img src="./picture/chp6/match.png" width="70%" style="display: block; margin-left: auto; margin-right: auto;"&gt;

---
# &lt;h1 lang="en"&gt;7.1 基于Tidyverse处理反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.1 问题 &amp; 数据&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
- **研究结果**：&lt;br&gt;
&lt;br&gt;
&lt;img src="./picture/chp6/mr.png" width="100%" style="display: block; margin-left: auto; margin-right: auto;"&gt;

---
# &lt;h1 lang="en"&gt;7.1 基于Tidyverse处理反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.1 问题 &amp; 数据&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
- 主要变量：&lt;br&gt;
Shape/Label: 屏幕呈现的图形代表的概念&lt;br&gt;
Match: 图形与呈现的标签是否匹配&lt;br&gt;
ACC: 被试的判断是否正确，1 = "正确", 0 = "错误", -1, 2表示未按键或按了两个键的情况，属于无效作答&lt;br&gt;
RT: 被试做出判断的反应时，[200,1500]的反应时纳入分析&lt;br&gt;

<div class="datatables html-widget html-fill-item" id="htmlwidget-54bd8acaf355768d0a6e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-54bd8acaf355768d0a6e">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6"],["02-May-2018_14:23:06","02-May-2018_14:23:08","02-May-2018_14:23:10","02-May-2018_14:23:13","02-May-2018_14:23:15","02-May-2018_14:23:17"],["Exp","Exp","Exp","Exp","Exp","Exp"],[7302,7302,7302,7302,7302,7302],[22,22,22,22,22,22],["female","female","female","female","female","female"],["R","R","R","R","R","R"],[1,1,1,1,1,1],[1,1,1,1,1,1],[1,2,3,4,5,6],["immoralSelf","moralOther","immoralOther","moralSelf","immoralSelf","immoralSelf"],["immoralOther","moralSelf","moralOther","immoralSelf","immoralSelf","immoralSelf"],["mismatch","mismatch","mismatch","mismatch","match","match"],["n","n","n","n","m","m"],["m","n","n",null,"m","m"],[0,1,1,-1,1,1],[0.7561,0.7043,0.9903,1.042,0.8207,0.7547]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Date<\/th>\n      <th>Prac<\/th>\n      <th>Sub<\/th>\n      <th>Age<\/th>\n      <th>Sex<\/th>\n      <th>Hand<\/th>\n      <th>Block<\/th>\n      <th>Bin<\/th>\n      <th>Trial<\/th>\n      <th>Shape<\/th>\n      <th>Label<\/th>\n      <th>Match<\/th>\n      <th>CorrResp<\/th>\n      <th>Resp<\/th>\n      <th>ACC<\/th>\n      <th>RT<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"columnDefs":[{"className":"dt-right","targets":[3,4,7,8,9,15,16]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Date","targets":1},{"name":"Prac","targets":2},{"name":"Sub","targets":3},{"name":"Age","targets":4},{"name":"Sex","targets":5},{"name":"Hand","targets":6},{"name":"Block","targets":7},{"name":"Bin","targets":8},{"name":"Trial","targets":9},{"name":"Shape","targets":10},{"name":"Label","targets":11},{"name":"Match","targets":12},{"name":"CorrResp","targets":13},{"name":"Resp","targets":14},{"name":"ACC","targets":15},{"name":"RT","targets":16}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
# &lt;h1 lang="en"&gt;7.1 基于Tidyverse处理反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤&lt;/span&gt;&lt;/center&gt;&lt;br&gt;
- **本课数据预处理目标**：计算Match-Moral条件下时RT的自我优势效应(SPE)。&lt;br&gt;

&amp;emsp;&amp;emsp; **Step1: 批量读取并合并数据[for loop] (已演示)**&lt;br&gt;
&amp;emsp;&amp;emsp; Step2: 选择变量[select]&lt;br&gt;
&amp;emsp;&amp;emsp; Step3: 处理缺失值[drop_na, filter]&lt;br&gt;
&amp;emsp;&amp;emsp; **Step4: 分实验条件计算变量[group_by, summarise]**&lt;br&gt;
&amp;emsp;&amp;emsp; **Step5: 拆分变量[extract, filter]**&lt;br&gt;
&amp;emsp;&amp;emsp; **Step6: 将长数据转为宽数据[pivot_wide]**&lt;br&gt;
&amp;emsp;&amp;emsp; Step7: 计算实验条件为Match-Moral时RT的自我优势效应[mutate, select]&lt;br&gt;

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step2: 选择变量[select]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;


``` r
# 选择我们需要的变量
df4 &lt;- dplyr::select(df3,
                     Sub, Age, Sex, Hand, #人口统计学
                     Block, Bin, Trial,   # 试次
                     Shape, Label, Match, # 刺激
                     Resp, ACC, RT)       # 反应结果
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-0ba186698393fc853c62" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0ba186698393fc853c62">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10"],[7302,7302,7302,7302,7302,7302,7302,7302,7302,7302],[22,22,22,22,22,22,22,22,22,22],["female","female","female","female","female","female","female","female","female","female"],["R","R","R","R","R","R","R","R","R","R"],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,2,3,4,5,6,7,8,9,10],["immoralSelf","moralOther","immoralOther","moralSelf","immoralSelf","immoralSelf","moralOther","moralSelf","moralOther","immoralSelf"],["immoralOther","moralSelf","moralOther","immoralSelf","immoralSelf","immoralSelf","moralOther","moralSelf","immoralSelf","moralOther"],["mismatch","mismatch","mismatch","mismatch","match","match","match","match","mismatch","mismatch"],["m","n","n",null,"m","m","m","m","n","n"],[0,1,1,-1,1,1,1,1,1,1],[0.7561,0.7043,0.9903,1.042,0.8207,0.7547,0.5429,0.9009,0.9550999999999999,0.6952]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Age<\/th>\n      <th>Sex<\/th>\n      <th>Hand<\/th>\n      <th>Block<\/th>\n      <th>Bin<\/th>\n      <th>Trial<\/th>\n      <th>Shape<\/th>\n      <th>Label<\/th>\n      <th>Match<\/th>\n      <th>Resp<\/th>\n      <th>ACC<\/th>\n      <th>RT<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,5,6,7,12,13]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Sub","targets":1},{"name":"Age","targets":2},{"name":"Sex","targets":3},{"name":"Hand","targets":4},{"name":"Block","targets":5},{"name":"Bin","targets":6},{"name":"Trial","targets":7},{"name":"Shape","targets":8},{"name":"Label","targets":9},{"name":"Match","targets":10},{"name":"Resp","targets":11},{"name":"ACC","targets":12},{"name":"RT","targets":13}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step3: 处理缺失值[drop_na, filter]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;


``` r
# 删除缺失值，选择符合标准的被试
df4 &lt;- tidyr::drop_na(df4) # 删除含有缺失值的行
df4 &lt;- dplyr::filter(df4, Hand == "R",      # 选择右利手被试
                    ACC == 0 | ACC == 1 ,   # 排除无效应答（ACC = -1 OR 2)
                    RT &gt;= 0.2 &amp; RT &lt;= 1.5)  # 选择RT属于[200,1500]
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-b5e412fb539805225b0a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b5e412fb539805225b0a">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302],[22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22],["female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female","female"],["R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,1],["immoralSelf","moralOther","immoralOther","immoralSelf","immoralSelf","moralOther","moralSelf","moralOther","immoralSelf","moralOther","immoralOther","moralOther","moralSelf","immoralOther","immoralSelf","moralSelf","moralSelf","immoralSelf","moralOther","immoralOther","moralSelf","immoralOther","immoralOther","moralSelf"],["immoralOther","moralSelf","moralOther","immoralSelf","immoralSelf","moralOther","moralSelf","immoralSelf","moralOther","moralSelf","immoralOther","moralOther","immoralSelf","immoralOther","moralSelf","immoralSelf","moralSelf","immoralSelf","moralOther","moralOther","moralSelf","immoralOther","moralOther","moralSelf"],["mismatch","mismatch","mismatch","match","match","match","match","mismatch","mismatch","mismatch","match","match","mismatch","match","mismatch","mismatch","match","match","match","mismatch","match","match","mismatch","match"],["m","n","n","m","m","m","m","n","n","n","m","m","m","m","n","n","m","n","m","n","m","m","n","m"],[0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1],[0.7561,0.7043,0.9903,0.8207,0.7547,0.5429,0.9009,0.9550999999999999,0.6952,0.7593,0.7135,0.5656,0.5357,0.8078,0.96,0.6661,0.6962,0.8803,0.5785,0.7845,0.8146,0.6548,0.8789,0.7131]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Age<\/th>\n      <th>Sex<\/th>\n      <th>Hand<\/th>\n      <th>Block<\/th>\n      <th>Bin<\/th>\n      <th>Trial<\/th>\n      <th>Shape<\/th>\n      <th>Label<\/th>\n      <th>Match<\/th>\n      <th>Resp<\/th>\n      <th>ACC<\/th>\n      <th>RT<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,5,6,7,12,13]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Sub","targets":1},{"name":"Age","targets":2},{"name":"Sex","targets":3},{"name":"Hand","targets":4},{"name":"Block","targets":5},{"name":"Bin","targets":6},{"name":"Trial","targets":7},{"name":"Shape","targets":8},{"name":"Label","targets":9},{"name":"Match","targets":10},{"name":"Resp","targets":11},{"name":"ACC","targets":12},{"name":"RT","targets":13}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step4: 分条件描述[group_by, summarise]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;


``` r
# 分实验条件计算
df4 &lt;- dplyr::group_by(df4, Sub, Shape, Label, Match)
df4 &lt;- dplyr::summarise(df4, mean_ACC = mean(ACC), mean_RT = mean(RT))
df4 &lt;- dplyr::ungroup(df4)
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-3be0a54491ab8d4c83da" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3be0a54491ab8d4c83da">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7302,7303,7303,7303,7303,7303,7303,7303,7303],["immoralOther","immoralOther","immoralOther","immoralOther","immoralSelf","immoralSelf","immoralSelf","immoralSelf","moralOther","moralOther","moralOther","moralOther","moralSelf","moralSelf","moralSelf","moralSelf","immoralOther","immoralOther","immoralOther","immoralOther","immoralSelf","immoralSelf","immoralSelf","immoralSelf"],["immoralOther","immoralSelf","moralOther","moralSelf","immoralOther","immoralSelf","moralOther","moralSelf","immoralOther","immoralSelf","moralOther","moralSelf","immoralOther","immoralSelf","moralOther","moralSelf","immoralOther","immoralSelf","moralOther","moralSelf","immoralOther","immoralSelf","moralOther","moralSelf"],["match","mismatch","mismatch","mismatch","mismatch","match","mismatch","mismatch","mismatch","mismatch","match","mismatch","mismatch","mismatch","mismatch","match","match","mismatch","mismatch","mismatch","mismatch","match","mismatch","mismatch"],[0.8888888888888888,0.7857142857142857,0.9333333333333333,1,0.7058823529411765,0.8636363636363635,1,0.9166666666666666,0.7777777777777778,1,0.9555555555555556,1,0.9230769230769231,0.5,0.7777777777777778,0.8863636363636364,0.7777777777777778,0.875,0.8666666666666667,0.9285714285714286,0.7647058823529411,0.711111111111111,0.8666666666666667,0.6923076923076923],[0.6717288888888889,0.7355285714285714,0.7479333333333333,0.7298153846153846,0.7260058823529412,0.7123159090909091,0.697,0.822175,0.6578833333333334,0.7552615384615384,0.60298,0.7282857142857143,0.7412384615384615,0.7712333333333333,0.7380944444444445,0.697540909090909,0.7167022222222222,0.74600625,0.7791133333333333,0.7363214285714286,0.7959352941176471,0.7246755555555555,0.7592333333333333,0.7829307692307692]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Shape<\/th>\n      <th>Label<\/th>\n      <th>Match<\/th>\n      <th>mean_ACC<\/th>\n      <th>mean_RT<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Sub","targets":1},{"name":"Shape","targets":2},{"name":"Label","targets":3},{"name":"Match","targets":4},{"name":"mean_ACC","targets":5},{"name":"mean_RT","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step4: 分条件描述[group_by, summarise]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;
- group_by和summarise函数&lt;br&gt;
&amp;emsp;group_by：定义分组变量&lt;br&gt;
&amp;emsp;summarise：通过与mean、median等函数协作，对变量进行汇总&lt;br&gt;
![dplyr_pic1](picture/chp6/dplyr_pic1.png)

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step4: 分条件描述[group_by, summarise]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;
- group_by和summarise函数&lt;br&gt;
&amp;emsp;group_by+summarise：对各组变量进行汇总&lt;br&gt;
![dplyr_pic2](picture/chp6/dplyr_pic2.png)

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step5: 拆分变量[extract, filter]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;


``` r
# 将Shape变量拆分
df4 &lt;- tidyr::extract(df4, Shape, into = c("Valence", "Identity"),
                      regex = "(moral|immoral)(Self|Other)", remove = FALSE)
df4 &lt;- dplyr::filter(df4, Match == "match" &amp; Valence == "moral") 
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-413ab80e74fe024b8278" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-413ab80e74fe024b8278">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7302,7303,7303,7304,7304,7305,7305,7306,7306,7307,7307,7308,7308,7309,7309,7310,7310,7311,7311,7312,7312,7313,7313],["moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf"],["moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral","moral"],["Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self","Other","Self"],["moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf","moralOther","moralSelf"],["match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match","match"],[0.9555555555555556,0.8863636363636364,0.8863636363636364,0.9333333333333333,0.8333333333333333,0.9866666666666667,0.9333333333333333,0.9324324324324325,0.9866666666666667,0.7972972972972973,0.8266666666666667,0.8888888888888888,0.8918918918918919,0.9466666666666667,0.76,0.9459459459459459,0.96,0.96,0.92,0.8533333333333333,0.7361111111111113,0.9864864864864865,0.6338028169014085,0.4109589041095889],[0.60298,0.697540909090909,0.7167772727272728,0.6557266666666667,0.7493875,0.552276,0.5991426666666667,0.588072972972973,0.5805133333333333,0.7772581081081081,0.703596,0.6617236111111111,0.7399135135135135,0.623512,0.6938013333333334,0.6045945945945946,0.5399080000000001,0.570092,0.5290586666666667,0.5445226666666667,0.7493319444444444,0.6192027027027027,0.5500957746478873,0.5352452054794521]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Shape<\/th>\n      <th>Valence<\/th>\n      <th>Identity<\/th>\n      <th>Label<\/th>\n      <th>Match<\/th>\n      <th>mean_ACC<\/th>\n      <th>mean_RT<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Sub","targets":1},{"name":"Shape","targets":2},{"name":"Valence","targets":3},{"name":"Identity","targets":4},{"name":"Label","targets":5},{"name":"Match","targets":6},{"name":"mean_ACC","targets":7},{"name":"mean_RT","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step5: 拆分变量[extract, filter]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;
- extract函数&lt;br&gt;
&amp;emsp; extract(data = data, col = x1, into = c("x1a", "x1b"),regex = "([[:alnum:]]+)-([[:alnum:]]+)")
![dplyr_pic3](picture/chp6/dplyr_pic3.png)

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step6: 将数据长转宽[pivot_wide]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;

``` r
# 将长数据转为宽数据
df4 &lt;- dplyr::select(df4, Sub, Identity, mean_RT)
df4 &lt;- tidyr::pivot_wider(df4, names_from = "Identity", values_from = "mean_RT")
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-112b8c3affb7457d501e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-112b8c3affb7457d501e">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7303,7304,7305,7306,7307,7308,7309,7310,7311,7312,7313,7314,7315,7316,7317,7318,7319,7321,7322,7323,7324,7325,7326],[0.60298,0.7167772727272728,0.7493875,0.5991426666666667,0.5805133333333333,0.703596,0.7399135135135135,0.6938013333333334,0.5399080000000001,0.5290586666666667,0.7493319444444444,0.5500957746478873,0.699122972972973,0.6574680555555555,0.706812,0.8046028571428572,0.6787253333333333,0.739204,0.6298386666666667,0.6224260273972603,0.7255148648648648,0.8345594202898551,0.64298,0.5947810810810811],[0.697540909090909,0.6557266666666667,0.552276,0.588072972972973,0.7772581081081081,0.6617236111111111,0.623512,0.6045945945945946,0.570092,0.5445226666666667,0.6192027027027027,0.5352452054794521,0.7473794520547945,0.4947851351351351,0.6139613333333334,0.7520785714285714,0.6541418918918919,0.6909533333333333,0.6113506849315068,0.7169767123287671,0.6991608108108108,0.7507830985915493,0.58462,0.637777027027027]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Other<\/th>\n      <th>Self<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Sub","targets":1},{"name":"Other","targets":2},{"name":"Self","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 | Step6: 将数据长转宽[pivot_wide]&lt;/span&gt;&lt;/center&gt;&lt;br&gt;
- pivot_wide函数&lt;br&gt;
&amp;emsp; pivot_wider(names_from = var1, values_from = var2)&lt;br&gt;
&amp;emsp; names_from：其值将用作列名称的列&lt;br&gt;
&amp;emsp; values_from：其值将用作单元格值的列&lt;br&gt;
![dplyr_pic4](picture/chp6/dplyr_pic4.png)

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤 &lt;/span&gt;&lt;/center&gt;&lt;br&gt;

``` r
# 计算SPE
df4 &lt;- dplyr::mutate(df4, moral_SPE = Self - Other)
df4 &lt;- dplyr::select(df4, Sub, moral_SPE) 
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-e49c7308baa304ed03c3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e49c7308baa304ed03c3">{"x":{"filter":"none","vertical":false,"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[7302,7303,7304,7305,7306,7307,7308,7309,7310,7311,7312,7313,7314,7315,7316,7317,7318,7319,7321,7322,7323,7324,7325,7326],[0.09456090909090908,-0.06105060606060608,-0.1971115,-0.01106969369369371,0.1967447747747748,-0.04187238888888889,-0.1164015135135136,-0.08920673873873874,0.03018399999999999,0.01546400000000003,-0.1301292417417417,-0.01485056916843519,0.04825647908182151,-0.1626829204204204,-0.09285066666666664,-0.0525242857142858,-0.02458344144144142,-0.04825066666666666,-0.01848798173515986,0.09455068493150687,-0.026354054054054,-0.08377632169830573,-0.05835999999999997,0.04299594594594591]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>moral_SPE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Sub","targets":1},{"name":"moral_SPE","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.2 操作步骤&lt;/span&gt;&lt;/center&gt;&lt;br&gt;

``` r
# 用管道操作符合并以上代码
df4 &lt;- df3 %&gt;%
  dplyr::select(Sub, Age, Sex, Hand, #人口统计学
                Block, Bin, Trial,   # 试次
                Shape, Label, Match, # 刺激
                Resp, ACC, RT) %&gt;%  # 反应结果
  tidyr::drop_na() %&gt;%               #删除缺失值
  dplyr::filter(Hand == "R",         # 选择右利手被试
                ACC == 0 | ACC == 1, # 排除无效应答（ACC = -1 OR 2)
                RT &gt;= 0.2 &amp; RT &lt;= 1.5) %&gt;%  # 选择RT属于[200,1500]
  dplyr::group_by(Sub,Shape, Label, Match) %&gt;%
  dplyr::summarise(mean_ACC = mean(ACC), mean_RT = mean(RT)) %&gt;%
  dplyr::ungroup() %&gt;%
  tidyr::extract(Shape, into = c("Valence", "Identity"),
              regex = "(moral|immoral)(Self|Other)", remove = FALSE) %&gt;%
  dplyr::filter(Match == "match" &amp; Valence == "moral") %&gt;%
  dplyr::select(Sub, Identity, mean_RT) %&gt;%
  tidyr::pivot_wider(names_from="Identity", values_from="mean_RT") %&gt;%
  dplyr::mutate(moral_SPE=Self - Other)
```
---
# &lt;h1 lang="en"&gt;7.1 反应时数据&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;7.1.3 小结&lt;/span&gt;&lt;/center&gt;&lt;br&gt;
&lt;br&gt;
- separate() 把一个变量的单元格内的字符串拆成两份，变成两个变量 &lt;br&gt;
  **更适合用于按固定分隔符分割字符串，如将“2022-02-25”分成“2022”、“02”和“25”三列** &lt;br&gt;
  
- extract() 类似于separate &lt;br&gt;
  **更适合用于从字符串中提取特定的信息，如将“John Smith”分成“John”和“Smith”两列** &lt;br&gt;
  
- unite() 把多个列（字符串）整合为一列 &lt;br&gt;

- pivot_longer() 把宽数据转化为长数据 &lt;br&gt;

- pivot_wider() 把长数据转化为宽数据 &lt;br&gt;   
  
- drop_na() 删除缺失值

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.1 什么是函数
&lt;font size=5&gt;
&amp;emsp;&amp;emsp;sqrt()、getwd()、here()、mean()等都是R中的函数。
&lt;br&gt;
&amp;emsp;&amp;emsp;在R中，函数是一种用于执行特定任务或计算的代码块。函数接受输入参数，执行特定的操作，并返回结果。
&lt;/font&gt;
&lt;br&gt;

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.1 函数分类
&lt;font size=5&gt;
已有函数&lt;br&gt;
&amp;emsp;&amp;emsp;R base; &lt;br&gt;
&amp;emsp;&amp;emsp;R packages; &lt;br&gt;
&amp;emsp;&amp;emsp;functions from other sources&lt;br&gt;
&lt;font size=5&gt;
自定义函数&lt;br&gt;
&amp;emsp;&amp;emsp;自己命名和创建函数

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.2 函数调用
&lt;font size=5&gt;
-首先需要下载函数所在的R包（部分R包在下载R时已经自动下载）&lt;br&gt;
&amp;emsp;&amp;emsp;install.pcakages("R包名称")&lt;br&gt;
-然后需要加载R包&lt;br&gt;
&amp;emsp;&amp;emsp;library(R包名称)&lt;br&gt;
-已下载的R包，也可以直接 R包::函数名称 来调用函数&lt;br&gt;

-不同的R包中可能会有相同的函数名，为了避免调用错误，推荐使用：R包::函数名称&lt;br&gt;

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.2 函数调用
![error4](./picture/chp5/error4.png)
&lt;font size = 5&gt;
未加载时不能直接调用函数
--


``` r
here::here()#::左边的here指名为here的R包，::右边的here指这个包中名为here的函数
```

```
## [1] "/Users/hcp4715/Library/CloudStorage/OneDrive-Personal/Teaching/R_course/R4Psy"
```

``` r
library(here)
```

```
## here() starts at /Users/hcp4715/Library/CloudStorage/OneDrive-Personal/Teaching/R_course/R4Psy
```

``` r
here()
```

```
## [1] "/Users/hcp4715/Library/CloudStorage/OneDrive-Personal/Teaching/R_course/R4Psy"
```

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.2 函数调用


``` r
df.pg.raw &lt;- utils::read.csv(file = './data/penguin/penguin_rawdata.csv',
                       header = T, 
                       sep=",",
                       stringsAsFactors = FALSE) 
```

&amp;emsp;&amp;emsp;`df.pg.raw` 变量名 &lt;br&gt;
&amp;emsp;&amp;emsp;`utils` 函数所在的R包 &lt;br&gt;
&amp;emsp;&amp;emsp;`read.csv` 函数名 &lt;br&gt;
&amp;emsp;&amp;emsp;`file` 参数：文件路径 &lt;br&gt;
&amp;emsp;&amp;emsp;`header` 参数：是否将第一行作为列名 &lt;br&gt;
&amp;emsp;&amp;emsp;`sep` 参数：指定分隔符 &lt;br&gt;
&amp;emsp;&amp;emsp;`stringsAsFactors` 参数：是否将字符型数据转化为因子 &lt;br&gt;

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.3 自定义函数
&lt;font size = 5&gt;
函数定义通常由以下几个部分组成：&lt;br&gt;
&amp;emsp;-函数名: 为函数指定一个唯一的名称，以便在调用时使用。&lt;br&gt;
&amp;emsp;-参数: 定义函数接受的输入值。参数是可选的，可以有多个。&lt;br&gt;
&amp;emsp;-函数体: 包含实际执行的代码块，用大括号 {} 括起来。&lt;br&gt;
&amp;emsp;-返回值: 指定函数的输出结果，使用关键字`return`。&lt;br&gt;
--


``` r
# 定义一个函数：输入x和y，返回3倍x和5倍y的和
mysum &lt;- function(x,y){
  result = 3*x+5*y
  return(result)
}
# mysum: 自定义的函数名
# x,y:  形式参数
# result = 3*x+5*y: 函数体
# return(result): 返回值

#调用函数,x=1,y=2
mysum(1, 2)
```

```
## [1] 13
```

``` r
mysum(y=1, x=2)
```

```
## [1] 11
```

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.3 自定义函数（小练习）
&lt;font size = 5&gt;
- 小练习: 定义一个函数, 输入值a, b, c, 返回`(a+b)/c`。计算a = 1, b = 2, c = 3时返回的值&lt;br&gt;


``` r
# 自定义函数：计算 (a+b)/c
# myabc &lt;- ***{
  # result = ****
  # return(result)}

# 计算abc分别为1,2,3时的值
#myabc(1, 2, 3)  # 结果：1

#用合理的代码替换以上“***”,删除每行前的“#”,即可运行
```

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.3 自定义函数
&lt;font size = 5&gt;
&lt;br&gt;我们定义的函数mysum需要输入x和y两个值，如果只输入一个会怎么样。
--
![error7](./picture/chp5/error7.png)
--
&lt;font size = 5&gt;
&lt;br&gt;在使用bruceR::import时，我们并没有输入所有参数，它依然可以运行，是因为它有默认值。


``` r
mysum2 &lt;- function(x = 6,y = 7){
  result = 3*x+5*y
  return(result)
}
mysum2()
```

```
## [1] 53
```

``` r
mysum2(5)
```

```
## [1] 50
```
---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.3 自定义函数(小练习)
&lt;font size = 5&gt;
- 小练习：&lt;br&gt;
&amp;emsp;1 定义一个函数, 输入值a, b, c, 返回`(a+b)/c`。&lt;br&gt;
**&amp;emsp;2 设置a、b、c的默认值为3、2、1&lt;br&gt;**
- 通过这个练习，你将学习如何为函数添加默认值


``` r
# myabc &lt;- function(a = ***, b = ***, c = ***){
#   result = ***
#   return(***)
# }
# myabc(***)

# 用合理的代码替换以上“***”,删除每行前的“#”,即可运行
```

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.3 自定义函数
&lt;font size = 5&gt;
在学习数据类型时，我们提到字符型不能进行加减乘除等数学运算&lt;br&gt;
--
![error8](./picture/chp5/error8.png)
--
&lt;font size = 5&gt;
自定义函数时可以手动添加报错信息。&lt;br&gt;
只有在输入的内容符合要求时才可以正常运行，否则报错。&lt;br&gt;
此处判断是否符合要求本质上是一种逻辑判断。&lt;br&gt;
--
![if-else](./picture/chp5/if-else.png)
---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.3 自定义函数

``` r
mysum3 &lt;- function(x = 6,y = 7){
  if(is.numeric(x) &amp; is.numeric(y)){
    result = 3*x+5*y
    return(result)}
  else{print("x and y must be number")}
}
# print：输出指定的内容
# is.numeric:判断是否为数值型。是则返回T，否则返回F
# &amp; : 表示“且”
mysum3(5,6)
```

```
## [1] 45
```

``` r
mysum3('a','b')
```

```
## [1] "x and y must be number"
```

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.3 自定义函数(小练习)
&lt;font size = 5&gt;
- 小练习：&lt;br&gt;
&amp;emsp;1 定义一个函数,输入值a,b,c,返回(a+b)/c;&lt;br&gt;
&amp;emsp;2 设置a、b、c的默认值为3、2、1;&lt;br&gt;
**&amp;emsp;当c为0时报错“c should not be 0”**
- 通过这个练习，你将学习如何为函数添加报错信息


``` r
#myabc &lt;- function(***){
#  if(***){
#    result = ***
#    return(***)
#  }
#  else{print(***)}
#}

#用合理的代码替换以上“***”,删除每行前的“#”,即可运行
```

---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
## 7.2.3 自定义函数(小练习)

``` r
#示例
myabc &lt;- function(a = 3, b = 2, c = 1){
  if(c!=0){
    result = (a+b)/c
    return(result)
  }
  else{print('c should not be 0')}
}
```
---
# &lt;h1 lang="zh-CN"&gt;7.2 函数&lt;/h1&gt;
- 函数在数据处理种的运用

``` r
convert_data_types = function(df) {
  df &lt;- df %&gt;%
    dplyr::mutate(Date = as.character(Date),
                  Prac = as.character(Prac),
                  Sub = as.numeric(Sub),
                  Age = as.numeric(Age),
                  Sex = as.character(Sex),
                  Hand = as.character(Hand),
                  Block = as.numeric(Block),
                  Bin = as.numeric(Bin),
                  Trial = as.numeric(Trial),
                  Shape = as.character(Shape),
                  Label = as.character(Label),
                  Match = as.character(Match),
                  CorrResp = as.character(CorrResp),
                  Resp = as.character(Resp),
                  ACC = as.numeric(ACC),
                  RT = as.numeric(RT))
  return(df)
}
```

---
# &lt;h1 lang="en"&gt;7.2 函数&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;综合练习&lt;/span&gt;&lt;/center&gt;&lt;br&gt;

- 定义一个函数用于计算$d'$ 

- 计算不同Shape情况下(immoralself，moralself，immoralother，moralother)&lt;br&gt; 基于信号检测论(match为信号，mismatch噪音)的$d'$
&lt;br&gt;

提示：&lt;br&gt; 
- (1) `\(d′\)` = `\({Z_{击中率}−Z_{虚报率}}\)` = `\(\frac{M_{SN}-M_N}{\sigma_N}\)` &lt;br&gt;&lt;br&gt;
- (2) `\(击中率\)` = `\(\frac{击中次数}{信号总次数}\)` &lt;br&gt;&lt;br&gt;
- (3) `\(虚报率\)` = `\(\frac{虚报次数}{噪音总次数}\)` 
&lt;br&gt;

---
- 1 以下是计算击中(hit)、虚报(fa)、漏报(miss)和正确否定(cr)的代码&lt;br&gt;

``` r
# 去掉下面#的部分，将***替换成合适的变量，补全代码
dplyr::summarise(
      # *** = length(ACC[Match == "match" &amp; ACC == 1]),
      # *** = length(ACC[Match == "mismatch" &amp; ACC == 0]),
      # *** = length(ACC[Match == "match" &amp; ACC == 0]),
      # *** = length(ACC[Match == "mismatch" &amp; ACC == 1]),
```
- 2 可以使用正态分布的累积分布函数（qnorm）来计算 `\(d′\)` 值，以下为代码&lt;br&gt;

``` r
        Dprime = qnorm(
        ifelse(hit / (hit + miss) &lt; 1,
               hit / (hit + miss),        # 击中率
               1 - 1 / (2 * (hit + miss)) # 避免击中率为1时的极端情况
              )
        ) 
             - qnorm(
        ifelse(fa / (fa + cr) &gt; 0,
              fa / (fa + cr),     # 虚报率
              1 / (2 * (fa + cr)) # 避免虚报率为0时的极端情况
              )
                    )
      ) 
```
---
# &lt;h1 lang="en"&gt;7.2 函数&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;综合练习&lt;/span&gt;&lt;/center&gt;&lt;br&gt;
- **练习思路**&lt;br&gt;
&lt;br&gt;
Step1: 选择需要的变量 &lt;br&gt;
&lt;br&gt;
Step2: 基于Sub, Shape分组[extract,filter] &lt;br&gt;
&lt;br&gt;
Step3: 使用计算公式，计算d'值 &lt;br&gt;
&lt;br&gt;
Step4: 删除击中、虚报、误报、正确拒绝四个不需要的变量 &lt;br&gt;
&lt;br&gt;
Step5: 长转宽，得到每个Shape情况下的信号检测论d值[pivot_wide] &lt;br&gt;

---
# &lt;h1 lang="en"&gt;7.2 函数&lt;/h1&gt;
&lt;span style="font-size: 30px;"&gt;综合练习&lt;/span&gt;&lt;/center&gt;&lt;br&gt;
- **答案参考**&lt;br&gt;
&lt;br&gt;
&lt;img src="./picture/chp6/answer.png" width="100%" style="display: block; margin-left: auto; margin-right: auto;"&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>chapter_12.knit</title>
    <meta charset="utf-8" />
    <meta name="author" content="Pac_B" />
    <script src="libs/header-attrs-2.25/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.32/datatables.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="css/Custumed_Style.css" type="text/css" />
    <link rel="stylesheet" href="css/zh-CN.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: center, middle
&lt;span style="font-size: 60px;"&gt;**ç¬¬åäºŒç« **&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 50px;"&gt;å¦‚ä½•å¾—åˆ°å¯å‘è¡¨çš„å›¾åƒ&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 50px;"&gt;æ•°æ®å¯è§†åŒ–è¿›é˜¶&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;èƒ¡ä¼ é¹&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 20px;"&gt; &lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;2024-05-21&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 20px;"&gt; Made with Rmarkdown&lt;/span&gt; &lt;br&gt;



&lt;style type="text/css"&gt;
/* ---- extra.css ---- */
.bigfont {
  font-size: 30px;
}
.size5{
font-size: 20px;
}
.tit_font{
font-size: 60px;
}

&lt;/style&gt;



---

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.pull-left[

# ä¸ºä»€ä¹ˆè¦ä½œå›¾ï¼Ÿ

- â€œä¸€å›¾èƒœåƒè¨€â€

- ä¿¡æ¯ä¼ é€’çš„ç›´è§‚æ€§


# ç”¨ä»€ä¹ˆåšå›¾ï¼Ÿ

- ggplot 2

]

.pull-right[

# æ€ä¹ˆç”»å¥½ä¸€å¼ å›¾ï¼Ÿ

- æ˜ç¡®æƒ³è¦å¾—åˆ°çš„å›¾åƒ

- â€œä¿¡è¾¾é›…â€
  - ä¿¡æ¯é‡
  - é€»è¾‘æ€§
  - ç¾è§‚ï¼ˆç®€æ´ã€å¯¹ç§°ã€å’Œè°ï¼‰

]

---
.panelset[
.panel[.panel-name[Packages]

```r
if (!requireNamespace('pacman', quietly = TRUE)) {
    install.packages('pacman')
}


pacman::p_load(
  # æœ¬èŠ‚è¯¾éœ€è¦ç”¨åˆ°çš„ packages
  here, tidyverse, reshape, bruceR, ggplot2, patchwork, magick,
  # ç”Ÿæˆè¯¾ä»¶
  xaringan, xaringanthemer, xaringanExtra, knitr)

options(scipen=99999,digits = 5)
```

.panel[.panel-name[trial data]

```r
df.match.trial &lt;- bruceR::import(here::here('data','match','match_raw.csv')) %&gt;% 
  tidyr::extract(Shape, 
                 into = c('Valence', 'Identity'),
                 regex = '(moral|immoral)(Self|Other)',
                 remove = FALSE) %&gt;% #å°†Shapeåˆ—åˆ†ä¸ºä¸¤åˆ—
  dplyr::mutate(Valence = factor(Valence, levels = c('moral','immoral'), labels = c('moral','immoral')),
                Identity = factor(Identity, levels = c('Self','Other'), labels = c('Self','Other'))) %&gt;%
  dplyr::filter(ACC == 0 | ACC == 1, 
                RT &gt;= 0.2 &amp; RT &lt;= 1.5,
                Match == 'match',
                (!Sub %in% c(7302,7303,7338))) 
```
<div class="datatables html-widget html-fill-item" id="htmlwidget-f55263ddb93de4108b1d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f55263ddb93de4108b1d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],["06-May-2018_14:45:42","06-May-2018_14:45:44","06-May-2018_14:45:50","06-May-2018_14:45:53"],["Exp","Exp","Exp","Exp"],[7304,7304,7304,7304],[25,25,25,25],["female","female","female","female"],["R","R","R","R"],[1,1,1,1],[1,1,1,1],[3,4,7,8],["moralOther","immoralOther","moralSelf","immoralOther"],["moral","immoral","moral","immoral"],["Other","Other","Self","Other"],["moralOther","immoralOther","moralSelf","immoralOther"],["match","match","match","match"],["n","n","n","n"],["n","m","n","m"],[1,0,1,0],[0.8167,0.8728,0.4951,0.8713]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Date<\/th>\n      <th>Prac<\/th>\n      <th>Sub<\/th>\n      <th>Age<\/th>\n      <th>Sex<\/th>\n      <th>Hand<\/th>\n      <th>Block<\/th>\n      <th>Bin<\/th>\n      <th>Trial<\/th>\n      <th>Shape<\/th>\n      <th>Valence<\/th>\n      <th>Identity<\/th>\n      <th>Label<\/th>\n      <th>Match<\/th>\n      <th>CorrResp<\/th>\n      <th>Resp<\/th>\n      <th>ACC<\/th>\n      <th>RT<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,7,8,9,17,18]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Date","targets":1},{"name":"Prac","targets":2},{"name":"Sub","targets":3},{"name":"Age","targets":4},{"name":"Sex","targets":5},{"name":"Hand","targets":6},{"name":"Block","targets":7},{"name":"Bin","targets":8},{"name":"Trial","targets":9},{"name":"Shape","targets":10},{"name":"Valence","targets":11},{"name":"Identity","targets":12},{"name":"Label","targets":13},{"name":"Match","targets":14},{"name":"CorrResp","targets":15},{"name":"Resp","targets":16},{"name":"ACC","targets":17},{"name":"RT","targets":18}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

.panel[.panel-name[subj data]

```r
df.match.subj &lt;- df.match.trial %&gt;%
  dplyr::group_by(Sub, Identity, Valence) %&gt;%
  dplyr::summarise(RT_mean = mean(RT), 
                   ACC_mean = mean(ACC)) %&gt;%
  dplyr::ungroup()
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-b19a9f216e4539f7ba81" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b19a9f216e4539f7ba81">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],[7304,7304,7304,7304],["Self","Self","Other","Other"],["moral","immoral","moral","immoral"],[0.552276,0.706672602739726,0.7493875,0.7581492957746478],[0.9866666666666667,0.821917808219178,0.8333333333333334,0.7183098591549296]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sub<\/th>\n      <th>Identity<\/th>\n      <th>Valence<\/th>\n      <th>RT_mean<\/th>\n      <th>ACC_mean<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Sub","targets":1},{"name":"Identity","targets":2},{"name":"Valence","targets":3},{"name":"RT_mean","targets":4},{"name":"ACC_mean","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

.panel[.panel-name[sum data]

```r
df.match.sum &lt;- df.match.subj %&gt;% 
  dplyr::group_by(Identity, Valence) %&gt;%
  dplyr::summarise(grand_mean_RT = mean(RT_mean),
                   SD_RT = sd(RT_mean),
                   SE_RT = SD_RT/sqrt(n()-1),
                   grand_mean_ACC = mean(ACC_mean),
                   SD_ACC = sd(ACC_mean),
                   SE_ACC = SD_ACC/sqrt(n()-1),
                   n = n()) %&gt;%
  dplyr::ungroup()
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-ae86a48f52716929f35d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ae86a48f52716929f35d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],["Self","Self","Other","Other"],["moral","immoral","moral","immoral"],[0.6366372764212784,0.7150271256631987,0.6850132435574973,0.6996564845828235],[0.06334254097700114,0.06957103122069196,0.07816459938618592,0.0695041721958588],[0.01001533511349354,0.01100014589120355,0.01235890832274734,0.01098957455117302],[0.9161836748531289,0.8142527831854576,0.8440248488102073,0.828686850170307],[0.0980144792704873,0.1197130892135965,0.1095526473381531,0.1107136186340657],[0.01549744990850493,0.01892830138249502,0.01732179446448731,0.01750536014414538],[41,41,41,41]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Identity<\/th>\n      <th>Valence<\/th>\n      <th>grand_mean_RT<\/th>\n      <th>SD_RT<\/th>\n      <th>SE_RT<\/th>\n      <th>grand_mean_ACC<\/th>\n      <th>SD_ACC<\/th>\n      <th>SE_ACC<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,7,8,9]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Identity","targets":1},{"name":"Valence","targets":2},{"name":"grand_mean_RT","targets":3},{"name":"SD_RT","targets":4},{"name":"SE_RT","targets":5},{"name":"grand_mean_ACC","targets":6},{"name":"SD_ACC","targets":7},{"name":"SE_ACC","targets":8},{"name":"n","targets":9}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

]]]]]

---

&lt;br&gt;
&lt;br&gt;
&lt;h1 lang="en" style="font-size: 60px;"&gt;Contents&lt;/h1&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 45px;"&gt;12.1 ggplot2åŸºç¡€&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 45px;"&gt;12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 45px;"&gt;12.3 é«˜çº§å›¾ç‰‡å¤„ç†â€”â€”magick&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;

---
class: center, middle
&lt;span style="font-size: 60px;"&gt;12.1 ggplot2åŸºç¡€&lt;/span&gt; &lt;br&gt;

---
# 12.1 ggplot2åŸºç¡€
## ä»€ä¹ˆæ˜¯ggplot

&lt;img src="./picture/chp12/ggplot.png" width="70%" style="display: block; margin: auto;" /&gt;

---
# 12.1 ggplot2åŸºç¡€
## å›¾å±‚å åŠ 
&lt;img src="./picture/chp12/gramma.png" width="65%" style="display: block; margin: auto;" /&gt;
- å’ŒPSç±»ä¼¼ï¼Œé‡‡ç”¨å›¾å±‚çš„è®¾è®¡æ–¹å¼ï¼›
- å›¾å±‚ä¹‹é—´çš„å åŠ æ˜¯é  â€œ+â€ å®ç°çš„ï¼Œè¶Šå¾€åï¼Œå…¶å›¾å±‚è¶Šåœ¨ä¸Šæ–¹ï¼›
- æœ‰æ˜ç¡®çš„èµ·å§‹ï¼ˆggplot()å¼€å§‹ï¼‰ä¸ç»ˆæ­¢ï¼›
- æœ‰å¿…é¡»çš„å›¾å±‚

---
# 12.1 ggplot2åŸºç¡€
## å¿…é¡»å›¾å±‚
![](./picture/chp12/required.png)


```r
# ä»¥æŸ±çŠ¶å›¾ä¸ºä¾‹
p1 &lt;- ggplot2::ggplot(data = df.match.sum, aes(x = Identity, y = grand_mean_RT, fill = Valence)) +
  ggplot2::geom_bar(stat = "Identity",
                    position = "dodge") +
  ggplot2::geom_errorbar(data = df.match.sum,
                         aes(ymin = grand_mean_RT - SE_RT, ymax = grand_mean_RT + SE_RT),
                         width=.1,
                         position = position_dodge(.9))
```

---
# 12.1 ggplot2åŸºç¡€
## å¿…é¡»å›¾å±‚

```r
p1
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-11-1.png" width="100%" /&gt;

---
# 12.1 ggplot2åŸºç¡€
## å¯é€‰å›¾å±‚
&lt;img src="./picture/chp12/adjust.png" width="70%" style="display: block; margin: auto;" /&gt;


```r
# ä»¥æŸ±çŠ¶å›¾ä¸ºä¾‹
p2 &lt;- p1 +
  ggplot2::scale_y_continuous(expand=c(0, 0), breaks = seq(0, 0.75, 0.25), limits = c(0, 0.75)) +
  ggplot2::labs(title = "Mean RT for match trials", y = "RT") +
  papaja::theme_apa()
```

---
# 12.1 ggplot2åŸºç¡€
## å¯é€‰å›¾å±‚

```r
p2
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-14-1.png" width="100%" /&gt;

---
# 12.1 ggplot2åŸºç¡€
## å¯é€‰å›¾å±‚
## åŒç†å¯ä»¥å¾—åˆ°ACCçš„å›¾
&lt;img src="chapter_12_files/figure-html/unnamed-chunk-15-1.png" width="100%" /&gt;

---
# 12.1 ggplot2åŸºç¡€
## å¯é€‰å›¾å±‚
## åŒæ—¶å‘ˆç°ä¸¤å¼ å›¾â€”â€”æ–¹æ³•ä¸€ï¼šåˆ†é¢(Facet)
.panelset[
.panel[.panel-name[Facet]
- Facet ä¹Ÿå¯ä»¥è¢«è®¤ä¸ºæ˜¯å›¾å±‚çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯é€šè¿‡"+"åŠ å·å åŠ åœ¨åŸå§‹å›¾ç‰‡ä¸Š
- å¯ä»¥åˆ†ä¸ºä¸€ç»´(facet_wrap)å’ŒäºŒç»´(facet_grid)ä¸¤ç§ï¼Œå›¾ç¤ºä¸ºäºŒç»´
&lt;img src="./picture/chp12/facet.png" width="40%" style="display: block; margin: auto;" /&gt;

.panel[.panel-name[Data preprocessing]

```r
df1 &lt;- df.match.sum[,-c(6, 7, 8)]%&gt;%
  dplyr::rename(grand_mean = grand_mean_RT,
                SD = SD_RT,
                SE = SE_RT)
df1$DV = "RT"

df2 &lt;- df.match.sum[,-c(3, 4, 5)] %&gt;%
  dplyr::rename(grand_mean = grand_mean_ACC,
                SD = SD_ACC,
                SE = SE_ACC)
df2$DV = "ACC"

df.match.sum.long &lt;- rbind(df1, df2)
rm(df1, df2)
```

<div class="datatables html-widget html-fill-item" id="htmlwidget-69ac7d0dc149aa4e0b52" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-69ac7d0dc149aa4e0b52">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["Self","Self","Other"],["moral","immoral","moral"],[0.6366372764212784,0.7150271256631987,0.6850132435574973],[0.06334254097700114,0.06957103122069196,0.07816459938618592],[0.01001533511349354,0.01100014589120355,0.01235890832274734],[41,41,41],["RT","RT","RT"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Identity<\/th>\n      <th>Valence<\/th>\n      <th>grand_mean<\/th>\n      <th>SD<\/th>\n      <th>SE<\/th>\n      <th>n<\/th>\n      <th>DV<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Identity","targets":1},{"name":"Valence","targets":2},{"name":"grand_mean","targets":3},{"name":"SD","targets":4},{"name":"SE","targets":5},{"name":"n","targets":6},{"name":"DV","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

.panel[.panel-name[figure code]

```r
p4 &lt;- df.match.sum.long %&gt;%
  ggplot2::ggplot(., 
                  aes(x = Identity,
                      y = grand_mean,
                      fill = Valence)) + 
  ggplot2::geom_bar(stat = "identity",
                    position=position_dodge(),
                    ) +
  ggplot2::geom_errorbar(aes(ymin = grand_mean-1.96*SE,
                             ymax = grand_mean+1.96*SE),
                         width = .1,
                         position = position_dodge(.9)) +
  papaja::theme_apa() +
  ggplot2::facet_wrap(~DV, scales = "free_y") +
  ggplot2::labs(title = "Mean for match trials",
                x="Identity",
                y="mean")
```

.panel[.panel-name[figure]
&lt;img src="chapter_12_files/figure-html/unnamed-chunk-20-1.png" width="85%" /&gt;


]]]]]

---
# 12.1 ggplot2åŸºç¡€
## å¯é€‰å›¾å±‚
## åŒæ—¶å‘ˆç°ä¸¤å¼ å›¾â€”â€”æ–¹æ³•äºŒï¼špatchwork

```r
p2 + p3 + plot_layout(guides = "collect")
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-21-1.png" width="85%" /&gt;


---
# 12.1 ggplot2åŸºç¡€
## æ€»ç»“

&lt;img src="./picture/chp12/basic.png" width="80%" style="display: block; margin: auto;" /&gt;

---
# 12.1 ggplot2åŸºç¡€
## æ€»ç»“

&lt;img src="./picture/chp12/summary.png" width="80%" style="display: block; margin: auto;" /&gt;

.footnote[
----------------
.footfont[
æ³¨ï¼šæœ¬å›¾æ¥è‡ªã€ŠRè¯­è¨€æ•°æ®å¯è§†åŒ–ä¹‹ç¾ï¼šä¸“ä¸šå›¾è¡¨ç»˜åˆ¶æŒ‡å—ã€‹
]]

---
class: center, middle
&lt;span style="font-size: 60px;"&gt;12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´&lt;/span&gt; &lt;br&gt;

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´
## é—®é¢˜1ï¼šå¯è§†åŒ–RT, ACCçš„æ€»ä½“è¶‹åŠ¿ä¸ä¸ªä½“è¶‹åŠ¿
## ç›®æ ‡å›¾ç‰‡1
&lt;img src="./picture/chp12/target1.png" width="70%" style="display: block; margin: auto;" /&gt;

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡1)
## ç”»å‡ºæ€»ä½“å‡å€¼
.panelset[
.panel[.panel-name[code]

```r
s1 &lt;- df.match.sum %&gt;%
  ggplot2::ggplot(., 
                  aes(x = Identity,
                      y = grand_mean_RT,
                      group = Valence,
                      color = Valence)) +
  ggplot2::geom_line(position = position_dodge(0.5)) +
  ggplot2::geom_point(size = 3,
                      position = position_dodge(0.5)) + 
  ggplot2::geom_errorbar(aes(ymin=grand_mean_RT-SE_RT,
                             ymax=grand_mean_RT+SE_RT),
                         width=.1,
                         position = position_dodge(0.5)) +
  ggplot2::scale_y_continuous(limits = c(0.4, 0.9)) + #é€‰å–èƒ½çº³å…¥å…¨éƒ¨æ•£ç‚¹çš„èŒƒå›´
  papaja::theme_apa()
```

.panel[.panel-name[figure]
&lt;img src="chapter_12_files/figure-html/unnamed-chunk-26-1.png" width="80%" style="display: block; margin: auto;" /&gt;

]]]

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡1)
## åŠ å…¥ä¸ªä½“æ•°æ®
.panelset[
.panel[.panel-name[ç›´æ¥åŠ å…¥â€”â€”æ‹¥æŒ¤]

```r
s2 &lt;- s1 +
  ggplot2::geom_point(data = df.match.subj,
                      aes(x = Identity,
                          y = RT_mean,
                          group = Valence))
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" /&gt;

.panel[.panel-name[åŠ å…¥æŠ–åŠ¨â€”â€”æ··ä¹±]

```r
s3 &lt;- s1 +
  ggplot2::geom_point(data = df.match.subj,
                      aes(x = Identity, y = RT_mean, group = Valence),
                      position = position_jitter(width = 0.1),
                      alpha = 0.5)
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-30-1.png" width="70%" style="display: block; margin: auto;" /&gt;

]]]

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡1)
## åŠ å…¥ä¸ªä½“æ•°æ®â€”â€”å¦‚ä½•å¾—åˆ°è§„åˆ™çš„æŠ–åŠ¨ï¼Ÿ
.panelset[
.panel[.panel-name[å°†ä¸åŒæ¡ä»¶ç‚¹çš„ä½ç½®ä½œä¸ºæ–°å˜é‡]

```r
df.match.plot &lt;- df.match.subj %&gt;%
  dplyr::mutate(conds = case_when(Identity == "Self" &amp; Valence == "moral" ~ "0.88",
                                  Identity == "Self" &amp; Valence == "immoral" ~ "1.12",
                                  Identity == "Other" &amp; Valence == "moral" ~ "1.88",
                                  Identity == "Other" &amp; Valence == "immoral" ~ "2.12"),
                conds = as.numeric(conds))
```

.panel[.panel-name[ä»¥condsä¸ºåŸºç¡€æŠ–åŠ¨]

```r
s4 &lt;- s1 +
    ggplot2::geom_point(data = df.match.plot,
                       aes(x = conds, y = RT_mean, group = Valence),
                       position = position_jitter(width = 0.08),
                       alpha = 0.5)
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-33-1.png" width="70%" style="display: block; margin: auto;" /&gt;

]]]

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡1)
## æ˜¾ç¤ºä¸ªä½“è¶‹åŠ¿

```r
s5 &lt;- s4 +
  ggplot2::geom_line(data = df.match.plot,
                     aes(x = conds, y = RT_mean, group = Sub),
                     linetype = 1,
                     size=0.8,
                     color="#000000",
                     alpha=0.1)
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-35-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡1)
## æ˜¾ç¤ºä¸ªä½“è¶‹åŠ¿â€”â€”å¦‚ä½•ä½¿ç‚¹å’Œçº¿æ­£ç¡®è¿æ¥ï¼Ÿ
.panelset[
.panel[.panel-name[code]

```r
s6 &lt;- s1 +
  ggplot2::geom_point(data = df.match.plot,
                       aes(x = conds,
                           y = RT_mean,
                           group = as.factor(Sub)),
                      position = position_dodge(0.08),
                      color="#000000",
                      alpha = 0.05) +
  ggplot2::geom_line(data = df.match.plot,
                     aes(x = conds,
                         y = RT_mean,
                         group = as.factor(Sub)),
                     position = position_dodge(0.08),
                     linetype = 1,
                     size=0.8,
                     color="#000000",
                     alpha=0.05) +
  ggplot2::labs(y = "RT")
```

.panel[.panel-name[figure]
&lt;img src="chapter_12_files/figure-html/unnamed-chunk-37-1.png" width="80%" style="display: block; margin: auto;" /&gt;

]]]

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡1)
## åŒç†å¯å¾—ACCçš„å›¾

&lt;br&gt;
&lt;br&gt;
&lt;img src="chapter_12_files/figure-html/unnamed-chunk-38-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡1)
## åˆå¹¶å›¾ç‰‡

```r
s9 &lt;- s6 + s8 + plot_layout(guides = "collect")
s9
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-39-1.png" width="100%" /&gt;

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡1)
## ä¿å­˜å›¾ç‰‡

```r
# ä¿å­˜ä¸ºpdfæ›´åŠ æ¸…æ™°
ggplot2::ggsave(filename = "./picture/chp12/p1.pdf", 
                plot = s9, 
                width = 5, 
                height = 4)
```

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´
## é—®é¢˜2ï¼šå¯è§†åŒ–å±‚çº§æ¨¡å‹çš„random effect
## ç›®æ ‡å›¾ç‰‡2
&lt;img src="picture/chp12/target2.png" width="100%" style="display: block; margin: auto;" /&gt;


---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡2)
## é¢„æµ‹
.panelset[
.panel[.panel-name[data preprocessing]

```r
#æ­¤å¤„é€‰æ‹©12ä¸ªè¢«è¯•æ˜¯ä¸ºäº†åœ¨å±•ç¤ºçš„æ—¶å€™æ›´æ¸…æ™°
sublist &lt;- unique(df.match.trial$Sub)
target2 &lt;- df.match.trial %&gt;% 
  dplyr::filter(Sub == sublist[1:12]) %&gt;%
  dplyr::mutate(Label = factor(Label, levels = c("moralSelf", "moralOther", "immoralSelf", "immoralOther")),
                Sub = factor(Sub))

model &lt;- lme4::lmer(data = target2,
                    RT ~ Identity * Valence + (1 + Identity * Valence|Sub)) 

target2.subj &lt;- target2 %&gt;%
  dplyr::group_by(Sub, Identity, Valence) %&gt;%
  dplyr::summarise(RT_mean = mean(RT)) %&gt;%
  dplyr::ungroup()

target2.subj$pred &lt;- stats::predict(model, newdata = target2.subj)
```

.panel[.panel-name[data visualization]

```r
# è§‚å¯Ÿæ•°æ®å’Œé¢„æµ‹æ•°æ®ä¸€èµ·ç”»å‡º
ggplot2::ggplot(data = target2.subj, aes(x = Identity, y = RT_mean, color = Valence)) +
  ggplot2::geom_point() + # å®é™…çš„è§‚å¯Ÿæ•°æ®
  ggplot2::geom_line(aes(y = pred, group = interaction(Sub,Valence))) + # é¢„æµ‹çš„æ•°æ®çº¿
  ggplot2::labs(y = "RT") +
  ggplot2::facet_wrap(~ Sub) + # æŒ‰ç…§å¯¹è±¡åˆ†é¢
  papaja::theme_apa()
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-43-1.png" width="65%" /&gt;


]]]


---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´(ç›®æ ‡å›¾ç‰‡2)
## éšæœºæ•ˆåº”æ£®æ—å›¾
.panelset[
.panel[.panel-name[data preprocessing]

```r
# æå–éšæœºæ•ˆåº”
ranef_df &lt;- as.data.frame(ranef(model)$Sub)
ranef_df$Sub &lt;- row.names(ranef_df)

# å°†æ•°æ®é‡æ–°å¡‘é€ ä¸ºé•¿æ ¼å¼,æ·»åŠ ç½®ä¿¡åŒºé—´
ranef_melt &lt;- reshape::melt(ranef_df, id.vars = 'Sub')
ranef_melt$se &lt;- sqrt(diag(vcov(model)))
ranef_melt$upper &lt;- ranef_melt$value + (1.96 * ranef_melt$se)
ranef_melt$lower &lt;- ranef_melt$value - (1.96 * ranef_melt$se)
```

.panel[.panel-name[forest]

```r
# ç»˜åˆ¶æ£®æ—å›¾
ggplot2::ggplot(ranef_melt, aes(x=value, y=Sub)) +
  ggplot2::geom_point(aes(color = variable), size = 2) +
  ggplot2::geom_errorbarh(aes(xmax = upper, xmin = lower), height = .2, color = 'grey') +
  ggplot2::geom_vline(xintercept = 0, linetype = 2) +
  ggplot2::facet_wrap(~ variable, nrow = 1) + # æŒ‰ç…§å¯¹è±¡åˆ†é¢
  papaja::theme_apa()
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-45-1.png" width="65%" /&gt;

.panel[.panel-name[forest-certain]

```r
# æŸä¸ªç‰¹å®šéšæœºæ•ˆåº”çš„æ£®æ—å›¾
ranef_melt %&gt;%
  dplyr::filter(Sub == "7305" &amp; variable == "IdentityOther") %&gt;%
  ggplot2::ggplot(., aes(x=value, y=Sub)) +
  ggplot2::geom_point(aes(color = variable), size = 5) +
  ggplot2::geom_errorbarh(aes(xmax = upper, xmin = lower), height = .2, color = 'grey') +
  ggplot2::geom_vline(xintercept = 0, linetype = 2) +
  ggplot2::theme_bw()
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-46-1.png" width="65%" /&gt;


]]]]

---
# 12.2 è¿›é˜¶â€”â€”ç»†èŠ‚è°ƒæ•´
## é—®é¢˜3ï¼šä½¿ç”¨é›¨äº‘å›¾(Raincloud plot)å‘ˆç°æ•°æ®çš„åˆ†å¸ƒ
## é›¨äº‘å›¾å°†ä¸åœ¨PPTä¸­å‡ºç°ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œå›åˆ°rmdæ–‡ä»¶è¿è¡Œchunk
## ç›®æ ‡å›¾ç‰‡3
&lt;img src="picture/chp12/target3.png" width="80%" style="display: block; margin: auto;" /&gt;
































































---
class: center, middle
&lt;span style="font-size: 60px;"&gt;12.3 é«˜çº§å›¾ç‰‡å¤„ç†â€”â€”magick&lt;/span&gt; &lt;br&gt;

---
# 12.3 é«˜çº§å›¾ç‰‡å¤„ç†â€”â€”magick

.pull-left[

.size6[

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
ggplotç”Ÿæˆçš„å›¾åƒæœ‰æ—¶éœ€è¦ä½¿ç”¨PPTæˆ–è€…PSç­‰è½¯ä»¶è¿›è¡Œè¿›ä¸€æ­¥ä¿®æ”¹ï¼ˆå¦‚è°ƒæ•´åˆ†è¾¨ç‡ã€ä¿®æ”¹å›¾ç‰‡æ ¼å¼(jpgè½¬png)ã€å›¾ç‰‡æ‹¼æ¥ä¸å‰ªè£ç­‰ï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šé‡åˆ°å¯¹äºå›¾åƒè¿›è¡Œæ‰¹é‡ä¿®æ”¹çš„æƒ…å†µï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è€ƒè™‘ä½¿ç”¨Ræ¥å¤„ç†ã€‚

magickåŒ…å¯ä»¥åº”ç”¨äºæ‰€æœ‰å¸¸è§å›¾ç‰‡æ“ä½œ(ç”šè‡³åŒ…æ‹¬PDF)ï¼Œå…·ä½“åŠŸèƒ½å¯ä»¥å‚è€ƒç›¸å…³æ–‡æ¡£ `\(^*\)`ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»…ä»¥å›¾ç‰‡å‰ªè£ä¸æ‹¼æ¥ä¸ºä¾‹ã€‚
]]

.pull-right[

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;img src="picture/chp12/r.jpg" width="80%" /&gt;
]

.footnote[
----------------
.footfont[
æ³¨ï¼š[https://search.r-project.org/CRAN/refmans/magick/html/magick.html](https://search.r-project.org/CRAN/refmans/magick/html/magick.html)
]]

---
# 12.3 é«˜çº§å›¾ç‰‡å¤„ç†â€”â€”magick
## å›¾ç‰‡å‰ªè£ä¸æ‹¼æ¥

.panelset[

.panel[.panel-name[æŸ¥çœ‹å›¾ç‰‡]

å‡è®¾æˆ‘ä»¬å¸Œæœ›è¿™ä¸¤å¼ å›¾å˜ä¸ºæ¨ªå‘æ’ç‰ˆï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œå‰ªè£ï¼Œç„¶åè¿›è¡Œæ¨ªå‘æ‹¼æ¥ã€‚

&lt;img src="picture/chp6/pr1.png" width="40%" /&gt;


.panel[.panel-name[è¯»å–å›¾ç‰‡]

```r
## è¯»å–å›¾ç‰‡ï¼›å›¾ç‰‡å¯ä»¥æ˜¯æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥æ˜¯å›¾ç‰‡çš„ç½‘å€é“¾æ¥
img = magick::image_read('picture/chp6/pr1.png')

## æŸ¥çœ‹å›¾ç‰‡ç›¸å…³ä¿¡æ¯
img %&gt;% magick::image_info()
```

```
## # A tibble: 1 Ã— 7
##   format width height colorspace matte filesize density
##   &lt;chr&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt;      &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;  
## 1 PNG      870    977 sRGB       FALSE    92033 72x72
```


.panel[.panel-name[å›¾ç‰‡å‰ªè£--è¯­æ³•]

.pull-left[

ä¸‹é¢éœ€è¦æ ¹æ®å›¾ç‰‡çš„width å’Œ height ï¼Œä½¿ç”¨`magick::image_crop()`è¿›è¡Œè£å‰ªï¼Œgeometryå‚æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¥å¯¹å‰ªè£åŒºåŸŸè¿›è¡Œå®šä½ï¼Œæ¯”å¦‚`"850x480+10+10"`ã€‚

è¿™ä¸ªå­—ç¬¦ä¸²åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†:

-   ç¬¬ä¸€éƒ¨åˆ†ï¼šåŒ…å«å›¾ç‰‡å‰ªè£çš„é•¿å’Œå®½ï¼ˆå•ä½å¯ä»¥æ˜¯ç™¾åˆ†æ¯”ï¼Œä½†ä¸‹é¢ä¼šä½¿ç”¨åƒç´ ï¼‰ï¼Œå³`"850x480"`ï¼ˆæ³¨æ„ï¼šå…¶ä¸­è¿æ¥ç¬¦ä¸ºå°å†™å­—æ¯xï¼‰ï¼Œå¤§æ¦‚æŒ‡å³å›¾ä¸­çº¢è‰²çº¿æ¡;

-   ç¬¬äºŒéƒ¨åˆ†ï¼šåŒ…å«èµ·å§‹ç‚¹ä½ç½®ï¼Œå³`"+10+10"`ï¼Œæ„æ€æ˜¯ä»å·¦ä¸Šè§’é¡¶ç‚¹å‘å³10ä¸ªåƒç´ ï¼Œå‘ä¸‹10ä¸ªåƒç´ ï¼Œå¤§æ¦‚å¯¹åº”å³å›¾ä¸­ç°è‰²ç‚¹çš„ä½ç½®ï¼Œå¦‚æœä¸å†™é»˜è®¤ä½¿ç”¨`+0+0`ï¼ˆå³å·¦ä¸Šè§’é¡¶ç‚¹ï¼‰ã€‚
]

.pull-right[

&lt;img src="picture/chp12/crop_gram.jpg" width="100%" /&gt;

]

.panel[.panel-name[å›¾ç‰‡å‰ªè£--ç»“æœ]


```r
img %&gt;% magick::image_crop('850x480+10+10')
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-53-1.png" width="80%" /&gt;

.panel[.panel-name[å›¾ç‰‡å‰ªè£ä¸åˆå¹¶]


```r
img1 = img %&gt;% magick::image_crop('870x488')
img2 = img %&gt;% magick::image_crop('870x488+0+485')
## ä½¿ç”¨image_appendè¿›è¡Œæ‹¼æ¥ï¼Œä»¤stack = Fè¿›è¡Œæ¨ªå‘æ‹¼æ¥ï¼ˆTä¸ºç«–å‘ï¼‰
*img3 = image_append(c(img1,img2),stack = F)
img3 %&gt;% print()
```

```
## # A tibble: 1 Ã— 7
##   format width height colorspace matte filesize density
##   &lt;chr&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt;      &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;  
## 1 PNG     1740    488 sRGB       FALSE        0 72x72
```

&lt;img src="chapter_12_files/figure-html/unnamed-chunk-54-1.png" width="80%" /&gt;

.panel[.panel-name[å…¶ä»–]


```r
#### NOT RUN ####
# ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°
image_write(image = img3,path = 'your path')
# ä¿®æ”¹å°ºå¯¸(å¯ä»¥ä»¥åƒç´ ä¸ºå•ä½ï¼Œè¿™é‡Œä»¥ç™¾åˆ†æ¯”ä¸ºä¾‹)
image_scale(img1,'40%')
# æ—‹è½¬
image_rotate(img1,90)
# OCR(è¿™é‡Œä»¥è‹±æ–‡ä¸ºä¾‹ï¼Œä¸­æ–‡çš„è¯†åˆ«ç‡ç»æµ‹éªŒç¡®å®ä¸å¤ªè¡ŒğŸ˜¢)
image_read("http://jeroen.github.io/images/testocr.png") %&gt;% 
  image_ocr() %&gt;% 
  cat()
```

]]]]]]]

---
# ç½‘ç»œèµ„æº

- ggplot2å¸¸ç”¨å‚æ•°ä¸å‡½æ•°æ±‡æ€»ï¼šhttps://zhuanlan.zhihu.com/p/637483028
- ggplot2ä½ç½®è°ƒæ•´å‚æ•°ï¼šhttps://zhuanlan.zhihu.com/p/409489632
- ggplot2ä¸»é¢˜æ€»ç»“ï¼šhttps://zhuanlan.zhihu.com/p/463041897
- ggplot2åˆ†é¢æ€»ç»“ï¼šhttps://zhuanlan.zhihu.com/p/225852640
- patchworkå¸¸ç”¨åŠŸèƒ½ï¼šhttps://zhuanlan.zhihu.com/p/384456335
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightLines": true,
"highlightStyle": "github",
"countIncrementalSlides": false,
"seal": true,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>

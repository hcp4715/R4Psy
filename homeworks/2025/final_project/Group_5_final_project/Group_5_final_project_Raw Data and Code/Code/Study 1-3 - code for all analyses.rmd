---
title: "Inaction Inertia + Greed All Analyses"
author: "An Anonymous Author"
date: "Sometime"
output:            
    html_document: 
      toc: TRUE      
      toc_depth: 2
      toc_float: true
      theme: journal
      code_folding: show
---

# Preparation

## Load packages

```{r packages, collapse=T, message=FALSE, warning=FALSE}
library(psych)
library(lme4)
library(lmerTest)
library(ggplot2)
library(sjPlot)
library(Hmisc)
library(stringr)
library(ggpubr)
library(sjPlot)
library(plyr)
library(afex)
library(emmeans)
library(ggpubr)
library(car)
library(lavaan)
library(effectsize)
options(scipen=999)



```

## Data Import

```{r}

ds1 <- read.csv("../Data/Study 1 - data.csv", header = TRUE, sep = ";", fileEncoding = "UTF-16LE")
ds2 <- read.csv("../Data/Study 2 - data.csv", header = TRUE, sep = ";")
ds3 <- read.csv("../Data/Study 3 - data.csv", header = TRUE, sep = ";")

ds1$Study <- "Study 1"
ds2$Study <- "Study 2"
ds3$Study <- "Study 3"


```

# Study 1

## Sociodemographics (before exclusion)

```{r}
#gender
# 1 = male
# 2 = female
# 3 = other
table(ds1$SD01)/length(ds1$SD01)

#age
psych::describe(ds1$SD02_01)

#education
#1 = No formal education
#2 = Primary school certificate 
#3 = Secondary school certificate 
#4 = Middle school certificate 
#5 = Highschool degree/ A-level 
#6 = Bachelor (o.Ä.)
#7 = Master (o.Ä.)
#8 = PhD 
#9 = Other
table(ds1$SD03)/length(ds1$SD03)
```

## Exclusion

```{r}
#Number of cases before exclusion
dim(ds1)

#Study time below 60 seconds1? -> No, everything above 60s. 
table(ds1$TIME_SUM)

#Average participation time
mean(ds1$TIME_SUM)

#None of the participants is below 18 years. 

#Technical difficulties?

table(ds1$EX01_01)

#No. Thus, no exclusion necessary. 

dim(ds1)
```

## Dispositional Greed Scale

```{r}
#Cronbachs Alpha for Greed
psych::alpha(ds1[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")], title="Greed")

#Mean Computation
ds1$greed <- rowMeans(ds1[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")])

#standardize greed
ds1$greed.z <- scale(ds1$greed)

#Distribution of Greed
psych::describe(ds1$greed)

#plot greed
library("ggpubr")
ggdensity((ds1$greed), 
          main = "Density",
          xlab = "Greed")



#Means for robustness check
ds1$purchase.diff <- (rowMeans(ds1[c("SC03_01", "SC05_01", "SC07_01", "SC09_01", "SC11_01", "SC13_01")], na.rm = T) - rowMeans(ds1[c("SC02_01", "SC04_01", "SC06_01", "SC08_01", "SC10_01", "SC12_01")], na.rm = T))

ds1$valuation.diff <- (rowMeans(ds1[c("SC03_02", "SC05_02", "SC07_02", "SC09_02", "SC11_02", "SC13_02")], na.rm = T) - rowMeans(ds1[c("SC02_02", "SC04_02", "SC06_02", "SC08_02", "SC10_02", "SC12_02")], na.rm = T))

ds1$purchase.diff.z <- scale(ds1$purchase.diff)
ds1$valuation.diff.z <- scale(ds1$valuation.diff)
```

## Data Restructuring (wide -\> long)

```{r}

ds1.long <- reshape(ds1, direction='long',
                  
                varying = c("SC02_01", "SC02_02",
                            "SC03_01", "SC03_02",
                            "SC04_01", "SC04_02",
                            "SC05_01", "SC05_02",
                            "SC06_01", "SC06_02",
                            "SC07_01", "SC07_02",
                            "SC08_01", "SC08_02",
                            "SC09_01", "SC09_02",
                            "SC10_01", "SC10_02",
                            "SC11_01", "SC11_02",
                            "SC12_01", "SC12_02",
                            "SC13_01", "SC13_02"
                            ), 
                times = c("Ski.Large", "Ski.Small", "Trip.Large", "Trip.Small", "Retirement.Large", "Retirement.Small", "Couch.Large", "Couch.Small", "Car.Large", "Car.Small", "Gym.Large", "Gym.Small"),
                timevar = "scenario.cond",  
                v.names = c("purchase", "valuation")
                )

##Replace missing values
ds1.long$purchase <- ifelse(ds1.long$purchase == -9, NA, ds1.long$purchase)
ds1.long$valuation <- ifelse(ds1.long$valuation == -9, NA, ds1.long$valuation)

##Code Difference
## -1 = large, 1 = small
ds1.long$difference <- ifelse(ds1.long$scenario.cond == "Ski.Large"|ds1.long$scenario.cond == "Trip.Large"|ds1.long$scenario.cond == "Retirement.Large"|ds1.long$scenario.cond == "Couch.Large"|ds1.long$scenario.cond == "Car.Large"|ds1.long$scenario.cond == "Gym.Large", -0.5, 0.5)
ds1.long$difference.str <- ifelse(ds1.long$scenario.cond == "Ski.Large"|ds1.long$scenario.cond == "Trip.Large"|ds1.long$scenario.cond == "Retirement.Large"|ds1.long$scenario.cond == "Couch.Large"|ds1.long$scenario.cond == "Car.Large"|ds1.long$scenario.cond == "Gym.Large", "Large", "Small")

##Code Scenario
ds1.long$scenario <- "Gym"
ds1.long$scenario <- ifelse(ds1.long$scenario.cond == "Ski.Large"|ds1.long$scenario.cond == "Ski.Small", "Ski", ds1.long$scenario)
ds1.long$scenario <- ifelse(ds1.long$scenario.cond == "Trip.Large"|ds1.long$scenario.cond == "Trip.Small", "Trip", ds1.long$scenario)
ds1.long$scenario <- ifelse(ds1.long$scenario.cond == "Retirement.Large"|ds1.long$scenario.cond == "Retirement.Small", "Retirement", ds1.long$scenario)
ds1.long$scenario <- ifelse(ds1.long$scenario.cond == "Couch.Large"|ds1.long$scenario.cond == "Couch.Small", "Couch", ds1.long$scenario)
ds1.long$scenario <- ifelse(ds1.long$scenario.cond == "Car.Large"|ds1.long$scenario.cond == "Car.Small", "Car", ds1.long$scenario)

##Code Order
ds1.long$greedfirst <- ifelse(ds1.long$IV01_01 == "greedfirst", 1, -1)

```

## (Preregistered) Main Analysis

```{r}
##Scale purchase likelihood and valuation
ds1.long$purchase.z <- scale(ds1.long$purchase)
ds1.long$valuation.z <- scale(ds1.long$valuation)


###HERE ARE ONLY THE REGRESSIONS

halfmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z
  purchase.z ~ c*difference + d1*difference:greed.z 
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
 
  valuation.z ~ e*greed.z
  purchase.z ~ g*greed.z  
  
  
                             
"

## Fit 
fit.halfmodel <- sem(halfmodel, data = ds1.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

# Results
summary(fit.halfmodel)
parameterEstimates(fit.halfmodel)





###THIS IS THE MODEL WITH ALL MEDIATIONS

fullmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z
  purchase.z ~ c*difference + d1*difference:greed.z + b*valuation.z 
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  valuation.z ~ e*greed.z
  purchase.z ~ g*greed.z + f*valuation.z 
  
  #creating indirect effects
  #Overall
                             indirect:= a *b
                             direct:= c 
                             total:= indirect + direct
  #For HIGH Greed
                             Hindirect:= (a + d2)*b
                             Hdirect:= c + d1
                             Htotal:= Hindirect + Hdirect
  #For LOW Greed
                             Lindirect:= (a - d2)*b
                             Ldirect:= c - d1
                             Ltotal:= Lindirect + Ldirect
  #to show that effects of greed on purchase likelihood are mediated through valuation 
                             Gindirect:= e*f
                             Gdirect:= g
                             Gtotal:= Gindirect + Gdirect
  #final moderated mediation index variable, required as stated by Hayes
                            index:= d2 * b
                             
"

##Fit 
fit.fullmodel <- sem(fullmodel, data = ds1.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#The Results
summary(fit.fullmodel)
parameterEstimates(fit.fullmodel)




```

## Separate t-tests for each scenario

```{r}

#Purchase Likelihood
#Ski
t.test(ds1$SC02_01, ds1$SC03_01, var.equal = T)
#Trip
t.test(ds1$SC04_01, ds1$SC05_01, var.equal = T)
#Retirement
t.test(ds1$SC06_01, ds1$SC07_01, var.equal = T)
#Couch
t.test(ds1$SC08_01, ds1$SC09_01, var.equal = T)
#Car
t.test(ds1$SC10_01, ds1$SC11_01, var.equal = T)
#Gym
t.test(ds1$SC12_01, ds1$SC13_01, var.equal = T)

##Cohens d
cohens_d(t.test(ds1$SC02_01, ds1$SC03_01, var.equal = T))
cohens_d(t.test(ds1$SC04_01, ds1$SC05_01, var.equal = T))
cohens_d(t.test(ds1$SC06_01, ds1$SC07_01, var.equal = T))
cohens_d(t.test(ds1$SC08_01, ds1$SC09_01, var.equal = T))
cohens_d(t.test(ds1$SC10_01, ds1$SC11_01, var.equal = T))
cohens_d(t.test(ds1$SC12_01, ds1$SC13_01, var.equal = T))
#Descriptives

psych::describe(ds1$SC02_01)
psych::describe(ds1$SC03_01)
psych::describe(ds1$SC04_01)
psych::describe(ds1$SC05_01)
psych::describe(ds1$SC06_01)
psych::describe(ds1$SC07_01)
psych::describe(ds1$SC08_01)
psych::describe(ds1$SC09_01)
psych::describe(ds1$SC10_01)
psych::describe(ds1$SC11_01)
psych::describe(ds1$SC12_01)
psych::describe(ds1$SC13_01)




#Valuation
#Ski
t.test(ds1$SC02_02, ds1$SC03_02, var.equal = T)
#Trip
t.test(ds1$SC04_02, ds1$SC05_02, var.equal = T)
#Retirement
t.test(ds1$SC06_02, ds1$SC07_02, var.equal = T)
#Couch
t.test(ds1$SC08_02, ds1$SC09_02, var.equal = T)
#Car
t.test(ds1$SC10_02, ds1$SC11_02, var.equal = T)
#Gym
t.test(ds1$SC12_02, ds1$SC13_02, var.equal = T)


##Cohens d
cohens_d(t.test(ds1$SC02_02, ds1$SC03_02, var.equal = T))
cohens_d(t.test(ds1$SC04_02, ds1$SC05_02, var.equal = T))
cohens_d(t.test(ds1$SC06_02, ds1$SC07_02, var.equal = T))
cohens_d(t.test(ds1$SC08_02, ds1$SC09_02, var.equal = T))
cohens_d(t.test(ds1$SC10_02, ds1$SC11_02, var.equal = T))
cohens_d(t.test(ds1$SC12_02, ds1$SC13_02, var.equal = T))
#Descriptives

psych::describe(ds1$SC02_02)
psych::describe(ds1$SC03_02)
psych::describe(ds1$SC04_02)
psych::describe(ds1$SC05_02)
psych::describe(ds1$SC06_02)
psych::describe(ds1$SC07_02)
psych::describe(ds1$SC08_02)
psych::describe(ds1$SC09_02)
psych::describe(ds1$SC10_02)
psych::describe(ds1$SC11_02)
psych::describe(ds1$SC12_02)
psych::describe(ds1$SC13_02)
```

## Correlation between Purchase Likelihood and Valuation

```{r}
ds1.long <- ddply(ds1.long, c("id"), transform, within.purchase = scale(purchase))
ds1.long <- ddply(ds1.long, c("id"), transform, within.valuation = scale(valuation))


Hmisc::rcorr(ds1.long$within.purchase, ds1.long$within.valuation)



```

## Robustness Checks

```{r}
###Checking for influence of assessment order (inaction inertia and greed)

ds1.long$threewayorder <- ds1.long$difference*ds1.long$greed.z*ds1.long$greedfirst

halfmodel.order <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z + difference:greedfirst + threewayorder
  purchase.z ~ c*difference + d1*difference:greed.z + difference:greedfirst + threewayorder
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  #Moderation Copy Paste  
  valuation.z ~ greed.z+greedfirst + greedfirst:greed.z
  purchase.z ~ greed.z+greedfirst  + greedfirst:greed.z
  
  
                             
"
ds1.long$valuation.z <- scale(ds1.long$valuation)
ds1.long$purchase.z <- scale(ds1.long$purchase)


## Fit with clustering only in participants
fit.halfmodel.order <- sem(halfmodel.order, data = ds1.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#The Results
summary(fit.halfmodel.order)
parameterEstimates(fit.halfmodel.order)
##No interaction visible





###Checking whether the b-path is moderated by greed


fullmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z
  purchase.z ~ c*difference + d1*difference:greed.z + b*valuation.z + x*valuation.z:greed.z
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  valuation.z ~ e*greed.z
  purchase.z ~ g*greed.z + f*valuation.z 
  
  #creating indirect effects
  #Overall
                             indirect:= a *b
                             direct:= c 
                             total:= indirect + direct
  #For HIGH Greed
                             Hindirect:= (a + d2)*b
                             Hdirect:= c + d1
                             Htotal:= Hindirect + Hdirect
  #For LOW Greed
                             Lindirect:= (a - d2)*b
                             Ldirect:= c - d1
                             Ltotal:= Lindirect + Ldirect
  #to show that effects of greed on purchase likelihood are mediated through valuation 
                             Gindirect:= e*f
                             Gdirect:= g
                             Gtotal:= Gindirect + Gdirect
  #final moderated mediation index variable, required as stated by Hayes
                            index:= d2 * b
                             
"

##Fit 
fit.fullmodel <- sem(fullmodel, data = ds1.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#The Results
summary(fit.fullmodel)
parameterEstimates(fit.fullmodel)






## Replicate single paths in lme4
#All models are the highest converging models regarding random slopes (Barr et al., 2013)

##Predict Purchase Likelihood

purchase.lme4 <- lmer(purchase.z ~ (difference|id) + difference*greed.z, data = ds1.long)
summary(purchase.lme4)

hist(resid(purchase.lme4))

purchase.lme4.val <- lmer(purchase.z ~ (difference||id) + difference*greed.z + valuation.z, data = ds1.long)
summary(purchase.lme4.val)



purchase.lme4.val.int <- lmer(purchase.z ~ (1|id) + difference*greed.z + valuation.z, data = ds1.long)
summary(purchase.lme4.val.int)

anova(purchase.lme4.val, purchase.lme4.val.int)

hist(resid(purchase.lme4.val))



#Predict Valuation
valuation.lme4 <- lmer(valuation.z ~ (difference||id) + difference*greed.z, data = ds1.long)
summary(valuation.lme4)

hist(resid(valuation.lme4))



```

## Replication of main model in PROCESS

```{r}

ds1.long <- subset(ds1.long, is.na(ds1.long$purchase.z) == F)
ds1.long <- subset(ds1.long, is.na(ds1.long$difference) == F)
ds1.long <- subset(ds1.long, is.na(ds1.long$valuation.z) == F)


library(bruceR)

testtest<- PROCESS(
  data = ds1.long,
  y = "purchase.z",
  x = "difference",
  meds = c("valuation.z"),
  mods = c("greed.z"),
  clusters = c("id"),
  hlm.re.m = "(1 +difference|id)",
  hlm.re.y = "(1 +difference|id)",
  hlm.type = c("1-1-1"),
  med.type = c("parallel"),
  mod.type = c("2-way"),
  mod.path = c("x-m", "x-y"),
  ci = c("mcmc"),
  nsim = 1000,
  seed = 5201314,
  std = FALSE,
  digits = 3
)



```

## Plot: Purchase Likelihood

```{r}

ds1.long$purchase.1 <- ds1.long$purchase -1
colors1 <- c("orange", "blue")

plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*greed.z, data = ds1.long)
summary(plot.model)


main.plot <-plot_model(plot.model, type = "pred", terms = c("greed.z",  "difference.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

main.plot$labels$x <- "Greed (SD)"
main.plot$labels$colour <- "Value Difference"
main.plot<-main.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

main.plot

ggsave("E1_purchase_likelihood.pdf", units="in", width=6, height=4, dpi=600)

```

## Plot: Valuation

```{r}
ds1.long$valuation.1 <- ds1.long$valuation -1

colors1 <- c("orange", "blue")

plot.model <- lmer(valuation.1 ~ (difference.str|id) + difference.str*greed.z, data = ds1.long)
summary(plot.model)


VL.plot <-plot_model(plot.model, type = "pred", terms = c("greed.z",  "difference.str")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

VL.plot$labels$x <- "Greed (SD)"
VL.plot$labels$colour <- "Value Difference"
VL.plot<-VL.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

VL.plot

ggsave("E1_valuation.pdf", units="in", width=6, height=4, dpi=600)

## Combined graph

combined.E1 <- ggarrange(main.plot, VL.plot, ncol = 2, nrow = 1, common.legend = T, legend = "right")

ggsave("combined.E1.pdf", units="in", width=8, height=4, dpi=600)


```

## Reviewer Wishes: Do the effects differ between valuation and purchase likelihood

```{r}
ds1.long2 <- reshape(ds1.long, direction='long',
                  
                varying = c("purchase.z", "valuation.z"
                            ), 
                times = c(1, -1),
                timevar = "DV.type",  
                v.names = c("DV.value"), idvar = "case"
                )
##DV Type coded as 1 = Purchase Likelihood and -1 = DV value
difference.regression <- lmer(DV.value ~ greed.z*DV.type*difference + (difference|id), data = ds1.long2)
summary(difference.regression)
```

# Study 2

## Sociodemographics

```{r}

#sex
table(ds2$Sex)
table(ds2$Sex)/length(ds2$Sex)

#age
psych::describe(as.numeric(ds2$Age))

```

## Internal Consistency + Mean Computation

```{r}



#cronbachs Alpha of Greed
psych::alpha(ds2[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")], title="Greed")





#Mean Computation
ds2$greed <- rowMeans(ds2[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")])

ds2$greed.z <- sjmisc::center(ds2$greed)


#Distribution of Greed
psych::describe(ds2$greed)

library("ggpubr")
ggdensity((ds2$greed), 
          main = "Density",
          xlab = "Greed")

hist(ds2$greed)



```

## Preregistered Main Analysis

```{r}

# Create DV and IV
ds2$purchase.between <- ifelse(is.na(ds2$SC12_01), ds2$SC13_01, ds2$SC12_01)
ds2$difference.between <- ifelse(is.na(ds2$SC12_01), 0.5, -0.5)
ds2$difference.between.str <- ifelse(is.na(ds2$SC12_01), "Small", "Large")

# standardize DV
ds2$purchase.between.z <- scale(ds2$purchase.between)


#Preregistered main model
main.lm <- lm(purchase.between.z ~ greed.z*difference.between, data = ds2)
summary(main.lm)
confint(main.lm)


hist(main.lm$residuals)




```

## Plot

```{r}
colors1 <- c("orange", "blue")
ds2$purchase.between.1 <- ds2$purchase.between - 1 


pl.plot.model <- lm(purchase.between.1 ~ difference.between.str*greed.z, data = as.data.frame(ds2))
summary(pl.plot.model)

pl.plot <-plot_model(pl.plot.model, type = "pred", terms = c("greed.z",  "difference.between.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

pl.plot$labels$x <- "Greed (SD)"
pl.plot$labels$colour <- "Value Difference"
pl.plot<-pl.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

pl.plot

ggsave("E2_pl.pdf", units="in", width=6, height=4, dpi=600)




```

## Separate t-test

```{r}

leveneTest(as.numeric(purchase.between) ~ as.factor(difference.between), data = ds2) #if significant, change var.equal to FALSE

print(t.test(purchase.between ~ difference.between, data = ds2, var.equal = FALSE)) 
describeBy(as.numeric(ds2$purchase.between), ds2$difference.between)

print(cohens_d_result <- cohens_d(purchase.between ~ difference.between, data = ds2, var.equal = FALSE))
```

# Study 3

## Sociodemographics (Full)

```{r}
## PREPARATION
## Kick out one CASE with incomplete data

ds3 <- subset(ds3, is.na(ds3$GR01_01) == F)




#sex
table(ds3$Sex)
table(ds3$Sex)/length(ds3$Sex)

#age
psych::describe(as.numeric(ds3$Age))



```

## Sociodemographics (Separate)

```{r}
sd.data3a <- subset(ds3, ds3$QUESTNNR == "long")
sd.data3b <- subset(ds3, ds3$QUESTNNR == "short")

## ONLY WITHIN
dim(sd.data3a)
#sex
table(sd.data3a$Sex)
table(sd.data3a$Sex)/length(sd.data3a$Sex)

#age
psych::describe(as.numeric(sd.data3a$Age))

## ONLY BETWEEN (only those who did have no within subjects)
#sex
dim(sd.data3b)
table(sd.data3b$Sex)
table(sd.data3b$Sex)/length(sd.data3b$Sex)

#age
psych::describe(as.numeric(sd.data3b$Age))
```

## Recode Order

```{r}

# Split the string
ds3$page_1 <- substr(ds3$IV04_02, start = 1, stop = 4)
ds3$page_2 <- substr(ds3$IV04_02, start = 5, stop = 8)
ds3$page_3 <- substr(ds3$IV04_02, start = 9, stop = 12)
ds3$page_4 <- substr(ds3$IV04_02, start = 13, stop = 16)

# View the updated data frame
print(ds3$page_1)

# Next new variable
ds3 <- ds3 %>%
  mutate(
    trip_position = ifelse(page_1 %in% c("SC04", "SC05"), 1,
                                      ifelse(page_2 %in% c("SC04", "SC05"), 2,
                                             ifelse(page_3 %in% c("SC04", "SC05"), 3,
                                                    ifelse(page_4 %in% c("SC04", "SC05"), 4, NA_integer_
                                                           )
                                                    )
                                            )
                            ),
    retirement_position = ifelse(page_1 %in% c("SC06", "SC07"), 1,
                                   ifelse(page_2 %in% c("SC06", "SC07"), 2,
                                          ifelse(page_3 %in% c("SC06", "SC07"), 3,
                                                 ifelse(page_4 %in% c("SC06", "SC07"), 4, NA_integer_
                                                        )
                                                 )
                                          )
                            ),
    couch_position = ifelse(page_1 %in% c("SC08", "SC09"), 1,
                              ifelse(page_2 %in% c("SC08", "SC09"), 2,
                                     ifelse(page_3 %in% c("SC08", "SC09"), 3,
                                            ifelse(page_4 %in% c("SC08", "SC09"), 4, NA_integer_
                                                   )
                                            )
                                      )
                            ),
    gym_position = ifelse(page_1 %in% c("SC12", "SC13"), 1,
                                     ifelse(page_2 %in% c("SC12", "SC13"), 2,
                                            ifelse(page_3 %in% c("SC12", "SC13"), 3,
                                                   ifelse(page_4 %in% c("SC12", "SC13"), 4, NA_integer_
                                                          )
                                                  )
                                            )
                          )
        )

# test, whether it all worked
# print(ds3$gym_position)
# print(ds3$couch_position)
# print(ds3$retirement_position)
# print(ds3$trip_position)

```

## Internal Consistency + Mean Computation

```{r}

#cronbachs Alpha of Greed (all)
psych::alpha(ds3[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")], title="Greed")

#cronbachs Alpha of Greed (3a)
psych::alpha(subset(ds3, ds3$QUESTNNR == "long")[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")], title="Greed")

#cronbachs Alpha of Greed (3b)
psych::alpha(subset(ds3, ds3$QUESTNNR == "short")[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")], title="Greed")


#Mean Computation
ds3$greed <- rowMeans(ds3[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")])


ds3$greed.z <- scale(ds3$greed)


#Distribution of Greed
psych::describe(ds3$greed)

library("ggpubr")
ggdensity((ds3$greed), 
          main = "Density",
          xlab = "Greed")

hist(ds3$greed)
shapiro.test(ds3$greed)

#Means for robustness check
ds3$purchase.diff <- (rowMeans(ds3[c("SC05_01", "SC07_01", "SC09_01", "SC13_01")], na.rm = T) - rowMeans(ds3[c("SC04_01", "SC06_01", "SC08_01", "SC12_01")], na.rm = T))

ds3$valuation.diff <- (rowMeans(ds3[c("SC05_02", "SC07_02", "SC09_02", "SC13_02")], na.rm = T) - rowMeans(ds3[c("SC04_02", "SC06_02", "SC08_02", "SC12_02")], na.rm = T))

ds3$purchase.diff.z <- scale(ds3$purchase.diff)
ds3$valuation.diff.z <- scale(ds3$valuation.diff)

```

## Restructuring the data wide -\> long

```{r}

ds3.long <- reshape(ds3, direction='long',
                  
                varying = c("SC04_01", "SC04_02",
                            "SC05_01", "SC05_02",
                            "SC06_01", "SC06_02",
                            "SC07_01", "SC07_02",
                            "SC08_01", "SC08_02",
                            "SC09_01", "SC09_02",
                            "SC12_01", "SC12_02",
                            "SC13_01", "SC13_02"
                            ), 
                times = c("Trip.Large", "Trip.Small", "Retirement.Large", "Retirement.Small", "Couch.Large", "Couch.Small", "Gym.Large", "Gym.Small"),
                timevar = "scenario.cond",  
                v.names = c("purchase", "valuation")
                )


##Replace missing values
ds3.long$valuation <- ifelse(ds3.long$valuation == -9, NA, ds3.long$valuation)

## Add constant to IDs for later merging
ds3.long$id <- ds3.long$id + 100000000

##Code Difference
## -1 = large, 1 = small
ds3.long$difference <- ifelse(ds3.long$scenario.cond == "Ski.Large"|ds3.long$scenario.cond == "Trip.Large"|ds3.long$scenario.cond == "Retirement.Large"|ds3.long$scenario.cond == "Couch.Large"|ds3.long$scenario.cond == "Car.Large"|ds3.long$scenario.cond == "Gym.Large", -0.5, 0.5)
ds3.long$difference.str <- ifelse(ds3.long$scenario.cond == "Ski.Large"|ds3.long$scenario.cond == "Trip.Large"|ds3.long$scenario.cond == "Retirement.Large"|ds3.long$scenario.cond == "Couch.Large"|ds3.long$scenario.cond == "Car.Large"|ds3.long$scenario.cond == "Gym.Large", "Large", "Small")

##Code Scenario
ds3.long$scenario <- "Gym"
ds3.long$scenario <- ifelse(ds3.long$scenario.cond == "Ski.Large"|ds3.long$scenario.cond == "Ski.Small", "Ski", ds3.long$scenario)
ds3.long$scenario <- ifelse(ds3.long$scenario.cond == "Trip.Large"|ds3.long$scenario.cond == "Trip.Small", "Trip", ds3.long$scenario)
ds3.long$scenario <- ifelse(ds3.long$scenario.cond == "Retirement.Large"|ds3.long$scenario.cond == "Retirement.Small", "Retirement", ds3.long$scenario)
ds3.long$scenario <- ifelse(ds3.long$scenario.cond == "Couch.Large"|ds3.long$scenario.cond == "Couch.Small", "Couch", ds3.long$scenario)
ds3.long$scenario <- ifelse(ds3.long$scenario.cond == "Car.Large"|ds3.long$scenario.cond == "Car.Small", "Car", ds3.long$scenario)




##Code Order
ds3.long$greedfirst <- ifelse(ds3.long$IV01_01 == "greedfirst", 1, -1)

## Order scenario

ds3.long$order <- ifelse(ds3.long$scenario == "Gym", ds3.long$gym_position, ifelse(ds3.long$scenario == "Couch", ds3.long$couch_position, ifelse(ds3.long$scenario == "Retirement", ds3.long$retirement_position, ifelse(ds3.long$scenario == "Trip", ds3.long$trip_position, NA))))


```

## Preregistered Main Analysis - Within subjects

```{r}

##Scale purchase likelihood and valuation
ds3.long$purchase.z <- scale(ds3.long$purchase)
ds3.long$valuation.z <- scale(ds3.long$valuation)


###HERE ARE ONLY THE REGRESSIONS

halfmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z
  purchase.z ~ c*difference + d1*difference:greed.z
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
 
  valuation.z ~ e*greed.z
  purchase.z ~ g*greed.z  
  
  
                             
"

## Fit 
fit.halfmodel <- sem(halfmodel, data = ds3.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.halfmodel)
parameterEstimates(fit.halfmodel)





###THIS IS THE MODEL WITH ALL MEDIATIONS

fullmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z
  purchase.z ~ c*difference + d1*difference:greed.z + b*valuation.z 
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  valuation.z ~ e*greed.z
  purchase.z ~ g*greed.z + f*valuation.z 
  
  #creating indirect effects
  
  #Overall
  
                            indirect:= a*b
                            direct:= c
                            total:= indirect + direct
  #For HIGH Greed
                             Hindirect:= (a + d2)*b
                             Hdirect:= c + d1
                             Htotal:= Hindirect + Hdirect
  #For LOW Greed
                             Lindirect:= (a - d2)*b
                             Ldirect:= c - d1
                             Ltotal:= Lindirect + Ldirect
  #to show that effects of greed on purchase likelihood are mediated through valuation 
                             Gindirect:= e*f
                             Gdirect:= g
                             Gtotal:= Gindirect + Gdirect
  #final moderated mediation index variable, required as stated by Hayes
                            index:= d2 * b
                             
"

## Fit 
fit.fullmodel <- sem(fullmodel, data = ds3.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.fullmodel)
parameterEstimates(fit.fullmodel)



```

## Preregistered Main Analysis - Between subjects

```{r}

## Code difference & DVs
ds3$difference.between <- ifelse(is.na(ds3$SC10_01), 0.5, -0.5)
ds3$purchase.between <- rowSums(ds3[c("SC10_01", "SC11_01")], na.rm = T)
ds3$purchase.between.z <- scale(rowSums(ds3[c("SC10_01", "SC11_01")], na.rm = T))
ds3$valuation.between <- rowSums(ds3[c("SC10_02", "SC11_02")], na.rm = T)
ds3$valuation.between.z <- scale(rowSums(ds3[c("SC10_02", "SC11_02")], na.rm = T))
ds3$difference.between.str <- ifelse(is.na(ds3$SC10_01), "Small", "Large")


#Main preregistered model
pl.between <- lm(purchase.between ~ difference.between*greed.z, data = ds3)

summary(pl.between)
confint(pl.between)






### EXPLORATORY: Valuation 

vl.between <- lm(valuation.between ~ difference.between*greed.z, data = ds3)

summary(vl.between)
confint(vl.between)

### EXPLORATORY: Mediation by Valuation 


pl.between.vl <- lm(purchase.between ~ difference.between*greed.z + scale(valuation.between), data = ds3)

summary(pl.between.vl)
confint(pl.between.vl)


betweenmodel <- "
  valuation.between.z ~ a*difference.between + d1*greed.z + d2*difference.between:greed.z
  purchase.between.z ~ c*difference.between + d3*greed.z + d4*difference.between:greed.z + b*valuation.between.z
  
  #creating indirect effects
  
                            indirect:= a*b
                            direct:= c
                            total:= indirect + direct
                             
"

## Fit 
fit.betweenmodel <- sem(betweenmodel, data = ds3, std.lv = TRUE, se = "boot")

#Le Results
summary(fit.betweenmodel)
```

## Reviewer Wishes: Do the effects differ between valuation and purchase likelihood

```{r}

ds3.long2 <- reshape(ds3.long, direction='long',
                  
                varying = c("purchase.z", "valuation.z"
                            ), 
                times = c(1, -1),
                timevar = "DV.type",  
                v.names = c("DV.value"), idvar = "case"
                )
##DV Type coded as 1 = Purchase Likelihood and -1 = DV value
difference.regression <- lmer(DV.value ~ greed.z*DV.type*difference + (difference|id), data = ds3.long2)
summary(difference.regression)
```

## Reviewer Wishes: Order Effects

```{r}
## Purchase Likelihood
purchase.order <- lmer(purchase.z ~ (difference|id) + difference*greed.z*scale(order), data = ds3.long)
summary(purchase.order)

## Valuation

valuation.order <- lmer(valuation.z ~ (difference|id) + difference*greed.z*scale(order), data = ds3.long)
summary(valuation.order)
```

## Separate t-tests for each scenario

```{r}

#Purchase Likelihood
#Trip
t.test(ds3$SC04_01, ds3$SC05_01, var.equal = T)
#Retirement
t.test(ds3$SC06_01, ds3$SC07_01, var.equal = T)
#Couch
t.test(ds3$SC08_01, ds3$SC09_01, var.equal = T)
#Car
t.test(ds3$SC10_01, ds3$SC11_01, var.equal = T)
#Gym
t.test(ds3$SC12_01, ds3$SC13_01, var.equal = T)

##Cohens d
cohens_d(t.test(ds3$SC04_01, ds3$SC05_01, var.equal = T))
cohens_d(t.test(ds3$SC06_01, ds3$SC07_01, var.equal = T))
cohens_d(t.test(ds3$SC08_01, ds3$SC09_01, var.equal = T))
cohens_d(t.test(ds3$SC10_01, ds3$SC11_01, var.equal = T))
cohens_d(t.test(ds3$SC12_01, ds3$SC13_01, var.equal = T))

#Descriptives

psych::describe(ds3$SC04_01)
psych::describe(ds3$SC05_01)
psych::describe(ds3$SC06_01)
psych::describe(ds3$SC07_01)
psych::describe(ds3$SC08_01)
psych::describe(ds3$SC09_01)
psych::describe(ds3$SC10_01)
psych::describe(ds3$SC11_01)
psych::describe(ds3$SC12_01)
psych::describe(ds3$SC13_01)




#Valuation
#Trip
t.test(ds3$SC04_02, ds3$SC05_02, var.equal = T)
#Retirement
t.test(ds3$SC06_02, ds3$SC07_02, var.equal = T)
#Couch
t.test(ds3$SC08_02, ds3$SC09_02, var.equal = T)
#Car
t.test(ds3$SC10_02, ds3$SC11_02, var.equal = T)
#Gym
t.test(ds3$SC12_02, ds3$SC13_02, var.equal = T)

##Cohens d
cohens_d(t.test(ds3$SC04_02, ds3$SC05_02, var.equal = T))
cohens_d(t.test(ds3$SC06_02, ds3$SC07_02, var.equal = T))
cohens_d(t.test(ds3$SC08_02, ds3$SC09_02, var.equal = T))
cohens_d(t.test(ds3$SC10_02, ds3$SC11_02, var.equal = T))
cohens_d(t.test(ds3$SC12_02, ds3$SC13_02, var.equal = T))

#Descriptives
psych::describe(ds3$SC04_02)
psych::describe(ds3$SC05_02)
psych::describe(ds3$SC06_02)
psych::describe(ds3$SC07_02)
psych::describe(ds3$SC08_02)
psych::describe(ds3$SC09_02)
psych::describe(ds3$SC10_02)
psych::describe(ds3$SC11_02)
psych::describe(ds3$SC12_02)
psych::describe(ds3$SC13_02)
```

## Separate Moderations for each Scenario

```{r}

trip.lm <- lm(scale(purchase) ~ difference*greed.z, data = subset(ds3.long, ds3.long$scenario == "Trip"))
summary(trip.lm)

retirement.lm <- lm(scale(purchase) ~ difference*greed.z, data = subset(ds3.long, ds3.long$scenario == "Retirement"))
summary(retirement.lm)

couch.lm <- lm(scale(purchase) ~ difference*greed.z, data = subset(ds3.long, ds3.long$scenario == "Couch"))
summary(couch.lm)


gym.lm <- lm(scale(purchase) ~ difference*greed.z, data = subset(ds3.long, ds3.long$scenario == "Gym"))
summary(gym.lm)


trip.lm <- lm(scale(valuation) ~ difference*greed.z, data = subset(ds3.long, ds3.long$scenario == "Trip"))
summary(trip.lm)

retirement.lm <- lm(scale(valuation) ~ difference*greed.z, data = subset(ds3.long, ds3.long$scenario == "Retirement"))
summary(retirement.lm)

couch.lm <- lm(scale(valuation) ~ difference*greed.z, data = subset(ds3.long, ds3.long$scenario == "Couch"))
summary(couch.lm)

gym.lm <- lm(scale(valuation) ~ difference*greed.z, data = subset(ds3.long, ds3.long$scenario == "Gym"))
summary(gym.lm)

```

## Correlation between Purchase Likelihood and Valuation

```{r}
ds3.long <- ddply(ds3.long, c("id"), transform, within.purchase = scale(purchase))
ds3.long <- ddply(ds3.long, c("id"), transform, within.valuation = scale(valuation))


Hmisc::rcorr(ds3.long$within.purchase, ds3.long$within.valuation)


```

## Robustness Checks

```{r}
###Checking for influence of assessment order (inaction inertia and greed)

ds3.long$threewayorder <- ds3.long$difference*ds3.long$greed.z*ds3.long$greedfirst

halfmodel.order <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z + difference:greedfirst + threewayorder
  purchase.z ~ c*difference + d1*difference:greed.z + difference:greedfirst + threewayorder
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  #Moderation Copy Paste  
  valuation.z ~ greed.z+greedfirst + greedfirst:greed.z
  purchase.z ~ greed.z+greedfirst  + greedfirst:greed.z
  
  
                             
"

## Fit 
fit.halfmodel.order <- sem(halfmodel.order, data = ds3.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.halfmodel.order)
parameterEstimates(fit.halfmodel.order)
##No interaction visible


###THIS IS THE MODEL WITH ALL MEDIATIONS

fullmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z
  purchase.z ~ c*difference + d1*difference:greed.z + b*valuation.z + x1*valuation.z:greed.z
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  valuation.z ~ e*greed.z
  purchase.z ~ g*greed.z + f*valuation.z 
  
  #creating indirect effects
  
  #Overall
  
                            indirect:= a*b
                            direct:= c
                            total:= indirect + direct
  #For HIGH Greed
                             Hindirect:= (a + d2)*b
                             Hdirect:= c + d1
                             Htotal:= Hindirect + Hdirect
  #For LOW Greed
                             Lindirect:= (a - d2)*b
                             Ldirect:= c - d1
                             Ltotal:= Lindirect + Ldirect
  #to show that effects of greed on purchase likelihood are mediated through valuation 
                             Gindirect:= e*f
                             Gdirect:= g
                             Gtotal:= Gindirect + Gdirect
  #final moderated mediation index variable, required as stated by Hayes
                            index:= d2 * b
                             
"

## Fit 
fit.fullmodel <- sem(fullmodel, data = ds3.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.fullmodel)
parameterEstimates(fit.fullmodel)



## Replicate single paths in lme4
#All models are the highest converging models regarding random slopes (Barr et al., 2013)

##Predict Purchase Likelihood

purchase.lme4 <- lmer(purchase.z ~ (difference|id) + difference*greed.z, data = ds3.long)
summary(purchase.lme4)

hist(resid(purchase.lme4))

purchase.lme4.val <- lmer(purchase.z ~ (difference||id) + difference*greed.z + valuation.z, data = ds3.long)
summary(purchase.lme4.val)



purchase.lme4.val.int <- lmer(purchase.z ~ (1|id) + difference*greed.z + valuation.z, data = ds3.long)
summary(purchase.lme4.val.int)

anova(purchase.lme4.val, purchase.lme4.val.int)

hist(resid(purchase.lme4.val))



#Predict Valuation
valuation.lme4 <- lmer(valuation.z ~ (difference||id) + difference*greed.z, data = ds3.long)
summary(valuation.lme4)

hist(resid(valuation.lme4))



##Predict Purchase Likelihood, control for scenario

purchase.lme4.ctrl <- lmer(purchase.z ~ (difference|id) + (difference|scenario) + difference*greed.z, data = ds3.long)
summary(purchase.lme4.ctrl)


##Predict Valuation, control for scenario

purchase.lme4.ctrl <- lmer(valuation.z ~ (difference|id) + (difference|scenario) + difference*greed.z, data = ds3.long)
summary(purchase.lme4.ctrl)




##Predict Purchase Likelihood,Quadratic

purchase.lme4 <- lmer(purchase.z ~ (difference|id) + difference*greed.z + difference*I(greed.z**2), data = ds3.long)
summary(purchase.lme4)


```

## Plot: Within

```{r}
colors1 <- c("orange", "blue")
ds3.long$purchase.1 <- ds3.long$purchase - 1 
ds3.long$valuation.1 <- ds3.long$valuation - 1 

pl.plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*greed.z, data = ds3.long)
summary(pl.plot.model)


pl.plot <-plot_model(pl.plot.model, type = "pred", terms = c("greed.z",  "difference.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

pl.plot$labels$x <- "Greed (SD)"
pl.plot$labels$colour <- "Value Difference"
pl.plot<-pl.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

pl.plot

ggsave("E3_pl.pdf", units="in", width=6, height=4, dpi=600)


val.plot.model <- lmer(valuation.1 ~ (difference.str|id) + difference.str*greed.z, data = ds3.long)
summary(val.plot.model)


val.plot <-plot_model(val.plot.model, type = "pred", terms = c("greed.z",  "difference.str")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

val.plot$labels$x <- "Greed (SD)"
val.plot$labels$colour <- "Value Difference"
val.plot<-val.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

val.plot

ggsave("E3_val.pdf", units="in", width=6, height=4, dpi=600)


## Combined graph

combined.E3 <- ggarrange(pl.plot, val.plot, ncol = 2, nrow = 1, common.legend = T, legend = "right")

ggsave("combined.E3.within.pdf", units="in", width=8, height=4, dpi=600)

```

## Plot: Between

```{r}
colors1 <- c("orange", "blue")
ds3$purchase.between.1 <- ds3$purchase.between - 1 

ds3 <- as.data.frame(ds3)
ds3$greed.z <- as.numeric(ds3$greed.z)

pl.plot.model <- lm(purchase.between.1 ~ difference.between.str*greed.z, data = (ds3))
summary(pl.plot.model)

pl.plot <-plot_model(pl.plot.model, type = "pred", terms = c("greed.z",  "difference.between.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

pl.plot$labels$x <- "Greed (SD)"
pl.plot$labels$colour <- "Value Difference"
pl.plot<-pl.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

pl.plot

ggsave("E3_pl_between.pdf", units="in", width=6, height=4, dpi=600)


## Valuation
ds3$valuation.between.1 <- ds3$valuation.between - 1 
vl.plot.model <- lm(valuation.between.1 ~ difference.between.str*greed.z, data = (ds3))
summary(vl.plot.model)

vl.plot <-plot_model(vl.plot.model, type = "pred", terms = c("greed.z",  "difference.between.str")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

vl.plot$labels$x <- "Greed (SD)"
vl.plot$labels$colour <- "Value Difference"
vl.plot<-vl.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

vl.plot

ggsave("E3_vl_between.pdf", units="in", width=6, height=4, dpi=600)


## Combined graph

combined.E3.between <- ggarrange(pl.plot, vl.plot, ncol = 2, nrow = 1, common.legend = T, legend = "right")

ggsave("combined.E3.between.pdf", units="in", width=8, height=4, dpi=600)
```

## Replication in PROCESS

```{r}


library(bruceR)
testtest<- PROCESS(
  data = ds3.long,
  y = "purchase.z",
  x = "difference",
  meds= c("valuation.z"),
  mods= c("greed.z"),
  clusters = c("id"),
  hlm.re.m = "(1|id)",
  hlm.re.y = "(1|id)",
  hlm.type = c("1-1-1"),
  med.type = c("parallel"),
  mod.type = c("2-way"),
  mod.path = c("x-m", "x-y"),
  ci = c("mcmc"),
  nsim = 1000,
  seed = 5201314,
  std = FALSE,
  digits = 3
)




```

# Integrative Data Analysis - within subjects

## Merge Data

```{r}

ds3w <- subset(ds3, ds3$QUESTNNR == "long")
ds3w.long <- subset(ds3.long, ds3$QUESTNNR == "long")

# Identify common variables
common_vars <- intersect(names(ds1.long), names(ds3w.long))

# Add missing variables to ds1.long and ds3w.long
ds1.long[setdiff(names(ds3w.long), names(ds1.long))] <- NA
ds3w.long[setdiff(names(ds1.long), names(ds3w.long))] <- NA

# Ensure the order of variables is the same in both datasets
ds1.long <- ds1.long[names(ds3w.long)]
ds3w.long <- ds3w.long[names(ds1.long)]

# Combine the rows
ds13.long <- rbind(ds1.long, ds3w.long)

ds13.long$Study.ef <- ifelse(ds13.long$Study == "Study 3", 1, -1)


# Identify common variables
common_vars <- intersect(names(ds1), names(ds3w))

# Add missing variables to ds1 and ds3w
ds1[setdiff(names(ds3w), names(ds1))] <- NA
ds3w[setdiff(names(ds1), names(ds3w))] <- NA

# Ensure the order of variables is the same in both datasets
ds1 <- ds1[names(ds3w)]
ds3w <- ds3w[names(ds1)]

# Combine the rows
ds13 <- rbind(ds1, ds3w)

ds13$Study.ef <- ifelse(ds13$Study == "Study 3", 1, -1)
```

## Bayesian Correlation Tests

```{r}
library(BayesFactor)
BayesFactor::correlationBF(ds1$greed.z, ds1$purchase.diff)
BayesFactor::correlationBF(ds3$greed.z, ds3$purchase.diff)
```

## Differences in Greed Distribution

```{r}

#Compare Samples in Mean Greed
t.test(ds13$greed ~ ds13$Study.ef)


##Standardize Greed
ds13$greed.z.c <- scale(ds13$greed)
ds13.long$greed.z.c <- scale(ds13.long$greed)

psych::describe.by(ds13$greed.z.c, ds13$Study.ef)



##Greed Distribution
# Modified density layers with mapping for the legend
density_layer.1 <- geom_density(data = subset(ds13, Study == "Study 1"), 
                                aes(x = greed.z.c, fill = "Study 1"), alpha = 0.3, inherit.aes = FALSE)

density_layer.3 <- geom_density(data = subset(ds13, Study == "Study 3"), 
                                aes(x = greed.z.c, fill = "Study 3a"), alpha = 0.3, inherit.aes = FALSE)

# Create the plot
simple_plot <- ggplot() + density_layer.3 + density_layer.1 +
               labs(x = "Greed (SD)", y = "Density") + theme_classic() +
               scale_fill_manual(values = c("Study 1" = "grey20", "Study 3a" = "grey"), name = "Study")

# Print the plot
print(simple_plot)


ggsave("E13_distributions.pdf", units="in", width=6, height=4, dpi=600)

```

## Measurement Invariance (Single Factor)

```{r}


##CFA


single.factor <- ' G=~ GR01_01+GR01_02+GR01_03+GR01_04+GR01_05+ GR01_06+GR01_07 '


# Fit model within each study

fit.E1 <- cfa(single.factor, 
           data = subset(ds13, ds13$Study == "Study 1"))

summary(fit.E1, fit.measures = T)


fit.E3 <- cfa(single.factor, 
           data = subset(ds13, ds13$Study == "Study 3"))

summary(fit.E3, fit.measures = T)


#configural invariance

fit.config <- cfa(single.factor, 
           data = ds13, 
           group = "Study")

summary(fit.config, fit.measures = T)


#weak invariance

fit.weak <- cfa(single.factor, 
           data = ds13, 
           group = "Study", group.equal = "loadings")

summary(fit.weak, fit.measures = T)


#strong invariance

fit.strong <- cfa(single.factor, 
           data = ds13, 
           group = "Study", group.equal = c("loadings", "intercepts"))

summary(fit.strong, fit.measures = T)


lavTestLRT(fit.config, fit.weak, fit.strong)


```

## Exploratory Factor Analyses

```{r}

#cronbachs Alpha of Greed (all)
psych::alpha(ds13[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")], title="Greed")


#Exploratory within E1
pfadata <- ds1[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")]
allitems.parallel <- fa.parallel(pfadata)
allitems.efa <- factanal(pfadata, 3, rotation = "promax")
print(allitems.efa, cutoff = 0)

## Restriction to two factors because one factor is only Item 2
allitems.efa <- factanal(pfadata, 2, rotation = "promax")
print(allitems.efa, cutoff = 0)

#Exploratory within E3, only within data
pfadata <- ds3[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")]
pfadata <- subset(pfadata, ds3$QUESTNNR == "long")
allitems.parallel <- fa.parallel(pfadata)
allitems.efa <- factanal(pfadata, 2, rotation = "promax")
print(allitems.efa, cutoff = 0)

#Exploratory within E1 & E3, only within data
pfadata <- ds13[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")]
allitems.parallel <- fa.parallel(pfadata)
allitems.efa <- factanal(pfadata, 3, rotation = "promax")
print(allitems.efa, cutoff = 0)

## Restriction to two factors because one factor is only Item 2
allitems.efa <- factanal(pfadata, 2, rotation = "promax")
print(allitems.efa, cutoff = 0)

```

## Reshape data

```{r}

ds13.long <- reshape(ds13, direction='long',
                varying = c("SC02_01", "SC02_02",
                            "SC03_01", "SC03_02",
                            "SC04_01", "SC04_02",
                            "SC05_01", "SC05_02",
                            "SC06_01", "SC06_02",
                            "SC07_01", "SC07_02",
                            "SC08_01", "SC08_02",
                            "SC09_01", "SC09_02",
                            "SC10_01", "SC10_02",
                            "SC11_01", "SC11_02",
                            "SC12_01", "SC12_02",
                            "SC13_01", "SC13_02"
                            ), 
                times = c("Ski.Large", "Ski.Small", "Trip.Large", "Trip.Small", "Retirement.Large", "Retirement.Small", "Couch.Large", "Couch.Small", "Car.Large", "Car.Small", "Gym.Large", "Gym.Small"),
                timevar = "scenario.cond",  
                v.names = c("purchase", "valuation")
                )

##Replace missing values
ds13.long$valuation <- ifelse(ds13.long$valuation == -9, NA, ds13.long$valuation)
ds13.long$purchase <- ifelse(ds13.long$purchase == -9, NA, ds13.long$purchase)

##Code Difference
## -1 = large, 1 = small
ds13.long$difference <- ifelse(ds13.long$scenario.cond == "Ski.Large"|ds13.long$scenario.cond == "Trip.Large"|ds13.long$scenario.cond == "Retirement.Large"|ds13.long$scenario.cond == "Couch.Large"|ds13.long$scenario.cond == "Car.Large"|ds13.long$scenario.cond == "Gym.Large", -0.5, 0.5)
ds13.long$difference.str <- ifelse(ds13.long$scenario.cond == "Ski.Large"|ds13.long$scenario.cond == "Trip.Large"|ds13.long$scenario.cond == "Retirement.Large"|ds13.long$scenario.cond == "Couch.Large"|ds13.long$scenario.cond == "Car.Large"|ds13.long$scenario.cond == "Gym.Large", "Large", "Small")

##Code Scenario
ds13.long$scenario <- "Gym"
ds13.long$scenario <- ifelse(ds13.long$scenario.cond == "Ski.Large"|ds13.long$scenario.cond == "Ski.Small", "Ski", ds13.long$scenario)
ds13.long$scenario <- ifelse(ds13.long$scenario.cond == "Trip.Large"|ds13.long$scenario.cond == "Trip.Small", "Trip", ds13.long$scenario)
ds13.long$scenario <- ifelse(ds13.long$scenario.cond == "Retirement.Large"|ds13.long$scenario.cond == "Retirement.Small", "Retirement", ds13.long$scenario)
ds13.long$scenario <- ifelse(ds13.long$scenario.cond == "Couch.Large"|ds13.long$scenario.cond == "Couch.Small", "Couch", ds13.long$scenario)
ds13.long$scenario <- ifelse(ds13.long$scenario.cond == "Car.Large"|ds13.long$scenario.cond == "Car.Small", "Car", ds13.long$scenario)


```

## Multilevel Moderated Mediation

```{r}


##Scale purchase likelihood and valuation
ds13.long$purchase.z <- scale(ds13.long$purchase)
ds13.long$valuation.z <- scale(ds13.long$valuation)


###HERE ARE ONLY THE REGRESSIONS

halfmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z.c
  purchase.z ~ c*difference + d1*difference:greed.z.c
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
 
  valuation.z ~ e*greed.z.c
  purchase.z ~ g*greed.z.c  
  
  
                             
"

## Fit 
fit.halfmodel <- sem(halfmodel, data = ds13.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.halfmodel)
parameterEstimates(fit.halfmodel)





###THIS IS THE MODEL WITH ALL MEDIATIONS

fullmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:greed.z.c
  purchase.z ~ c*difference + d1*difference:greed.z.c + b*valuation.z 
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  valuation.z ~ e*greed.z.c
  purchase.z ~ g*greed.z.c + f*valuation.z 
  
  #creating indirect effects
  
  #Overall
  
                            indirect:= a*b
                            direct:= c
                            total:= indirect + direct
  #For HIGH Greed
                             Hindirect:= (a + d2)*b
                             Hdirect:= c + d1
                             Htotal:= Hindirect + Hdirect
  #For LOW Greed
                             Lindirect:= (a - d2)*b
                             Ldirect:= c - d1
                             Ltotal:= Lindirect + Ldirect
  #to show that effects of greed on purchase likelihood are mediated through valuation 
                             Gindirect:= e*f
                             Gdirect:= g
                             Gtotal:= Gindirect + Gdirect
  #final moderated mediation index variable, required as stated by Hayes
                            index:= d2 * b
                             
"

## Fit 
fit.fullmodel <- sem(fullmodel, data = ds13.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.fullmodel)
parameterEstimates(fit.fullmodel)



```

## Regressions across both studies

```{r}



## Without Study 

# Purchase Likelihood
purchase <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c, data = ds13.long)
summary(purchase)


# Valuation
valuation <- lmer(valuation.z ~ (difference|id) + difference*greed.z.c, data = ds13.long)
summary(valuation)


## With Study

# Purchase Likelihood
purchase <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c*Study.ef, data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(purchase)


# Valuation
valuation <- lmer(valuation.z ~ (difference|id) + difference*greed.z.c*Study.ef, data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(valuation)


```

## Plot: Purchase Likelihood

```{r}
colors1 <- c("orange", "blue")

ds13.long$purchase.1 <- ds13.long$purchase
plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*greed.z, data = ds13.long)
summary(plot.model)


main.plot <-plot_model(plot.model, type = "pred", terms = c("greed.z",  "difference.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

main.plot$labels$x <- "Greed (SD)"
main.plot$labels$colour <- "Value Difference"
main.plot<-main.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

main.plot

ggsave("E13_purchase_likelihood.pdf", units="in", width=6, height=4, dpi=600)

```

## Plot: Valuation

```{r}
colors1 <- c("orange", "blue")
ds13.long$valuation.1 <- ds13.long$valuation

plot.model <- lmer(valuation.1 ~ (difference.str|id) + difference.str*greed.z, data = ds13.long)
summary(plot.model)


main.plot <-plot_model(plot.model, type = "pred", terms = c("greed.z",  "difference.str")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

main.plot$labels$x <- "Greed (SD)"
main.plot$labels$colour <- "Value Difference"
main.plot<-main.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

main.plot

ggsave("E13_valuation.pdf", units="in", width=6, height=4, dpi=600)

```

## Reviewer Wishes: Do the effects differ between valuation and purchase likelihood

```{r}

ds13.long2 <- reshape(ds13.long, direction='long',
                  
                varying = c("purchase.z", "valuation.z"
                            ), 
                times = c(1, -1),
                timevar = "DV.type",  
                v.names = c("DV.value"), idvar = "case"
                )
##DV Type coded as 1 = Purchase Likelihood and -1 = DV value
difference.regression <- lmer(DV.value ~ greed.z.c*DV.type*difference + (difference|id), data = ds13.long2)
summary(difference.regression)
```

## Polynomial Effects: Purchase Likelihood

```{r}
# With Study as factor

# Quadratic
purchase <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c*Study.ef + difference*I(greed.z.c**2), data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(purchase)

# Cubic
purchase <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c*Study.ef + difference*I(greed.z.c**2) + difference*I(greed.z.c**3), data = ds13.long)
summary(purchase)


# Without Study as factor


# Quadratic
purchase <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c + difference*I(greed.z.c**2), data = ds13.long)
summary(purchase)

# Cubic
purchase <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c + difference*I(greed.z.c**2) + difference*I(greed.z.c**3), data = ds13.long)
summary(purchase)




#Plot
ds13.long$purchase.1 <- ds13.long$purchase - 1
plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*greed.z.c +  difference.str*I(greed.z.c**2) +  difference.str*I(greed.z.c**3), data = ds13.long)
summary(plot.model)


main.plot <-plot_model(plot.model, type = "pred", terms = c("greed.z.c [all]",  "difference.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

main.plot$labels$x <- "Greed (SD)"
main.plot$labels$colour <- "Value Difference"
main.plot<-main.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
main.plot


ggsave("E13_PL_cub.pdf", units="in", width=6, height=4, dpi=600)








```

## Polynomial Effects: Valuation

```{r}
# Quadratic
valuation <- lmer(valuation.z ~ (difference|id) + difference*greed.z.c + difference*I(greed.z.c**2), data = ds13.long)
summary(valuation)

# Cubic
valuation <- lmer(valuation.z ~ (difference|id) + difference*greed.z.c + difference*I(greed.z.c**2) + difference*I(greed.z.c**3), data = ds13.long)
summary(valuation)


#Plot
ds13.long$valuation.1 <- ds13.long$valuation - 1
plot.model <- lmer(valuation.1 ~ (difference.str|id) + difference.str*greed.z +  difference.str*I(greed.z**2) +  difference.str*I(greed.z**3), data = ds13.long)
summary(plot.model)


vl.plot <-plot_model(plot.model, type = "pred", terms = c("greed.z [all]",  "difference.str")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

vl.plot$labels$x <- "Greed (SD)"
vl.plot$labels$colour <- "Value Difference"
vl.plot<-vl.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
vl.plot

ggsave("E13_V_cub.pdf", units="in", width=6, height=4, dpi=600)


## Combined graph

combined.E13.poly <- ggarrange(main.plot, vl.plot, ncol = 2, nrow = 1, common.legend = T, legend = "right")

ggsave("combined.E13.poly.pdf", units="in", width=8, height=4, dpi=600)

```

## Restricting Greed in Study 3 to +/-1.5 SD

```{r}
purchase <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c, data = subset(ds13.long, ds13.long$Study.ef == 1 & ds13.long$greed.z.c > -1.5 & ds13.long$greed.z.c < 1.5))
summary(purchase)


valuation <- lmer(valuation.z ~ (difference|id) + difference*greed.z.c, data = subset(ds13.long, ds13.long$Study.ef == 1 & ds13.long$greed.z.c > -1.5 & ds13.long$greed.z.c < 1.5))
summary(valuation)



## Multilevel Moderated Mediation

## Fit 
fit.halfmodel <- sem(halfmodel, data = subset(ds13.long, ds13.long$Study.ef == 1 & ds13.long$greed.z.c > -1.5 & ds13.long$greed.z.c < 1.5), std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.halfmodel)
parameterEstimates(fit.halfmodel)


## Fit 
fit.fullmodel <- sem(fullmodel, data = subset(ds13.long, ds13.long$Study.ef == 1 & ds13.long$greed.z.c > -1.5 & ds13.long$greed.z.c < 1.5), std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.fullmodel)
parameterEstimates(fit.fullmodel)

```

## Examine Subfacets

```{r}

#Generate Scores
ds13.long$dissatisfaction <- scale(rowMeans(ds13.long[c("GR01_01", "GR01_02", "GR01_04", "GR01_05")]))
ds13.long$acquisitiveness <- scale(rowMeans(ds13.long[c("GR01_03", "GR01_06", "GR01_07")]))
ds13$dissatisfaction <- scale(rowMeans(ds13[c("GR01_01", "GR01_02", "GR01_04", "GR01_05")]))
ds13$acquisitiveness <- scale(rowMeans(ds13[c("GR01_03", "GR01_06", "GR01_07")]))



##Distribution
density_layer.1 <- geom_density(data = subset(ds13, Study == "Study 1"), 
                                aes(x = acquisitiveness, fill = "Study 1"), alpha = 0.3, inherit.aes = FALSE)

density_layer.3 <- geom_density(data = subset(ds13, Study == "Study 3"), 
                                aes(x = acquisitiveness, fill = "Study 3a"), alpha = 0.3, inherit.aes = FALSE)

# Create the plot
simple_plot1 <- ggplot() + density_layer.3 + density_layer.1 +
               labs(x = "Acquisitiveness (SD)", y = "Density") + theme_classic() +
               scale_fill_manual(values = c("Study 1" = "grey20", "Study 3a" = "grey"), name = "Study")

# Print the plot
print(simple_plot1)


ggsave("E13_distributions_acquisitiveness.pdf", units="in", width=6, height=4, dpi=600)



##Distribution
density_layer.1 <- geom_density(data = subset(ds13, Study == "Study 1"), 
                                aes(x = dissatisfaction, fill = "Study 1"), alpha = 0.3, inherit.aes = FALSE)

density_layer.3 <- geom_density(data = subset(ds13, Study == "Study 3"), 
                                aes(x = dissatisfaction, fill = "Study 3a"), alpha = 0.3, inherit.aes = FALSE)

# Create the plot
simple_plot2 <- ggplot() + density_layer.3 + density_layer.1 +
               labs(x = "Dissatisfaction (SD)", y = "Density") + theme_classic() +
               scale_fill_manual(values = c("Study 1" = "grey20", "Study 3a" = "grey"), name = "Study")

# Print the plot
print(simple_plot2)


ggsave("E13_distributions_dissatisfaction.pdf", units="in", width=6, height=4, dpi=600)

## Combined graph

combined.E13.distributions <- ggarrange(simple_plot1, simple_plot2, ncol = 2, nrow = 1, common.legend = T, legend = "right")
combined.E13.distributions
ggsave("combined.E13.distributions.pdf", units="in", width=8, height=4, dpi=600)


# Test for differences in factors between the studies

t.test(ds13$dissatisfaction ~ ds13$Study)
t.test(ds13$acquisitiveness ~ ds13$Study)

```

## Subfacets: Linear Effects

```{r}


# Purchase Likelihood

purchase <- lmer(purchase.z ~ (difference|id) + difference*dissatisfaction*Study.ef + difference*acquisitiveness*Study.ef, data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(purchase)


# Purchase Likelihood, separate models
purchase <- lmer(purchase.z ~ (difference|id) + difference*dissatisfaction*Study.ef, data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(purchase)


purchase <- lmer(purchase.z ~ (difference|id) + difference*acquisitiveness*Study.ef, data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(purchase)


#Plot
ds13.long$purchase.1 <- ds13.long$purchase - 1
plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*dissatisfaction*Study +  difference.str*acquisitiveness*Study, data = ds13.long)
summary(plot.model)


acquisitiveness <-plot_model(plot.model, type = "pred", terms = c("acquisitiveness",  "difference.str", "Study")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

acquisitiveness$labels$x <- "Acquisitiveness (SD)"
acquisitiveness$labels$colour <- "Value Difference"
acquisitiveness<-acquisitiveness + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
acquisitiveness

ggsave("E13_PL_acquisitiveness.pdf", units="in", width=6, height=4, dpi=600)


dissatisfaction <-plot_model(plot.model, type = "pred", terms = c("dissatisfaction",  "difference.str", "Study")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

dissatisfaction$labels$x <- "Dissatisfaction (SD)"
dissatisfaction$labels$colour <- "Value Difference"
dissatisfaction<-dissatisfaction + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
dissatisfaction

ggsave("E13_PL_dissatisfaction.pdf", units="in", width=6, height=4, dpi=600)








#Valuation

valuation <- lmer(valuation.z ~ (difference|id) + difference*dissatisfaction*Study.ef+ difference*acquisitiveness*Study.ef, data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(valuation)


#Valuation, separate models
valuation <- lmer(valuation.z ~ (difference|id) + difference*dissatisfaction*Study.ef, data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(valuation)

valuation <- lmer(valuation.z ~ (difference|id) + difference*acquisitiveness*Study.ef, data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(valuation)


#Plot
plot.model <- lmer(valuation.1 ~ (difference.str|id) + difference.str*dissatisfaction*Study +  difference.str*acquisitiveness*Study, data = ds13.long)
summary(plot.model)

acquisitiveness <-plot_model(plot.model, type = "pred", terms = c("acquisitiveness",  "difference.str", "Study")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

acquisitiveness$labels$x <- "Acquisitiveness (SD)"
acquisitiveness$labels$colour <- "Value Difference"
acquisitiveness<-acquisitiveness + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
acquisitiveness

ggsave("E13_VL_acquisitiveness.pdf", units="in", width=6, height=4, dpi=600)


dissatisfaction <-plot_model(plot.model, type = "pred", terms = c("dissatisfaction",  "difference.str", "Study")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

dissatisfaction$labels$x <- "Dissatisfaction (SD)"
dissatisfaction$labels$colour <- "Value Difference"
dissatisfaction<-dissatisfaction + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
dissatisfaction

ggsave("E13_VL_dissatisfaction.pdf", units="in", width=6, height=4, dpi=600)

```

## Multilevel Moderated Mediation for Subfacets

```{r}
### Acquisitiveness

fullmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:acquisitiveness
  purchase.z ~ c*difference + d1*difference:acquisitiveness + b*valuation.z 
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  valuation.z ~ e*acquisitiveness
  purchase.z ~ g*acquisitiveness + f*valuation.z 
  
  #creating indirect effects
  
  #Overall
  
                            indirect:= a*b
                            direct:= c
                            total:= indirect + direct
  #For HIGH Greed
                             Hindirect:= (a + d2)*b
                             Hdirect:= c + d1
                             Htotal:= Hindirect + Hdirect
  #For LOW Greed
                             Lindirect:= (a - d2)*b
                             Ldirect:= c - d1
                             Ltotal:= Lindirect + Ldirect
  #to show that effects of greed on purchase likelihood are mediated through valuation 
                             Gindirect:= e*f
                             Gdirect:= g
                             Gtotal:= Gindirect + Gdirect
  #final moderated mediation index variable, required as stated by Hayes
                            index:= d2 * b
                             
"

## Fit 
fit.fullmodel <- sem(fullmodel, data = ds13.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.fullmodel)
parameterEstimates(fit.fullmodel)



###Dissatisfaction



fullmodel <- "
level : 1

  valuation.z ~ a*difference + d2*difference:dissatisfaction
  purchase.z ~ c*difference + d1*difference:dissatisfaction + b*valuation.z 
  
level : 2
  purchase.z ~~ purchase.z
  valuation.z ~~ valuation.z
  
  valuation.z ~ e*dissatisfaction
  purchase.z ~ g*dissatisfaction + f*valuation.z 
  
  #creating indirect effects
  
  #Overall
  
                            indirect:= a*b
                            direct:= c
                            total:= indirect + direct
  #For HIGH Greed
                             Hindirect:= (a + d2)*b
                             Hdirect:= c + d1
                             Htotal:= Hindirect + Hdirect
  #For LOW Greed
                             Lindirect:= (a - d2)*b
                             Ldirect:= c - d1
                             Ltotal:= Lindirect + Ldirect
  #to show that effects of greed on purchase likelihood are mediated through valuation 
                             Gindirect:= e*f
                             Gdirect:= g
                             Gtotal:= Gindirect + Gdirect
  #final moderated mediation index variable, required as stated by Hayes
                            index:= d2 * b
                             
"

## Fit 
fit.fullmodel <- sem(fullmodel, data = ds13.long, std.lv = TRUE, se = "robust.huber.white", cluster = "id")

#Le Results
summary(fit.fullmodel)
parameterEstimates(fit.fullmodel)

```

## Polynomial Effects: Acquisitiveness

```{r}

# With Study as factor

# Quadratic
purchase <- lmer(purchase.z ~ (difference|id) + difference*acquisitiveness*Study.ef + difference*I(acquisitiveness**2), data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(purchase)

# Cubic
purchase <- lmer(purchase.z ~ (difference|id) + difference*acquisitiveness*Study.ef + difference*I(acquisitiveness**2) + difference*I(acquisitiveness**3), data = ds13.long)
summary(purchase)


# Without Study as factor


# Quadratic
purchase <- lmer(purchase.z ~ (difference|id) + difference*acquisitiveness + difference*I(acquisitiveness**2), data = ds13.long)
summary(purchase)

# Cubic
purchase <- lmer(purchase.z ~ (difference|id) + difference*acquisitiveness + difference*I(acquisitiveness**2) + difference*I(acquisitiveness**3), data = ds13.long)
summary(purchase)



#Plot
ds13.long$purchase.1 <- ds13.long$purchase - 1
plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*acquisitiveness +  difference.str*I(acquisitiveness**2) +  difference.str*I(acquisitiveness**3), data = ds13.long)
summary(plot.model)


pl.acq.poly <-plot_model(plot.model, type = "pred", terms = c("acquisitiveness [all]",  "difference.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

pl.acq.poly$labels$x <- "Acquisitiveness (SD)"
pl.acq.poly$labels$colour <- "Value Difference"
pl.acq.poly<-pl.acq.poly + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
pl.acq.poly


ggsave("E13_PL_cub_acquisitiveness.pdf", units="in", width=6, height=4, dpi=600)







## Valuation


# With Study as factor

# Quadratic
valuation <- lmer(valuation.z ~ (difference|id) + difference*acquisitiveness*Study.ef + difference*I(acquisitiveness**2), data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(valuation)

# Cubic
valuation <- lmer(valuation.z ~ (difference|id) + difference*acquisitiveness*Study.ef + difference*I(acquisitiveness**2) + difference*I(acquisitiveness**3), data = ds13.long)
summary(valuation)


# Without Study as factor


# Quadratic
valuation <- lmer(valuation.z ~ (difference|id) + difference*acquisitiveness + difference*I(acquisitiveness**2), data = ds13.long)
summary(valuation)

# Cubic
valuation <- lmer(valuation.z ~ (difference|id) + difference*acquisitiveness + difference*I(acquisitiveness**2) + difference*I(acquisitiveness**3), data = ds13.long)
summary(valuation)



#Plot
ds13.long$valuation.1 <- ds13.long$valuation - 1
plot.model <- lmer(valuation.1 ~ (difference.str|id) + difference.str*acquisitiveness +  difference.str*I(acquisitiveness**2) +  difference.str*I(acquisitiveness**3), data = ds13.long)
summary(plot.model)


vl.acq.poly <-plot_model(plot.model, type = "pred", terms = c("acquisitiveness [all]",  "difference.str")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

vl.acq.poly$labels$x <- "Acquisitiveness (SD)"
vl.acq.poly$labels$colour <- "Value Difference"
vl.acq.poly<-vl.acq.poly + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
vl.acq.poly


ggsave("E13_VL_cub_acquisitiveness.pdf", units="in", width=6, height=4, dpi=600)



## Combined graph

combined.E13.poly <- ggarrange(pl.acq.poly, vl.acq.poly, ncol = 2, nrow = 1, common.legend = T, legend = "right")

ggsave("combined.E13.poly.acq.pdf", units="in", width=8, height=4, dpi=600)

```

## Polynomial Effects: Dissatisfaction

```{r}
## Purchase Likelihood

# With Study as factor

# Quadratic
purchase <- lmer(purchase.z ~ (difference|id) + difference*dissatisfaction*Study.ef + difference*I(dissatisfaction**2), data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(purchase)

# Cubic
purchase <- lmer(purchase.z ~ (difference|id) + difference*dissatisfaction*Study.ef + difference*I(dissatisfaction**2) + difference*I(dissatisfaction**3), data = ds13.long)
summary(purchase)


# Without Study as factor


# Quadratic
purchase <- lmer(purchase.z ~ (difference|id) + difference*dissatisfaction + difference*I(dissatisfaction**2), data = ds13.long)
summary(purchase)

# Cubic
purchase <- lmer(purchase.z ~ (difference|id) + difference*dissatisfaction + difference*I(dissatisfaction**2) + difference*I(dissatisfaction**3), data = ds13.long)
summary(purchase)




#Plot
ds13.long$purchase.1 <- ds13.long$purchase - 1
plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*dissatisfaction +  difference.str*I(dissatisfaction**2) +  difference.str*I(dissatisfaction**3), data = ds13.long)
summary(plot.model)


pl.diss.poly <-plot_model(plot.model, type = "pred", terms = c("dissatisfaction [all]",  "difference.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

pl.diss.poly$labels$x <- "Dissatisfaction (SD)"
pl.diss.poly$labels$colour <- "Value Difference"
pl.diss.poly<-pl.diss.poly + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
pl.diss.poly


ggsave("E13_PL_cub_dissatisfaction.pdf", units="in", width=6, height=4, dpi=600)





## Valuation

# With Study as factor

# Quadratic
valuation <- lmer(valuation.z ~ (difference|id) + difference*dissatisfaction*Study.ef + difference*I(dissatisfaction**2), data = ds13.long, control = lmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 100000)))
summary(valuation)

# Cubic
valuation <- lmer(valuation.z ~ (difference|id) + difference*dissatisfaction*Study.ef + difference*I(dissatisfaction**2) + difference*I(dissatisfaction**3), data = ds13.long)
summary(valuation)


# Without Study as factor


# Quadratic
valuation <- lmer(valuation.z ~ (difference|id) + difference*dissatisfaction + difference*I(dissatisfaction**2), data = ds13.long)
summary(valuation)

# Cubic
valuation <- lmer(valuation.z ~ (difference|id) + difference*dissatisfaction + difference*I(dissatisfaction**2) + difference*I(dissatisfaction**3), data = ds13.long)
summary(valuation)




#Plot
ds13.long$valuation.1 <- ds13.long$valuation - 1
plot.model <- lmer(valuation.1 ~ (difference.str|id) + difference.str*dissatisfaction +  difference.str*I(dissatisfaction**2) +  difference.str*I(dissatisfaction**3), data = ds13.long)
summary(plot.model)


vl.diss.poly <-plot_model(plot.model, type = "pred", terms = c("dissatisfaction [all]",  "difference.str")
                       , axis.title = "Valuation (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

vl.diss.poly$labels$x <- "Dissatisfaction (SD)"
vl.diss.poly$labels$colour <- "Value Difference"
vl.diss.poly<-vl.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 
vl.diss.poly


ggsave("E13_VL_cub_dissatisfaction.pdf", units="in", width=6, height=4, dpi=600)


## Combined graphs

combined.E13.poly <- ggarrange(pl.diss.poly, vl.diss.poly, ncol = 2, nrow = 1, common.legend = T, legend = "right")

ggsave("combined.E13.poly.diss.pdf", units="in", width=8, height=4, dpi=600)


combined.E13.poly <- ggarrange(pl.acq.poly, pl.diss.poly, ncol = 2, nrow = 1, common.legend = T, legend = "right")

ggsave("combined.E13.poly.subfacets.PL.pdf", units="in", width=8, height=4, dpi=600)

combined.E13.poly <- ggarrange(vl.acq.poly, vl.diss.poly, ncol = 2, nrow = 1, common.legend = T, legend = "right")

ggsave("combined.E13.poly.subfacets.VL.pdf", units="in", width=8, height=4, dpi=600)

```

## Restricting Dissatisfaction to +/-1 SD in Study 3

```{r}
purchase <- lmer(purchase.z ~ (difference|id) + difference*dissatisfaction, data = subset(ds13.long,   ds13.long$Study.ef == 1 &  ds13.long$dissatisfaction > -1 & ds13.long$dissatisfaction < 1))
summary(purchase)


valuation <- lmer(valuation.z ~ (1|id) + difference*dissatisfaction*Study.ef, data = subset(ds13.long, ds13.long$Study.ef == 1 & ds13.long$dissatisfaction > -1 & ds13.long$dissatisfaction < 1))
summary(valuation)

```

## Moderation by Sociodemographics

```{r}



## Gender
ds13.long$female <- ifelse(is.na(ds13.long$Sex), NA, ifelse(ds13.long$Sex == "Female", 1, NA))
ds13.long$female <- ifelse(is.na(ds13.long$Sex), NA, ifelse(ds13.long$Sex == "Male", 0, ds13.long$female))
ds13.long$female <- ifelse(is.na(ds13.long$SD01), ds13.long$female, ifelse(ds13.long$SD01 == 2, 1, NA))
ds13.long$female <- ifelse(is.na(ds13.long$SD01), ds13.long$female, ifelse(ds13.long$SD01 == 1, 0, ds13.long$female))

purchase.gender <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c*female, data = ds13.long)
summary(purchase.gender)


#with Study
purchase.gender <- lmer(purchase.z ~ (difference|id) + difference*greed.z.c*female*Study.ef, data = ds13.long)
summary(purchase.gender)

## Age
ds13.long$Age <- as.numeric(ifelse(is.na(ds13.long$SD02_01) == F, ds13.long$SD02_01, ds13.long$Age))
purchase.age <- lmer(purchase.z ~ (difference|id) + difference*greed.z*scale((Age)), data = ds13.long)
summary(purchase.age)

# with Study
purchase.age <- lmer(purchase.z ~ (difference|id) + difference*greed.z*scale((Age))*Study.ef, data = ds13.long)
summary(purchase.age)



#Plots

ds13.long$female.str <- ifelse(is.na(ds13.long$Sex), NA, ifelse(ds13.long$Sex == "Female", "Female", NA))
ds13.long$female.str <- ifelse(is.na(ds13.long$Sex), NA, ifelse(ds13.long$Sex == "Male", "Male", ds13.long$female.str))
ds13.long$female.str <- ifelse(is.na(ds13.long$SD01), ds13.long$female.str, ifelse(ds13.long$SD01 == 2, "Female", NA))
ds13.long$female.str <- ifelse(is.na(ds13.long$SD01), ds13.long$female.str, ifelse(ds13.long$SD01 == 1, "Male", ds13.long$female.str))

plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*greed.z*female.str, data = ds13.long)
summary(plot.model)


main.plot <-plot_model(plot.model, type = "pred", terms = c("greed.z",  "difference.str", "female.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

main.plot$labels$x <- "Greed (SD)"
main.plot$labels$colour <- "Value Difference"
main.plot<-main.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

main.plot

ggsave("E13_purchase_likelihood_sex.pdf", units="in", width=8, height=4, dpi=600)


median(as.numeric(ds13.long$Age), na.rm = T)
       
ds13.long$Age.cat <- as.factor(ifelse(as.numeric(ds13.long$Age) <median(as.numeric(ds13.long$Age), na.rm = T), "Age Below Median (34)", "Age Above Median (34)"))
ds13.long$Age.cat <- factor(ds13.long$Age.cat, levels = rev(levels(ds13.long$Age.cat)))



plot.model <- lmer(purchase.1 ~ (difference.str|id) + difference.str*greed.z*Age.cat, data = ds13.long)
summary(plot.model)


main.plot <-plot_model(plot.model, type = "pred", terms = c("greed.z",  "difference.str", "Age.cat")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

main.plot$labels$x <- "Greed (SD)"
main.plot$labels$colour <- "Value Difference"
main.plot<-main.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

main.plot

ggsave("E13_purchase_likelihood_age.pdf", units="in", width=8, height=4, dpi=600)



## Also for valuation

## Gender
valuation.gender <- lmer(valuation.z ~ (difference|id) + difference*greed.z.c*female, data = ds13.long)
summary(valuation.gender)


#with Study
valuation.gender <- lmer(valuation.z ~ (difference|id) + difference*greed.z.c*female*Study.ef, data = ds13.long)
summary(valuation.gender)

## Age
valuation.age <- lmer(valuation.z ~ (difference|id) + difference*greed.z*scale((Age)), data = ds13.long)
summary(valuation.age)






## age and gender combined
purchase.age.gender <- lmer(purchase.z ~ (difference|id) + difference*greed.z*scale((Age)) + female*difference*greed.z, data = ds13.long)
summary(purchase.age.gender)
```

## Correlation Table

```{r}

##1 + 3a
print(psych::corr.test(ds13.long[c("greed", "acquisitiveness", "dissatisfaction",  "purchase", "valuation", "difference", "Age", "female", "Study.ef")]), digits = 3)


## 1
print(psych::corr.test(subset(ds13.long, ds13.long$Study.ef == -1)[c("greed", "acquisitiveness", "dissatisfaction",  "purchase", "valuation", "difference", "Age", "female")]), digits = 3)

## 3a
print(psych::corr.test(subset(ds13.long, ds13.long$Study.ef == 1)[c("greed", "acquisitiveness", "dissatisfaction",  "purchase", "valuation", "difference", "Age", "female")]), digits = 3)

```

# Integrative Data Analysis - between subjects

## Merge Data

```{r}

ds3b <- subset(ds3)

# Identify common variables
common_vars <- intersect(names(ds2), names(ds3b))

# Add missing variables to ds2 and ds3
ds2[setdiff(names(ds3b), names(ds2))] <- NA
ds3b[setdiff(names(ds2), names(ds3b))] <- NA

# Ensure the order of variables is the same in both datasets
ds2 <- ds2[names(ds3b)]
ds3b <- ds3b[names(ds2)]

# Combine the rows
ds23 <- rbind(ds2, ds3b)

ds23 <- subset(ds23, is.na(ds23$GR01_01) == F)
```

## Do the greed distributions differ?

```{r}
t.test(ds23$greed~ds23$Study)
```

## Exploratory Factor Analysis

```{r}

#cronbachs Alpha of Greed (all)
psych::alpha(ds23[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")], title="Greed")


pfadata <- ds23[c("GR01_01", "GR01_02", "GR01_03", "GR01_04", "GR01_05", "GR01_06", "GR01_07")]
allitems.parallel <- fa.parallel(pfadata)
allitems.efa <- factanal(pfadata, 2, rotation = "promax")
print(allitems.efa, cutoff = 0)

```

## Main Analysis

```{r}

ds23$Study.ef <- ifelse(ds23$Study == "Study 2", -1, 1)

#Main Model
main.lm <- lm(purchase.between ~ greed.z*difference.between*Study.ef, data = ds23)
summary(main.lm)

confint(main.lm)


```

## Plot

```{r}
colors1 <- c("orange", "blue")
ds2$purchase.between.1 <- ds2$purchase.between - 1 


pl.plot.model <- lm(purchase.between.1 ~ difference.between.str*greed.z, data = as.data.frame(ds2))
summary(pl.plot.model)

pl.plot <-plot_model(pl.plot.model, type = "pred", terms = c("greed.z",  "difference.between.str")
                       , axis.title = "Purchase Likelihood (0-10)", axis.lim = list(c(-2, 2), c(1, 9)), 
                       colors = colors1, axis.labels = c("Large", "Small"),
                       
                       ci.lvl = 0.95, se = FALSE, auto.label = FALSE, show.legend = F) 

pl.plot$labels$x <- "Greed (SD)"
pl.plot$labels$colour <- "Value Difference"
pl.plot<-pl.plot + theme_classic() +labs(title="") + guides(fill = guide_legend(reverse=TRUE, title = "Value Difference", size = 90)) 

pl.plot

ggsave("E23_pl.pdf", units="in", width=6, height=4, dpi=600)




```

## Polynomial Effects

```{r}
#quadratic
quad.lm <- lm(purchase.between ~ greed.z*difference.between + I(greed.z**2)*difference.between, data = ds23)
summary(quad.lm)


#cubic
cub.lm <- lm(purchase.between ~ greed.z*difference.between + I(greed.z**2)*difference.between+  I(greed.z**3)*difference.between, data = ds23)
summary(cub.lm)

#Subset
subset.lm <- lm(purchase.between ~ greed.z*difference.between, data = subset(ds23, ds23$greed.z > -1.5 & ds23$greed.z < 1.5))
summary(subset.lm)

```

## Factor Scores

```{r}



ds23$dissatisfaction <- scale(rowMeans(ds23[c("GR01_01", "GR01_02", "GR01_04", "GR01_05")]))
ds23$acquisitiveness <- scale(rowMeans(ds23[c("GR01_03", "GR01_06", "GR01_07")]))


t.test(ds23$dissatisfaction ~ ds23$Study)
t.test(ds23$acquisitiveness ~ ds23$Study)


#Main Model
main.lm <- lm(purchase.between ~ dissatisfaction*difference.between*Study.ef + acquisitiveness*difference.between*Study.ef, data = ds23)
summary(main.lm)


main.lm <- lm(purchase.between ~ (dissatisfaction)*difference.between + (acquisitiveness)*difference.between, data = subset(ds23, ds23$Study == "Study 2"))
summary(main.lm)

main.lm <- lm(purchase.between ~ (dissatisfaction)*difference.between + (acquisitiveness)*difference.between, data = subset(ds23, ds23$Study == "Study 3"))
summary(main.lm)




#cubic
cub.lm <- lm(purchase.between ~ acquisitiveness*difference.between + I(acquisitiveness**2)*difference.between+  I(acquisitiveness**3)*difference.between, data = ds23)
summary(cub.lm)

cub.lm <- lm(purchase.between ~ dissatisfaction*difference.between + I(dissatisfaction**2)*difference.between+  I(dissatisfaction**3)*difference.between, data = ds23)
summary(cub.lm)
```

## Moderation by Sociodemographics

```{r}


## Gender
ds23$female <- ifelse(ds23$Sex == "Female", 1, NA)
ds23$female <- ifelse(ds23$Sex == "Male", 0, ds23$female)


#main model with gender
gender.lm <- lm(purchase.between ~ greed.z*difference.between*female, data = ds23)
summary(gender.lm)


#main model with age
ds23$Age <- as.numeric(ds23$Age)
age.lm <- lm(purchase.between ~ greed.z*difference.between*scale((Age)), data = ds23)
summary(age.lm)




```

## Correlation Tables

```{r}

## 2 + 3b
print(psych::corr.test(ds23[c("greed", "acquisitiveness", "dissatisfaction", "purchase.between", "valuation.between", "difference.between", "Age", "female", "Study.ef")]), digits = 3)

## 2
print(psych::corr.test(subset(ds23, ds23$Study.ef == -1)[c("greed", "acquisitiveness", "dissatisfaction", "purchase.between", "valuation.between", "difference.between", "Age", "female")]), digits = 3)

## 3
print(psych::corr.test(subset(ds23, ds23$Study.ef == 1)[c("greed", "acquisitiveness", "dissatisfaction", "purchase.between", "valuation.between", "difference.between", "Age", "female")]), digits = 3)
```

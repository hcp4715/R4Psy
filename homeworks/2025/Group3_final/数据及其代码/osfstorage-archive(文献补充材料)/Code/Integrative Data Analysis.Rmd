---
title: "Integrative Data Analysis"
author: "Steve Rathje"
date: "8/23/2021"
output: html_document
---

## Set Working Directory 

```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = "/Users/steverathje/Desktop/Financial\ Nudge\ fake\ News/")
```


## Install Packages

```{r cars}
library(psych)
library(dplyr)
library(tidyverse)
library(jtools)
library(ggpubr)
library(rstatix)
library(tidyverse)
library(Rmisc)
library(jtools)
library(rockchalk)
library(readr)
library(report)
library(BayesFactor)
library(readr)
library(ggplot2)
library(ggsignif)
library(ggstatsplot)
library(plyr)
library(wesanderson)
library(cowplot)
#install.packages("report")
```

#Read in all datasets 

```{r}

data1 <- read_csv("Study\ 1\ Analysis/FullDataStudy1.csv") #511
data2 <- read_csv("Study\ 2\ Analysis/Study2RawData.csv") #1113
data3 <- read_csv("Study\ 3\ Analysis\ /DataAugust17.csv") #1010
data4 <- read_csv("Study\ 4\ Analysis/Study4Data.csv") #1007

data1$study <- 1
data2$study <- 2
data3$study <- 3
data4$study <- 4
data4$condition <- car::recode(data4$condition, "0=1;1=0;2=2")

data <- rbind.fill(data1, data2, data3, data4) #3686

count(is.na(data1$Q114))
count(is.na(data2$Q114))
count(is.na(data3$Q114))

xtabs(~data2$Random)
xtabs(~data3$Random)

```

## Exclude Exclusions

```{r pressure, echo=FALSE}

#get Prolific IDs of those who failed attention checks
FailedAttentionCheck <- ifelse(data$Q114 != 35, data$PROLIFIC_PID, NA)
plyr::count(FailedAttentionCheck)

plyr::count(data$Q114 != 35)
#FailedAttentionCheck

#Exclude those who failed the attention check and responded randomly (pre-registered exclusion criteria)
plyr::count(subset(data, data$Q114 == 35)) 
data <- subset(data, data$Q114 == 35) 
plyr::count(subset(data, data$Random == 1))
data <- subset(data, data$Random == 2) #3364 - proper sample size :) 

```

## Recode Important Variables 
```{r}
#Recode political oriention into binary (is Repub) variable
data$isRepub <- ifelse(data$DemRep_C > 3, 1, 0)

#Conservatism
data$PoliticalOrientation <- data$DemRep_C

#Vote
data$Vote <- ifelse(data$POTUS2016 == 1, 0, data$POTUS2016) 
data$Vote <- ifelse(data$Vote == 2, 1, data$Vote)
data$Vote <- ifelse(data$Vote > 1, NA, data$Vote)

#Recode Condition Variable (0 = Accuracy/Source, 1 = Control/Source, 3 = Accuracy/No Source, 4 = Control/No Source)
data$Condition <- as.factor(data$condition)

#Split into Repub and Dem 
dataRepub <- subset(data, data$isRepub == 1)
dataDem <- subset(data, data$isRepub == 0)

#Outgroup hate variable
data$outgrouphate <- ifelse(data$isRepub == 1, (100 - data$FeelingDem_1), (100 - data$FeelingRepub_1))
data$ingrouplove <- ifelse(data$isRepub == 1, data$FeelingRepub_1, data$FeelingDem_1)
data$affectivepolarization <- data$ingrouplove + data$outgrouphate
data$strengthpartisanship <- car::recode(data$DemRep_C, "1 = 3; 2 = 2; 3 = 1; 4 = 1; 5 = 2; 6 = 3")

```

## Characteristics of sample
```{r}
#sample size
nrow(data)

#number of repubs (Repub = 1)
plyr::count(data$isRepub)

plyr::count(data$Condition)

#Political Orientation
plyr::count(data$DemRep_C)

#gender (1 = Male, 2 = Female, 4 = Trans Male, 5 = Trans/Non-Binary)
plyr::count(data$Gender)

data$isFemale <- ifelse(data$Gender == 2, 1, 0)

#race
plyr::count(data$Ethnicity)

#Mean Age
mean(data$Age, na.rm = TRUE)

```

## Create Dichotomous Measures 

```{r}
#Binary Accuracy Scores
data$DT1Bin <- ifelse(data$AccuracyDT1 > 3, 1, 0)
data$DT2Bin <- ifelse(data$AccuracyDT2 > 3, 1, 0)
data$DT3Bin <- ifelse(data$AccuracyDT3 > 3, 1, 0)
data$DT4Bin <- ifelse(data$AccuracyDT4 > 3, 1, 0)
data$RT1Bin <- ifelse(data$AccuracyRT1 > 3, 1, 0)
data$RT2Bin <- ifelse(data$AccuracyRT2 > 3, 1, 0)
data$RT3Bin <- ifelse(data$AccuracyRT3 > 3, 1, 0)
data$RT4Bin <- ifelse(data$AccuracyRT4 > 3, 1, 0)
data$DF1Bin <- ifelse(data$AccuracyDF1 > 3, 1, 0)
data$DF2Bin <- ifelse(data$AccuracyDF2 > 3, 1, 0)
data$DF3Bin <- ifelse(data$AccuracyDF3 > 3, 1, 0)
data$DF4Bin <- ifelse(data$AccuracyDF4 > 3, 1, 0)
data$RF1Bin <- ifelse(data$AccuracyRF1 > 3, 1, 0)
data$RF2Bin <- ifelse(data$AccuracyRF2 > 3, 1, 0)
data$RF3Bin <- ifelse(data$AccuracyRF3 > 3, 1, 0)
data$RF4Bin <- ifelse(data$AccuracyRF4 > 3, 1, 0)

#Binary Sharing Scores 
data$ShareDT1Bin <- ifelse(data$ShareDT1 > 3, 1, 0)
data$ShareDT2Bin <- ifelse(data$ShareDT2 > 3, 1, 0)
data$ShareDT3Bin <- ifelse(data$ShareDT3 > 3, 1, 0)
data$ShareDT4Bin <- ifelse(data$ShareDT4 > 3, 1, 0)
data$ShareRT1Bin <- ifelse(data$ShareRT1 > 3, 1, 0)
data$ShareRT2Bin <- ifelse(data$ShareRT2 > 3, 1, 0)
data$ShareRT3Bin <- ifelse(data$ShareRT3 > 3, 1, 0)
data$ShareRT4Bin <- ifelse(data$ShareRT4 > 3, 1, 0)
data$ShareDF1Bin <- ifelse(data$ShareDF1 > 3, 1, 0)
data$ShareDF2Bin <- ifelse(data$ShareDF2 > 3, 1, 0)
data$ShareDF3Bin <- ifelse(data$ShareDF3 > 3, 1, 0)
data$ShareDF4Bin <- ifelse(data$ShareDF4 > 3, 1, 0)
data$ShareRF1Bin <- ifelse(data$ShareRF1 > 3, 1, 0)
data$ShareRF2Bin <- ifelse(data$ShareRT2 > 3, 1, 0)
data$ShareRF3Bin <- ifelse(data$ShareRF3 > 3, 1, 0)
data$ShareRF4Bin <- ifelse(data$ShareRF4 > 3, 1, 0)

data$TrueBin <-     data$DT1Bin +
                      data$DT2Bin + 
                      data$DT3Bin +
                      data$DT4Bin +
                      data$RT1Bin +
                      data$RT2Bin + 
                      data$RT3Bin +
                      data$RT4Bin

data$FalseBin <-    data$DF1Bin +
                      data$DF2Bin + 
                      data$DF3Bin +
                      data$DF4Bin +
                      data$RF1Bin +
                      data$RF2Bin + 
                      data$RF3Bin +
                      data$RF4Bin

data$truthDiscernBin <- data$TrueBin - data$FalseBin

data$TrueDemBin <- data$DT1Bin +
                      data$DT2Bin + 
                      data$DT3Bin +
                      data$DT4Bin
  
data$TrueRepubBin <- data$RT1Bin +
                      data$RT2Bin + 
                      data$RT3Bin +
                      data$RT4Bin

data$FalseDemBin <- data$DF1Bin +
                      data$DF2Bin + 
                      data$DF3Bin +
                      data$DF4Bin 

data$FalseRepubBin <- data$RF1Bin +
                      data$RF2Bin + 
                      data$RF3Bin +
                      data$RF4Bin

data$DemBin <- data$TrueDemBin + data$FalseDemBin
data$RepubBin <- data$TrueRepubBin + data$FalseRepubBin
data$TrueBin <- data$TrueDemBin + data$TrueRepubBin

data$DemPercent <- (data$DemBin / 8)*100
data$RepubPercent <- (data$RepubBin / 8)*100

data$AccuracyScore <- data$TrueBin + (8 - data$FalseBin)

##FullBonus
fullbonus <- ifelse(data$AccuracyScore > 15 & (data$Condition == 0 | data$Condition == 3), data$PROLIFIC_PID, NA)

halfbonus <- ifelse(data$AccuracyScore > 13 & data$AccuracyScore < 16 & (data$Condition == 0 | data$Condition == 3), data$PROLIFIC_PID, NA)
  
data$PercentAccurate <- (data$AccuracyScore/16)*100

```

## Political Congruence Variable (Dichotomous)

```{r}

data$CongruentBin <- ifelse(data$isRepub == 1, data$RepubBin, data$DemBin)
data$IncongruentBin <- ifelse(data$isRepub == 1, data$DemBin, data$RepubBin)

data$CongruentTrueBin <- ifelse(data$isRepub == 1, data$TrueRepubBin, data$TrueDemBin)
data$IncongruentTrueBin <- ifelse(data$isRepub == 1, data$TrueDemBin, data$TrueRepubBin)
data$CongruentFalseBin <- ifelse(data$isRepub == 1, data$FalseRepubBin, data$FalseDemBin)
data$IncongruentFalseBin <- ifelse(data$isRepub == 1, data$FalseDemBin, data$FalseRepubBin)

data$partisanGapBin <- data$CongruentBin - data$IncongruentBin
data$partisanGapTrueBin <- data$CongruentTrueBin - data$IncongruentTrueBin
data$partisanGapFalseBin <- data$CongruentFalseBin - data$IncongruentFalseBin



```

# Truth Discern Sharing 
```{r}

data$ShareDT3 <- ifelse(is.na(data$ShareDT3), data$ShareDT2_1, data$ShareDT3)

data$TrueShare <- (data$ShareDT1 +
                       data$ShareDT2 + 
                       data$ShareDT3 + ##Fix This
                       data$ShareDT4 +
                       data$ShareRT1 + 
                       data$ShareRT2 + 
                       data$ShareRT3 + 
                       data$ShareRT4) / 8

data$FalseShare <- (data$ShareDF1 + 
                       data$ShareDF2 + 
                       data$ShareDF3 + 
                       data$ShareDF4 + 
                       data$ShareRF1 +
                       data$ShareRF2 + 
                       data$ShareRF3 + 
                       data$ShareRF4) / 8

data$TrueShareBin <- (data$ShareDT1Bin +
                       data$ShareDT2Bin + 
                       data$ShareDT3Bin + ##Fix This
                       data$ShareDT4Bin +
                       data$ShareRT1Bin + 
                       data$ShareRT2Bin + 
                       data$ShareRT3Bin + 
                       data$ShareRT4Bin) / 8

data$FalseShareBin <- (data$ShareDF1Bin + 
                       data$ShareDF2Bin + 
                       data$ShareDF3Bin + 
                       data$ShareDF4Bin + 
                       data$ShareRF1Bin +
                       data$ShareRF2Bin + 
                       data$ShareRF3Bin + 
                       data$ShareRF4Bin) / 8

data$TruthDiscernSharing <- data$TrueShare - data$FalseShare
data$TruthDiscernSharingBin <- data$TrueShareBin - data$FalseShareBin

data$TrueDemShare <- (data$ShareDT1 +
                       data$ShareDT2 + 
                       data$ShareDT3 + 
                       data$ShareDT4) / 4

data$TrueRepubShare <- (data$ShareRT1 + 
                       data$ShareRT2 + 
                       data$ShareRT3 + 
                       data$ShareRT4) / 4

data$FalseDemShare <- (data$ShareDF1 + 
                       data$ShareDF2 + 
                       data$ShareDF3 + 
                       data$ShareDF4) / 4

data$FalseRepubShare <- (data$ShareRF1 +
                       data$ShareRF2 + 
                       data$ShareRF3 + 
                       data$ShareRF4) / 4

data$DemShare <- (data$TrueDemShare + data$FalseDemShare)/2
data$RepubShare <- (data$TrueRepubShare + data$FalseRepubShare)/2

```

## Political Congruence SHARING

```{r}

data$CongruentShare <- ifelse(data$isRepub == 1, data$RepubShare, data$DemShare)
data$IncongruentShare <- ifelse(data$isRepub == 1, data$DemShare, data$RepubShare)

data$CongruentTrueShare <- ifelse(data$isRepub == 1, data$TrueRepubShare, data$TrueDemShare)
data$IncongruentTrueShare <- ifelse(data$isRepub == 1, data$TrueDemShare, data$TrueRepubShare)
data$CongruentFalseShare <- ifelse(data$isRepub == 1, data$FalseRepubShare, data$FalseDemShare)
data$IncongruentFalseShare <- ifelse(data$isRepub == 1, data$FalseDemShare, data$FalseRepubShare)

data$partisanGapShare <- data$CongruentShare - data$IncongruentShare
data$partisanGapTrueShare <- data$CongruentTrueShare - data$IncongruentTrueShare
data$partisanGapFalseShare <- data$CongruentFalseShare - data$IncongruentFalseBin

```

## Cognitive Reflection
```{r}

data$CR1Correct <- ifelse(data$CR1 == 4, 1, 0)
data$CR2Correct <- ifelse(data$CR2 == 10, 1, 0)
data$CR3Correct <- ifelse(data$CR3 == 39, 1, 0)

data$CRSum <- data$CR1Correct + data$CR2Correct + data$CR3Correct

```

## Political Knowledge
```{r}
data$PK1Correct <- ifelse(data$`PK1(3)` == 3, 1, 0) 
data$PK2Correct <- ifelse(data$`PK2(2)` == 2, 1, 0)
data$PK3Correct <- ifelse(data$`PK3(1)` == 1, 1, 0)
data$PK4Correct <- ifelse(data$`PK4(2)` == 2, 1, 0)
data$PK5Correct <- ifelse(data$`PK5(1)` == 1, 1, 0)

data$PKSum <- data$PK1Correct + data$PK2Correct + data$PK3Correct + data$PK4Correct + data$PK5Correct
```

## Open-Mindedness

```{r}

data$O1Recode <- car::recode(data$O1, "32 = 5; 31 = 4; 30 = 3; 29 = 2; 28 = 1")
data$O2Recode <- car::recode(data$O2, "28 = 5; 29 = 4; 30 = 3; 31 = 2; 32 = 1")
data$O3Recode <- car::recode(data$O3, "28 = 5; 29 = 4; 30 = 3; 31 = 2; 32 = 1")
data$O4Recode <- car::recode(data$O4, "28 = 5; 29 = 4; 30 = 3; 31 = 2; 32 = 1")
data$O5Recode <- car::recode(data$O5, "32 = 5; 31 = 4; 30 = 3; 29 = 2; 28 = 1")
data$O6Recode <- car::recode(data$O6, "32 = 5; 31 = 4; 30 = 3; 29 = 2; 28 = 1")

data$IH <- (data$O1Recode + data$O2Recode + data$O3Recode + data$O4Recode + data$O5Recode)/5

```

## Create Condition Variable 

```{r}

data$Condition <- ifelse(is.na(data$random), as.numeric(data$condition), data$random)

data4$condition

data$ConditionBin <- ifelse(data$Condition < 2, data$Condition, NA)
xtabs(~is.na(data$ConditionBin))

t.test(partisanGapTrueBin ~ ConditionBin, data = data) %>% report()

```

## Moderation by Ideology

```{r}

lm <- glm(partisanGapBin ~ ConditionBin*isRepub, data = data)
summary(lm)

lm <- glm(truthDiscernBin ~ ConditionBin*isRepub, data = data)
summary(lm)

lm <- glm(IncongruentTrueBin ~ ConditionBin*isRepub, data = data)
summary(lm)

lm <- glm(TruthDiscernSharing ~ ConditionBin*isRepub, data = data)
summary(lm)

lm <- glm(truthDiscernBin ~ ConditionBin*CRSum, data = data)
summary(lm)

lm <- glm(truthDiscernBin ~ ConditionBin*PKSum, data = data)
summary(lm)

lm <- glm(truthDiscernBin ~ ConditionBin*IH, data = data)
summary(lm)

lm <- glm(truthDiscernBin ~ ConditionBin*Education, data = data)
summary(lm)

lm <- glm(truthDiscernBin ~ ConditionBin*outgrouphate, data = data)
summary(lm)

lm <- glm(TruthDiscernSharing ~ ConditionBin*DemRep_C, data = data)
summary(lm)

plotSlopes(lm, plotLegend = FALSE, plotx="IH", 
           modx="ConditionBin", ylim = c(0.5, 4))

plotSlopes(moderation, plotLegend = FALSE, plotx="Conservatism", 
           modx="Condition", modxVals="std.dev.", ylim = c(-0.1, 1), legendArgs = "none", gridArgs = "none", legendPct = FALSE, interval = "conf", plotPoints = FALSE, ylab = "Sharing Discernment") 

dataDem <- subset(data, data$isRepub == 0)
dataRepub <- subset(data, data$isRepub == 1)

t.test(truthDiscernBin ~ ConditionBin, data = dataRepub) %>% report()
t.test(partisanGapBin ~ ConditionBin, data = dataRepub) %>% report()
t.test(IncongruentTrueBin ~ ConditionBin, data = dataRepub) %>% report()
t.test(TruthDiscernSharing ~ ConditionBin, data = dataRepub) %>% report()

t.test(truthDiscernBin ~ ConditionBin, data = dataDem) %>% report()
t.test(partisanGapBin ~ ConditionBin, data = dataDem) %>% report()
t.test(IncongruentTrueBin ~ ConditionBin, data = dataDem) %>% report()
t.test(TruthDiscernSharing ~ ConditionBin, data = dataDem) %>% report()

t.test(partisanGapBin ~ ConditionBin, data = dataDem) %>% report()
t.test(partisanGapTrueBin ~ ConditionBin, data = data) %>% report()
t.test(TruthDiscernSharing ~ ConditionBin, data = data) %>% report()


```

## Calculations for Integrative Data Analysis 
```{r}

dataDem <- subset(data, data$isRepub == 0)
dataRepub <- subset(data, data$isRepub == 1)

xtabs(~is.na(dataRepub$ConditionBin))

#Effects for all
t.test(truthDiscernBin ~ ConditionBin, data = data) %>% report()
t.test(partisanGapBin ~ ConditionBin, data = data) %>% report()
t.test(IncongruentTrueBin ~ ConditionBin, data = data) %>% report()

#Effects for Repubs 
t.test(truthDiscernBin ~ ConditionBin, data = dataRepub) %>% report()
t.test(partisanGapBin ~ ConditionBin, data = dataRepub) %>% report()
t.test(IncongruentTrueBin ~ ConditionBin, data = dataRepub) %>% report()

#Effects for Dems
t.test(truthDiscernBin ~ ConditionBin, data = dataDem) %>% report()
t.test(partisanGapBin ~ ConditionBin, data = dataDem) %>% report()
t.test(IncongruentTrueBin ~ ConditionBin, data = dataDem) %>% report()

group.CI(truthDiscernBin ~ ConditionBin, dataRepub, ci = 0.95)
group.CI(partisanGapBin ~ ConditionBin, dataDem, ci = 0.95)

# Accuracy 

t.test(subset(dataRepub$AccuracyScore, dataRepub$ConditionBin == 0), subset(dataDem$AccuracyScore, dataDem$ConditionBin == 1)) %>% report()

t.test(subset(dataRepub$AccuracyScore, dataRepub$ConditionBin == 1), subset(dataDem$AccuracyScore, dataDem$ConditionBin == 1))%>% report()

# Bias 

t.test(subset(dataRepub$partisanGapBin, dataRepub$ConditionBin == 1), subset(dataDem$partisanGapBin, dataDem$ConditionBin == 1))%>% report()

t.test(subset(dataRepub$partisanGapBin, dataRepub$ConditionBin == 0), subset(dataDem$partisanGapBin, dataDem$ConditionBin == 1))%>% report()

# Incongruent True 

t.test(subset(dataRepub$IncongruentTrueBin, dataRepub$ConditionBin == 1), subset(dataDem$IncongruentTrueBin, dataDem$ConditionBin == 1))%>% report()

t.test(subset(dataRepub$IncongruentTrueBin, dataRepub$ConditionBin == 0), subset(dataDem$IncongruentTrueBin, dataDem$ConditionBin == 1))%>% report()

#Sharing 

t.test(subset(dataRepub$TruthDiscernSharing, dataRepub$ConditionBin == 1), subset(dataDem$TruthDiscernSharing, dataDem$ConditionBin == 1))%>% report()

t.test(subset(dataRepub$TruthDiscernSharing, dataRepub$ConditionBin == 0), subset(dataDem$TruthDiscernSharing, dataDem$ConditionBin == 1))%>% report()

t.test(AccuracyScore ~ isRepub, data = data) %>% report()

t.test(partisanGapBin ~ ConditionBin, data = dataRepub) %>% report()

```

## Regression Models
```{r}

data$conditionRecode <- car::recode(data$ConditionBin, "1 = 0; 0 = 1")
data$GenderRecode <- ifelse(data$Gender > 2, NA, data$Gender)

lm <- glm(partisanGapBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum + outgrouphate + Education + Age + Income + GenderRecode, data = data)
summ(lm, confint = TRUE, center = TRUE, vifs = TRUE, scale = TRUE)

library(relaimpo)

relative = calc.relimp(glm(IncongruentTrueBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum+ outgrouphate + Education + Age + Income + GenderRecode, data = data), type = "lmg")

```

## Correlation Plots

```{r}

count(data$KnowlinglyShareFalse)
count(data$AnswerNotReflect)
count(data$Answerliking)
count(data$InfluencedByIncentiv)
count(data$InfluencedbyTask)
count(data$KnowlinglyShareFalse)
count(data$KnowlinglyShareFalse)

data2$Answerliking

```

## Reaction Time

```{r}

data$ReactionTimeDT1 <- data$`Q227_Page Submit`
data$ReactionTimeDT2 <- data$`Q228_Page Submit`
data$ReactionTimeDT3 <- data$`Q229_Page Submit`
data$ReactionTimeDT4 <- data$`Q231_Page Submit`

data$DemTrueReactionTime <- (data$ReactionTimeDT1 + data$ReactionTimeDT2 + data$ReactionTimeDT3 + data$ReactionTimeDT4) / 4

mean(data$DemTrueReactionTime)

data$ReactionTimeRT1 <- data$`Q230_Page Submit`
data$ReactionTimeRT2 <- data$`Q233_Page Submit`
data$ReactionTimeRT3 <- data$`Q234_Page Submit`
data$ReactionTimeRT4 <- data$`Q235_Page Submit`

data$RepubTrueReactionTime <- (data$ReactionTimeRT1 + data$ReactionTimeRT2 + data$ReactionTimeRT3 + data$ReactionTimeRT4) / 4

mean(data$RepubTrueReactionTime)

data$ReactionTimeDF1 <- data$`Q236_Page Submit`
data$ReactionTimeDF2 <- data$`Q237_Page Submit`
data$ReactionTimeDF3 <- data$`Q238_Page Submit`
data$ReactionTimeDF4 <- data$`Q239_Page Submit`

data$DemFalseReactionTime <- (data$ReactionTimeDF1 + data$ReactionTimeDF2 + data$ReactionTimeDF3 + data$ReactionTimeDF4) / 4

mean(data$DemFalseReactionTime)

data$ReactionTimeRF1 <- data$`Q240_Page Submit`
data$ReactionTimeRF2 <- data$`Q242_Page Submit`
data$ReactionTimeRF3 <- data$`Q244_Page Submit`
data$ReactionTimeRF4 <- data$`Q245_Page Submit`

data$RepubFalseReactionTime <- (data$ReactionTimeRF1 + data$ReactionTimeRF2 + data$ReactionTimeRF3 + data$ReactionTimeRF4) / 4

```


## Political Congruence REACTIONTIME

```{r}

data$CongruentTrueReaction <- ifelse(data$isRepub == 1, data$RepubTrueReactionTime, data$DemTrueReactionTime)
data$IncongruentTrueReaction <- ifelse(data$isRepub == 1, data$DemTrueReactionTime, data$RepubTrueReactionTime)
data$CongruentFalseReaction <- ifelse(data$isRepub == 1, data$RepubFalseReactionTime, data$DemFalseReactionTime)
data$IncongruentFalseReaction <- ifelse(data$isRepub == 1, data$DemFalseReactionTime, data$RepubFalseReactionTime)
data

t.test(CongruentTrueReaction ~ ConditionBin, data = data)  %>% report()
t.test(IncongruentTrueReaction ~ ConditionBin, data = data)  %>% report()
t.test(CongruentFalseReaction ~ ConditionBin, data = data)  %>% report()
t.test(IncongruentFalseReaction ~ ConditionBin, data = data)  %>% report()

data$TotalMeanReactionTime <- (data$CongruentTrueReaction + data$IncongruentTrueReaction + data$CongruentFalseReaction + data$IncongruentFalseReaction)/4

View(data$TotalMeanReactionTime)

t.test(TotalMeanReactionTime ~ ConditionBin, data = data) %>% report()
group.CI(data$TotalMeanReactionTime ~ data$ConditionBin, data, ci = 0.95)
group.CI(data$TruthDiscernSharing ~ data$ConditionBin, data, ci = 0.95)

```

## Reaction Time ANOVA 

```{r}

anova <- data %>%
  gather(key = "PoliticalCongruence", value = "PerceivedAccuracy", CongruentTrueReaction, IncongruentTrueReaction, CongruentFalseReaction, IncongruentFalseReaction) %>%
  convert_as_factor(PoliticalCongruence, Condition)

anova$Veracity <- ifelse(anova$PoliticalCongruence == "CongruentTrueReaction" | anova$PoliticalCongruence == "IncongruentTrueReaction", "True", "False")

anova$PoliticalCongruence <- ifelse(anova$PoliticalCongruence == "CongruentTrueReaction" | anova$PoliticalCongruence == "CongruentFalseReaction", "Politically Congruent", "Politically Incongruent")

anova$Condition <- ifelse(anova$Condition == 0, "Incentive", "No Incentive")

anova$Veracity <- factor(anova$Veracity, levels = c("True", "False"))

anovagroup <- anova %>%
  dplyr::select(ResponseId, PoliticalCongruence, Condition, Veracity, PerceivedAccuracy) %>% 
  dplyr::group_by(PoliticalCongruence, Condition, Veracity) %>%
  get_summary_stats(type = "mean_ci") 

res.aov <- anova_test(data = anova, 
                      dv = PerceivedAccuracy,
                      between = Condition, 
                      wid = ResponseId,
                      within = c(PoliticalCongruence, Veracity))

group.CI(anova$PerceivedAccuracy ~ anova$Veracity, data, ci = 0.95)
data %>% cohens_d(FalseReaction ~ Condition)
data %>% cohens_d(CongruentTrueReaction ~ Condition)
data %>% cohens_d(IncongruentFalseReaction ~ Condition)
data %>% cohens_d(CongruentFalseReaction ~ Condition)

pwc <- anova %>% tukey_hsd(PerceivedAccuracy ~ Condition*Veracity*PoliticalCongruence)
View(pwc)

plot

options(scipen=999)


```

### Reaction Time Plot

```{r}

BrokenUpGraphR <- ggplot(anova, aes(ConditionBin, PerceivedAccuracy, fill = Veracity)) + 
  stat_summary(fun = mean, geom = "bar", position = "dodge", width = 0.7) + 
  stat_summary(fun.data = mean_cl_normal,  position = position_dodge(0.7), width = 0.3, geom = "errorbar") + 
  facet_wrap(~PoliticalCongruence) + 
  scale_fill_manual("Veracity",values = c("#3AA6D0", "#FFB600")) + 
  ylab("Reaction Time") +
  xlab("") + 
  theme_apa() +
  theme(legend.position = "none")
BrokenUpGraphR
#ggsave("BrokenUpGraph.png", width = 8, height = 4)

```

### Plot Regression

```{r}

lm <- lm(truthDiscernBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum + outgrouphate + Education + Age + Income + GenderRecode, data = data)
truthsumm <- summ(lm, confint = TRUE, center = TRUE, scale = TRUE, transform.response = TRUE, vifs = TRUE)

lm <- lm(partisanGapBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum + outgrouphate + Education + Age + Income + GenderRecode, data = data)
partisansumm <- summ(lm, confint = TRUE, center = TRUE, scale = TRUE, transform.response = TRUE, vifs = TRUE)

lm <- lm(IncongruentTrueBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum + outgrouphate + Education + Age + Income + GenderRecode, data = data)
incongruentsumm <- summ(lm, confint = TRUE, center = TRUE, scale = TRUE, transform.response = TRUE, vifs = TRUE)

lm <- lm(TruthDiscernSharing ~ conditionRecode + PoliticalOrientation + CRSum + PKSum + outgrouphate + Education + Age + Income + GenderRecode, data = data)
truthdiscernsharingsumm <- summ(lm, confint = TRUE, center = TRUE, scale = TRUE, transform.response = TRUE, vifs = TRUE)

truthplot <- tidy(truthsumm) %>% mutate(model = "Truth Discernment") %>% filter(term != "Education", term != "Age", term != "Income", term != "GenderRecode")
partisanplot <- tidy(partisansumm) %>% mutate(model = "Partisan Bias") %>% filter(term != "Education", term != "Age", term != "Income", term != "GenderRecode")
incongruentplot <- tidy(incongruentsumm) %>% mutate(model = "Incongruent True News") %>% filter(term != "Education", term != "Age", term != "Income", term != "GenderRecode")
sharingdiscernplot <- tidy(truthdiscernsharingsumm) %>% mutate(model = "Truth Discern Sharing") %>% filter(term != "Education", term != "Age", term != "Income", term != "GenderRecode")

models <- rbind(truthplot, partisanplot, incongruentplot, sharingdiscernplot)

truthplotdw <- dwplot(truthplot, show_intercept = FALSE, dot_args = list(size = 2)) %>%
  relabel_predictors(c(conditionRecode = "Accuracy Incentive", PoliticalOrientation = "Political Conservatism", CRSum = "Cognitive Reflection", PKSum = "Political Knowledge", outgrouphate = "Affective Polarization")) +
    geom_vline(xintercept = 0, colour = "grey60", linetype = 2) + 
    scale_colour_hue(h = c(260, 0)) + 
    theme_apa(legend.pos = "bottom") + 
    xlab("Standardized Coefficient") +
    xlim(-0.6, 0.6) +
    ggtitle("Truth Discernment") + 
    theme(legend.position = "none")

partisanplotdw <- dwplot(partisanplot, show_intercept = FALSE, dot_args = list(size = 2)) %>%
  relabel_predictors(c(conditionRecode = "Accuracy Incentive", PoliticalOrientation = "Political Conservatism", CRSum = "Cognitive Reflection", PKSum = "Political Knowledge", outgrouphate = "Affective Polarization")) +
    geom_vline(xintercept = 0, colour = "grey60", linetype = 2) + 
    scale_colour_hue(h = c(260, 0)) + 
    theme_apa(legend.pos = "bottom") + 
    xlab("Standardized Coefficient") +
    xlim(-0.6, 0.6) +
    ggtitle("Partisan Bias") + 
    theme(legend.position = "none")

incongruentplotdw <- dwplot(incongruentplot, show_intercept = FALSE, dot_args = list(size = 2)) %>%
  relabel_predictors(c(conditionRecode = "Accuracy Incentive", PoliticalOrientation = "Political Conservatism", CRSum = "Cognitive Reflection", PKSum = "Political Knowledge", outgrouphate = "Affective Polarization")) +
    geom_vline(xintercept = 0, colour = "grey60", linetype = 2) + 
    scale_colour_hue(h = c(260, 0)) + 
    theme_apa(legend.pos = "bottom") + 
    xlab("Standardized Coefficient") +
    xlim(-0.6, 0.6) +
    ggtitle("Incongruent True News") + 
    theme(legend.position = "none")

sharingdiscernplotdw <- dwplot(sharingdiscernplot, show_intercept = FALSE, dot_args = list(size = 2)) %>%
  relabel_predictors(c(conditionRecode = "Accuracy Incentive", PoliticalOrientation = "Political Conservatism", CRSum = "Cognitive Reflection", PKSum = "Political Knowledge", outgrouphate = "Affective Polarization")) +
    geom_vline(xintercept = 0, colour = "grey60", linetype = 2) + 
    scale_colour_hue(h = c(260, 0)) + 
    theme_apa(legend.pos = "bottom") + 
    xlab("Standardized Coefficient") +
    xlim(-0.6, 0.6) +
    ggtitle("Sharing Discernment") + 
    theme(legend.position = "none")

relative = calc.relimp(glm(truthDiscernBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum+ outgrouphate + Education + Age + Income + GenderRecode, data = data), type = "lmg")

bootresults<-boot.relimp(glm(truthDiscernBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum+ outgrouphate + Education + Age + Income + GenderRecode, data = data), b=1000) 
ci <- booteval.relimp(bootresults, norank = T)

relativetruthplot <- NULL
relativetruthplot$term <- ci$namen[2:10]
relativetruthplot$estimate <- ci$lmg*100
relativetruthplot$conf.low <-  ci$lmg.lower[,1:9]*100
relativetruthplot$conf.high <- ci$lmg.upper[,1:9]*100
relativetruthplot <- data.frame(relativetruthplot)
#relativetruthplot <- relativetruthplot[1:5, ]

bootresults<-boot.relimp(glm(partisanGapBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum+ outgrouphate + Education + Age + Income + GenderRecode, data = data), b=1000) 
ci <- booteval.relimp(bootresults, norank = T)

relativebiasplot <- NULL
relativebiasplot$term <- ci$namen[2:10]
relativebiasplot$estimate <- ci$lmg*100
relativebiasplot$conf.low <-  ci$lmg.lower[,1:9]*100
relativebiasplot$conf.high <- ci$lmg.upper[,1:9]*100
relativebiasplot <- data.frame(relativebiasplot)
#relativebiasplot <- relativebiasplot[1:5, ]

relative = calc.relimp(glm(IncongruentTrueBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum+ outgrouphate + Education + Age + Income + GenderRecode, data = data), type = "lmg")

bootresults<-boot.relimp(glm(IncongruentTrueBin ~ conditionRecode + PoliticalOrientation + CRSum + PKSum+ outgrouphate + Education + Age + Income + GenderRecode, data = data), b=1000) 
ci <- booteval.relimp(bootresults, norank = T)
View(ci)

relativeincongruentplot <- NULL
relativeincongruentplot$term <- ci$namen[2:10]
relativeincongruentplot$estimate <- ci$lmg*100
relativeincongruentplot$conf.low <-  ci$lmg.lower[,1:9]*100
relativeincongruentplot$conf.high <- ci$lmg.upper[,1:9]*100
relativeincongruentplot <- data.frame(relativeincongruentplot)
#relativeincongruentplot <- relativeincongruentplot[1:5, ]

relative = calc.relimp(glm(TruthDiscernSharing ~ conditionRecode + PoliticalOrientation + CRSum + PKSum+ outgrouphate + Education + Age + Income + GenderRecode, data = data), type = "lmg")

bootresults<-boot.relimp(glm(TruthDiscernSharing ~ conditionRecode + PoliticalOrientation + CRSum + PKSum+ outgrouphate + Education + Age + Income + GenderRecode, data = data), b=1000) 
ci <- booteval.relimp(bootresults, norank = T)

sharingplot <- NULL
sharingplot$term <- ci$namen[2:10]
sharingplot$estimate <- ci$lmg*100
sharingplot$conf.low <-  ci$lmg.lower[,1:9]*100
sharingplot$conf.high <- ci$lmg.upper[,1:9]*100
sharingplot <- data.frame(sharingplot)
relativesharingplot <- data.frame(sharingplot)
#relativesharingplot <- relativesharingplot[1:5, ]

relativetruthplotdw <- dwplot(relativetruthplot, show_intercept = FALSE, dot_args = list(size = 1.5)) %>%
  relabel_predictors(c(conditionRecode = "Accuracy Incentive", PoliticalOrientation = "Political Conservatism", CRSum = "Cognitive Reflection", PKSum = "Political Knowledge", outgrouphate = "Affective Polarization", Education = "Education", Age = "Age", Income = "Income", GenderRecode = "Female")) +
    geom_vline(xintercept = 0, colour = "grey60", linetype = 2) + 
    scale_colour_hue(h = c(0, 260)) + 
    theme_apa(legend.pos = "bottom") + 
    xlim(0, 13) + 
    xlab("Variable Importance (%)") +
    ggtitle("Truth Discernment") + 
    theme(legend.position = "none")

relativepartisanplotdw <- dwplot(relativebiasplot, show_intercept = FALSE, dot_args = list(size = 1.5)) %>%
  relabel_predictors(c(conditionRecode = "Accuracy Incentive", PoliticalOrientation = "Political Conservatism", CRSum = "Cognitive Reflection", PKSum = "Political Knowledge", outgrouphate = "Affective Polarization", Education = "Education", Age = "Age", Income = "Income", GenderRecode = "Female")) +
    geom_vline(xintercept = 0, colour = "grey60", linetype = 2) + 
    scale_colour_hue(h = c(0, 260)) + 
    theme_apa(legend.pos = "bottom") + 
    xlim(0, 13) + 
    xlab("Variable Importance (%)") +
    ggtitle("Partisan Bias") + 
    theme(legend.position = "none")

relativeincongruentplotdw <- dwplot(relativeincongruentplot, show_intercept = FALSE, dot_args = list(size = 1.5)) %>%
  relabel_predictors(c(conditionRecode = "Accuracy Incentive", PoliticalOrientation = "Political Conservatism", CRSum = "Cognitive Reflection", PKSum = "Political Knowledge", outgrouphate = "Affective Polarization", Education = "Education", Age = "Age", Income = "Income", GenderRecode = "Female")) +
    geom_vline(xintercept = 0, colour = "grey60", linetype = 2) + 
    scale_colour_hue(h = c(0, 260)) + 
    theme_apa(legend.pos = "bottom") + 
    xlim(0, 13) + 
    xlab("Variable Importance (%)") +
    ggtitle("Incongruent True News") + 
    theme(legend.position = "none")

relativesharingplotdw <- dwplot(relativesharingplot, show_intercept = FALSE, dot_args = list(size = 1.5)) %>%
  relabel_predictors(c(conditionRecode = "Accuracy Incentive", PoliticalOrientation = "Political Conservatism", CRSum = "Cognitive Reflection", PKSum = "Political Knowledge", outgrouphate = "Affective Polarization", Education = "Education", Age = "Age", Income = "Income", GenderRecode = "Female")) +
    geom_vline(xintercept = 0, colour = "grey60", linetype = 2) + 
    scale_colour_hue(h = c(0, 260)) + 
    theme_apa(legend.pos = "bottom") + 
    xlim(0, 13) + 
    xlab("Variable Importance (%)") +
    ggtitle("Sharing Discernment") + 
    theme(legend.position = "none")

combinedRegressions            <- plot_grid(truthplotdw,
                                 partisanplotdw,
                                 incongruentplotdw, 
                                 sharingdiscernplotdw,
                                 nrow = 4)

combinedLmg            <- plot_grid(relativetruthplotdw,
                                 relativepartisanplotdw,
                                 relativeincongruentplotdw,
                                 relativesharingplotdw,
                                 nrow = 4)

combined <- plot_grid(combinedRegressions,
                      combinedLmg, 
                      ncol = 2, 
                      labels = c('A', 'B'))

ggsave("CombinedRegressions.png", width = 9, height = 8)

truthsumm
partisansumm
incongruentsumm

export_summs(truthsumm, 
             partisansumm,
             incongruentsumm, 
             truthdiscernsharingsumm,
             error_format = "[{conf.low}, {conf.high}]",
             modelnames = c("Truth Discernment", "Partisan Bias", "Incongruent True News"), 
             to.file = "html", 
             file.name = "RegressionModels.html")

export_summs(relativetruthplot, 
             relativebiasplot,
             relativeincongruentplot, 
             relativesharingplot,
             error_format = "[{conf.low}, {conf.high}]",
             modelnames = c("Truth Discernment", "Partisan Bias", "Incongruent True News"), 
             to.file = "html", 
             file.name = "RelativeImportance.html")

```

#### Item By Item Analysis ####

```{r}

t1 <- t.test(DT1Bin ~ ConditionBin, data = data) %>% report_table()
t2 <- t.test(DT2Bin ~ ConditionBin, data = data) %>% report_table()
t3 <- t.test(DT3Bin ~ ConditionBin, data = data) %>% report_table()
t4 <- t.test(DT4Bin ~ ConditionBin, data = data) %>% report_table()
t5 <- t.test(DF1Bin ~ ConditionBin, data = data) %>% report_table()
t6 <- t.test(DF2Bin ~ ConditionBin, data = data) %>% report_table()
t7 <- t.test(DF3Bin ~ ConditionBin, data = data) %>% report_table()
t8 <- t.test(DF4Bin ~ ConditionBin, data = data) %>% report_table()
t9 <- t.test(RT1Bin ~ ConditionBin, data = data) %>% report_table()
t10 <- t.test(RT2Bin ~ ConditionBin, data = data) %>% report_table()
t11 <- t.test(RT3Bin ~ ConditionBin, data = data) %>% report_table()
t12 <- t.test(RT4Bin ~ ConditionBin, data = data) %>% report_table()
t13 <- t.test(RF1Bin ~ ConditionBin, data = data) %>% report_table()
t14 <- t.test(RF2Bin ~ ConditionBin, data = data) %>% report_table()
t15 <- t.test(RF3Bin ~ ConditionBin, data = data) %>% report_table()
t16 <- t.test(RF4Bin ~ ConditionBin, data = data) %>% report_table()

options(scipen = 999)

tTests <- rbind(t1, t2, t3, t4, t5, t6, t7, t8, t9, t10, t11, t12, t13, t14, t15, t16)

View(tTests)
```

##Partisan Differences Graph

```{r}

data$ConditionFactor <- factor(data$ConditionBin, levels = c(1, 0), labels = c("Control", "Accuracy"))
data$PartisanShip <- factor(data$isRepub, levels = c(1, 0), labels = c("Conservative", "Liberal"))

PartisanDodge <- ggplot(subset(data, !is.na(data$ConditionFactor)), aes(ConditionFactor, partisanGapBin)) + 
  stat_summary(fun = mean, geom = "bar", 
                 fill = "#EBCC2A",
                 width = 0.6) +
       stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3,vjust=+3) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 4.0)) +
  scale_fill_manual(values=colors) + 
  facet_wrap(~PartisanShip ) + 
  geom_signif(comparisons = list(c("Accuracy", "Control")), 
              map_signif_level=TRUE) + 
  theme_apa() +
  xlab("Partisan Bias") + 
  ylab(" ") 
PartisanDodge

TruthDiscernDodge <- ggplot(subset(data, !is.na(data$ConditionFactor)), aes(ConditionFactor, truthDiscernBin)) + 
  stat_summary(fun = mean, geom = "bar", 
                 fill = "#78B7C5",
                 width = 0.6) +
         stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3,vjust=+3.2) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 4.0)) +
  scale_fill_manual(values=colors) + 
  facet_wrap(~PartisanShip ) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  xlab("Truth Discernment") + 
  ylab(" ") 
TruthDiscernDodge

IncongruentTrueDodge <- ggplot(subset(data, !is.na(data$ConditionFactor)), aes(ConditionFactor, IncongruentTrueBin)) + 
  stat_summary(fun = mean, geom = "bar", 
                 fill = "#3B9AB2",
                 width = 0.6) +
         stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3,vjust=+3.2) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3)) +
  scale_fill_manual(values=colors) + 
  facet_wrap(~PartisanShip ) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  xlab("Incongruent True") + 
  ylab(" ") 
IncongruentTrueDodge

SharingDiscernDodge <- ggplot(subset(data, !is.na(data$ConditionFactor)), aes(ConditionFactor, TruthDiscernSharing)) + 
  stat_summary(fun = mean, geom = "bar", 
                 fill = "#E1AF00",
                 width = 0.6) +
         stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3,vjust=+4.8) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 0.5)) +
  scale_fill_manual(values=colors) + 
  facet_wrap(~PartisanShip ) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  xlab("Sharing Discernment") + 
  ylab(" ") 
SharingDiscernDodge

combinedPlots  <- plot_grid(TruthDiscernDodge,
                            PartisanDodge,
                            IncongruentTrueDodge,
                            SharingDiscernDodge,
                            ncol = 2,
                            labels = c("A", "B", "C", "D"))

ggsave("combinedPlots.png", width = 8, height = 6)

```

#### Continously Coded Variables

```{r}

data$TrueBinCont <-     (data$AccuracyDT1 +
                      data$AccuracyDT2 + 
                      data$AccuracyDT3 +
                      data$AccuracyDT4 +
                      data$AccuracyRT1 +
                      data$AccuracyRT2 + 
                      data$AccuracyRT3 +
                      data$AccuracyRT4) / 8

data$FalseBinCont <-    (data$AccuracyDF1 +
                      data$AccuracyDF2 + 
                      data$AccuracyDF3 +
                      data$AccuracyDF4 +
                      data$AccuracyDT1 +
                      data$AccuracyDT2 + 
                      data$AccuracyDT3 +
                      data$AccuracyDT4) / 8

data$truthDiscernBinCont <- data$TrueBinCont - data$FalseBinCont

data$DemCont <- (data$AccuracyDT1 +
                      data$AccuracyDT2 + 
                      data$AccuracyDT3 +
                      data$AccuracyDT4 + 
                      data$AccuracyDF1 +
                      data$AccuracyDF2 + 
                      data$AccuracyDF3 +
                      data$AccuracyDF4) / 8
  
data$RepubCont <- (data$AccuracyRT1 +
                      data$AccuracyRT2 + 
                      data$AccuracyRT3 +
                      data$AccuracyRT4 +
                      data$RF1Bin +
                      data$RF2Bin + 
                      data$RF3Bin +
                      data$RF4Bin) / 8

data$DemTrueCont <- (data$AccuracyDT1 +
                      data$AccuracyDT2 + 
                      data$AccuracyDT3 +
                      data$AccuracyDT4) / 4

data$RepubTrueCont <- (data$AccuracyRT1 +
                      data$AccuracyRT2 + 
                      data$AccuracyRT3 +
                      data$AccuracyRT4) / 4

data$CongruentCont <- ifelse(data$isRepub == 1, data$RepubCont, data$DemCont)
data$IncongruentCont <- ifelse(data$isRepub == 1, data$DemCont, data$RepubCont)
data$IncongruentTrueCont <- ifelse(data$isRepub == 1, data$RepubTrueCont, data$DemTrueCont)
data$PartisanBiasCont <- data$CongruentCont - data$IncongruentCont

View(t.test(truthDiscernBinCont ~ ConditionBin, data = data) %>% report_table())
View(t.test(IncongruentTrueCont ~ ConditionBin, data = data) %>% report_table())
View(t.test(PartisanBiasCont ~ ConditionBin, data = data) %>% report_table())

t2 <- t.test(partisanGapCont ~ ConditionBin, data = data) %>% report_table()
t3 <- t.test(IncongruentTrueCont ~ ConditionBin, data = data) %>% report_table()

t4 <- t.test(truthDiscernBin ~ ConditionBin, data = dataDem) %>% report_table()
t5 <- t.test(partisanGapCont ~ ConditionBin, data = dataDem) %>% report_table()
t6 <- t.test(IncongruentTrueCont ~ ConditionBin, data = dataDem) %>% report_table()

data$FalseBin

t7 <- t.test(truthDiscernBin ~ ConditionBin, data = dataRepub) %>% report_table()
t8 <- t.test(partisanGapCont ~ ConditionBin, data = dataRepub) %>% report_table()
t9 <- t.test(IncongruentTrueCont ~ ConditionBin, data = dataRepub) %>% report_table()

table <- rbind(t1, t2, t3)
View(table)

data$partisanGapTrueBin <- data$CongruentTrueBin - data$IncongruentTrueBin
data$partisanGapFalseBin <- data$CongruentFalseBin - data$IncongruentFalseBin

corr.test(data$TruthDiscernSharing, data$truthDiscernBin)

hist((subset(data$IncongruentTrueCont, data$ConditionBin == 1)))
hist((subset(data$IncongruentTrueCont, data$ConditionBin == 0)))

```

# Seperate Study Graphs
```{r}

study1 <- subset(data, data$study == 1) #446
study2 <- subset(data, data$study == 2) #998
study3 <- subset(data, data$study == 3) #921
study4 <- subset(data, data$study == 4) #983

t.test(truthDiscernBin ~ ConditionBin, data = study4)
t.test(truthDiscernBin ~ ConditionBin, data = study3)
t.test(truthDiscernBin ~ ConditionBin, data = study2)
t.test(truthDiscernBin ~ ConditionBin, data = study1)

t.test(TruthDiscernSharing ~ ConditionBin, data = data)
data$TruthDiscernSharing

# Plot 1

study1$ConditionFactor <- factor(study1$Condition, levels = c(1, 0), labels = c("Control","Accuracy"))

TruthDiscernPlot1 <- ggplot(subset(study1, !is.na(study1$truthDiscernBin)), aes(ConditionFactor, truthDiscernBin)) +
  stat_summary(fun = mean, geom = "bar", 
                 fill = "#78B7C5",
                 width = 0.5) +
      stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3.2,vjust=+4) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.7)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  ggtitle("Study 1") +
  xlab("Truth Discernment") + 
  ylab("") 
TruthDiscernPlot1

#Plot 2 

study2$ConditionFactor <- factor(study2$Condition, levels = c(1, 0, 2, 3), labels = c("Control", "Accuracy", "Partisan", "Mixed"))

TruthDiscernPlot2 <- ggplot(study2, aes(ConditionFactor, truthDiscernBin)) + 
  stat_summary(fun = mean, geom = "bar",
                 fill = "#78B7C5",
                 width = 0.6) +
      stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3.2,vjust=+4) + 
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  geom_signif(comparisons=list(c("Control", "Accuracy")),map_signif_level=TRUE) +
  coord_cartesian(ylim = c(0, 4)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  ggtitle("Study 2") +
  xlab("Truth Discernment") + 
  ylab("")
TruthDiscernPlot2

#Plot 3 

study3$ConditionFactor <- factor(study3$Condition, levels = c(1, 0, 3, 2), labels = c("Control (S)", "Accuracy (S)", "Control (N)", "Accuracy (N)"))

TruthDiscernPlot3 <- ggplot(study3, aes(ConditionFactor, truthDiscernBin)) + 
  stat_summary(fun = mean, geom = "bar",
                 fill = "#78B7C5",
                 width = 0.6) +
      stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3.2,vjust=+4) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.5)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  ggtitle("Study 3") +
  xlab("Truth Discernment") +
  ylab("")
TruthDiscernPlot3

#Plot 4

study4$ConditionFactor <- factor(study4$Condition, levels = c(1, 0, 2), labels = c("Control","Accuracy", "Accuracy (Non-Financial)"))

TruthDiscernPlot4 <- ggplot(study4, aes(ConditionFactor, truthDiscernBin)) + 
  stat_summary(fun = mean, geom = "bar",
                 fill = "#78B7C5",
                 width = 0.5) +
      stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3.2,vjust=+4) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.5)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  ggtitle("Study 4") +
  xlab("Truth Discernment") + 
  ylab("")
TruthDiscernPlot4

# Partisan Plot 1 

study1$ConditionFactor <- factor(study1$Condition, levels = c(1, 0), labels = c("Control","Accuracy"))

partisanPlot1 <- ggplot(subset(study1, !is.na(study1$partisanGapBin)), aes(ConditionFactor, partisanGapBin)) +
  stat_summary(fun = mean, geom = "bar", 
                 fill = "#EBCC2A",
                 width = 0.5) +
    stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3.2,vjust=+4) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.7)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  ggtitle(" ") +
  xlab("Partisan Bias") + 
  ylab("") 

partisanPlot1

# Partisan Plot 2

study2$ConditionFactor <- factor(study2$Condition, levels = c(1, 0, 2, 3), labels = c("Control", "Accuracy", "Partisan", "Mixed"))

partisanPlot2 <- ggplot(study2, aes(ConditionFactor, partisanGapBin)) + 
  stat_summary(fun = mean, geom = "bar",
                 fill = "#EBCC2A",
                 width = 0.6) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3.2,vjust=+4) +
  coord_cartesian(ylim = c(0, 3.5)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  ggtitle(" ") +
  xlab("Partisan Bias") + 
  ylab("")
partisanPlot2

# Partisan Plot 3

study3$ConditionFactor <- factor(study3$Condition, levels = c(1, 0, 3, 2), labels = c("Control (S)", "Accuracy (S)", "Control (N)", "Accuracy (N)"))

partisanPlot3 <- ggplot(study3, aes(ConditionFactor, partisanGapBin)) + 
  stat_summary(fun = mean, geom = "bar",
                 fill = "#EBCC2A",
                 width = 0.6) +
      stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3.2,vjust=+4) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.5)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  ggtitle(" ") +
  xlab("Partisan Bias") +
  ylab("")
partisanPlot3

# Partisan Plot 4 

study4$ConditionFactor <- factor(study4$Condition, levels = c(1, 0, 2), labels = c("Control","Accuracy", "Accuracy (Non-Financial)"))

partisanPlot4 <- ggplot(study4, aes(ConditionFactor, partisanGapBin)) + 
  stat_summary(fun = mean, geom = "bar",
                 fill = "#EBCC2A",
                 width = 0.5) +
      stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               size=3.2,vjust=+4) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.5)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  ggtitle(" ") +
  xlab("Partisan Bias") + 
  ylab("")
partisanPlot4

# Combine plot
combined <- plot_grid(TruthDiscernPlot1,
                      partisanPlot1, 
                      TruthDiscernPlot2, 
                      partisanPlot2,
                      TruthDiscernPlot3, 
                      partisanPlot3,
                      TruthDiscernPlot4,
                      partisanPlot4,
                      scale = 1,
                      ncol = 2)

ggsave("truthDiscernCombined.png", width = 7.8, height = 10)

###### Violin plots

# Truth discernment plots 

TruthDiscernPlot1 <- ggbetweenstats(
  data=study1,
  x = ConditionFactor,
  y = truthDiscernBin,
  bf.message=TRUE,
  results.subtitle=FALSE,
  outlier.coef=10,
  pairwise.display="none",
  pairwise.comparisons=FALSE,
  xlab="Truth Discernment", ylab="",
  title = "Study 1",
  ggtheme=jtools::theme_apa(),
  package="wesanderson",
  palette="FantasticFox1"
) + ggplot2::scale_y_continuous(
  breaks = seq(from = -6, to = 10, by = 1))

TruthDiscernPlot1 

TruthDiscernPlot2 <- ggbetweenstats(
  data=study2,
  x = ConditionFactor,
  y = truthDiscernBin,
  bf.message=TRUE,
  results.subtitle=FALSE,
  outlier.coef=10,
  pairwise.display="none",
  pairwise.comparisons=FALSE,
  xlab="Truth Discernment", ylab="",
  title = "Study 2",
  ggtheme=jtools::theme_apa(),
  package="wesanderson",
  palette="FantasticFox1"
) + ggplot2::scale_y_continuous(
  breaks = seq(from = -6, to = 10, by = 1))

TruthDiscernPlot2

TruthDiscernPlot3 <- ggbetweenstats(
  data=study3,
  x = ConditionFactor,
  y = truthDiscernBin,
  bf.message=TRUE,
  results.subtitle=FALSE,
  outlier.coef=10,
  pairwise.display="none",
  pairwise.comparisons=FALSE,
  xlab="Truth Discernment", ylab="",
  title = "Study 3",
  ggtheme=jtools::theme_apa(),
  package="wesanderson",
  palette="FantasticFox1"
) + ggplot2::scale_y_continuous(
  breaks = seq(from = -6, to = 10, by = 1))

TruthDiscernPlot3

TruthDiscernPlot4 <- ggbetweenstats(
  data=study4,
  x = ConditionFactor,
  y = truthDiscernBin,
  bf.message=TRUE,
  results.subtitle=FALSE,
  outlier.coef=10,
  pairwise.display="none",
  pairwise.comparisons=FALSE,
  xlab="Truth Discernment", ylab="",
  title = "Study 4",
  ggtheme=jtools::theme_apa(),
  package="wesanderson",
  palette="FantasticFox1"
) + ggplot2::scale_y_continuous(
  breaks = seq(from = -6, to = 10, by = 1))

TruthDiscernPlot4

# Partisanship plots
partisanPlot1 <- ggbetweenstats(
  data=study1,
  x = ConditionFactor,
  y = partisanGapBin,
  bf.message=TRUE,
  results.subtitle=FALSE,
  outlier.coef=10,
  pairwise.display="none",
  pairwise.comparisons=FALSE,
  xlab="Partian Bias", ylab="",
  title = " ",
  ggtheme=jtools::theme_apa(),
  package="wesanderson",
  palette="Zissou1"
) + ggplot2::scale_y_continuous(
  breaks = seq(from = -6, to = 10, by = 1))

partisanPlot1

partisanPlot2 <- ggbetweenstats(
  data=study2,
  x = ConditionFactor,
  y = partisanGapBin,
  bf.message=TRUE,
  results.subtitle=FALSE,
  outlier.coef=10,
  pairwise.display="none",
  pairwise.comparisons=FALSE,
  xlab="Partian Bias", ylab="",
  title = " ",
  ggtheme=jtools::theme_apa(),
  package="wesanderson",
  palette="Zissou1"
) + ggplot2::scale_y_continuous(
  breaks = seq(from = -6, to = 10, by = 1))

partisanPlot2

partisanPlot3 <- ggbetweenstats(
  data=study3,
  x = ConditionFactor,
  y = partisanGapBin,
  bf.message=TRUE,
  results.subtitle=FALSE,
  outlier.coef=10,
  pairwise.display="none",
  pairwise.comparisons=FALSE,
  xlab="Partian Bias", ylab="",
  title = " ",
  ggtheme=jtools::theme_apa(),
  package="wesanderson",
  palette="Zissou1"
) + ggplot2::scale_y_continuous(
  breaks = seq(from = -6, to = 10, by = 1))

partisanPlot3

partisanPlot4 <- ggbetweenstats(
  data=study4,
  x = ConditionFactor,
  y = partisanGapBin,
  bf.message=TRUE,
  results.subtitle=FALSE,
  outlier.coef=10,
  pairwise.display="none",
  pairwise.comparisons=FALSE,
  xlab="Partian Bias", ylab="",
  title = " ",
  ggtheme=jtools::theme_apa(),
  package="wesanderson",
  palette="Zissou1"
) + ggplot2::scale_y_continuous(
  breaks = seq(from = -6, to = 10, by = 1))

partisanPlot4

# Combine plot
combined <- plot_grid(TruthDiscernPlot1,
                      partisanPlot1, 
                      TruthDiscernPlot2, 
                      partisanPlot2,
                      TruthDiscernPlot3, 
                      partisanPlot3,
                      TruthDiscernPlot4,
                      partisanPlot4,
                      scale = 1,
                      ncol = 2)

ggsave("truthDiscernCombined - violin plots.png", width = 7.8, height = 10)


```

## 2X2X2 ANOVA
```{r}

data$CongruentTruePercent <- (data$CongruentTrueBin / 4)*100 
data$IncongruentTruePercent <- (data$IncongruentTrueBin / 4)*100 
data$CongruentFalsePercent <- (data$CongruentFalseBin / 4)*100 
data$IncongruentFalsePercent <- (data$IncongruentFalseBin / 4)*100 
data$CongruentPercent <- (data$CongruentBin / 8)*100
data$IncongruentPercent <- (data$IncongruentBin / 8)*100
data$TruePercent <- (data$TrueBin / 8)*100
data$FalsePercent <- (data$FalseBin / 8)*100

library(rstatix)

anova <- data %>%
  gather(key = "PoliticalCongruence", value = "PerceivedAccuracy", CongruentTruePercent, IncongruentTruePercent, CongruentFalsePercent, IncongruentFalsePercent) %>%
  convert_as_factor(PoliticalCongruence, Condition)

anova$Veracity <- ifelse(anova$PoliticalCongruence == "CongruentTruePercent" | anova$PoliticalCongruence == "IncongruentTruePercent", "True", "False")

anova$PoliticalCongruence <- ifelse(anova$PoliticalCongruence == "CongruentTruePercent" | anova$PoliticalCongruence == "CongruentFalsePercent", "Politically Congruent", "Politically Incongruent")

anova$Condition <- factor(anova$Condition, levels = c(0, 1), labels = c("Accuracy","Control"))

anova$Veracity <- factor(anova$Veracity, levels = c("True", "False"))

anovagroup <- anova %>%
  dplyr::select(ResponseId, PoliticalCongruence, Condition, Veracity, PerceivedAccuracy) %>% 
  dplyr::group_by(PoliticalCongruence, Condition, Veracity) %>%
  get_summary_stats(type = "mean_ci") 

res.aov <- anova_test(data = anova, 
                      dv = PerceivedAccuracy,
                      between = Condition, 
                      wid = ResponseId,
                      within = c(PoliticalCongruence, Veracity))
View(res.aov)

posthoc <- anova %>% 
  tukey_hsd(PerceivedAccuracy ~ Condition*PoliticalCongruence*Veracity)

View(posthoc)

options(scipen=999)

anova$ConditionFactor <- factor(anova$ConditionBin, levels = c(1, 0), labels = c("Control", "Accuracy"))

BrokenUpGraph <- ggplot(subset(anova, !is.na(anova$ConditionBin)), aes(ConditionFactor, PerceivedAccuracy, fill = Veracity)) + 
  stat_summary(fun = mean, geom = "bar", position = "dodge", width = 0.7) + 
  stat_summary(fun.data = mean_cl_normal,  position = position_dodge(0.7), width = 0.3, geom = "errorbar") + 
        stat_summary(fun=mean, geom="text", aes(label=sprintf("%.2f", ..y..)),
               vjust=+3.3, size=3.2, position=position_dodge(width=0.7)) +
  coord_cartesian(ylim=c(0, 80)) +
  facet_wrap(~PoliticalCongruence) + 
  scale_fill_manual("Veracity",values = c("#78B7C5", "#E1AF00")) + 
  ylab("Percent Rated as Accurate") +
  xlab("") + 
  theme_apa() +
  theme(legend.position = "none")
BrokenUpGraph

leg <- get_legend(ggplot(anova, aes(ConditionFactor, PerceivedAccuracy, fill = Veracity)) + 
  stat_summary(fun = mean, geom = "bar", position = "dodge", width = 0.7) + 
  stat_summary(fun.data = mean_cl_normal,  position = position_dodge(0.7), width = 0.3, geom = "errorbar") + 
  facet_wrap(~PoliticalCongruence) + 
  scale_fill_manual("Veracity",values = c("#78B7C5", "#E1AF00")) + 
  ylab("Percent Rated as Accurate") +
  xlab("") + 
  theme_apa(legend.pos = "bottom", legend.font.size = 12))

plot_grid(BrokenUpGraph,
          nrow = 2,
          rel_heights = c(1, 0.3)) + draw_grob(leg, vjust = 0.3)

ggsave("BrokenUpGraph5.png", width = 8, height = 5)


plot_grid(BrokenUpGraph,
                            BrokenUpGraph,
                            nrow = 3,
                            rel_heights = c(1, 1.1, 0.3),
                            labels = c('', 'C')) + draw_grob(leg, vjust = 0.4)

group.CI(data$IncongruentTruePercent ~ data$ConditionBin, data, ci = 0.95)


```

## Bayes Factors 

```{r}

#install.packages("BayesFactor")
library(BayesFactor)

options(scipen=999)

lm <- lm(partisanGapBin ~ ConditionBin*isRepub, data = data)
summary(lm)
extractBF(lm)
data$ConditionBinFactor <- factor(data$ConditionBin)
data$isRepubFactor <- factor(data$isRepub)

bf <- ttestBF(formula = truthDiscernBin ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
1/bf

bf <- anovaBF(formula = partisanGapBin ~ ConditionBinFactor*isRepubFactor,
              data = subset(data, !is.na(data$ConditionBin)))
(bf[4] / bf[3])

bf <- generalTestBF(formula = IncongruentTrueBin ~ ConditionBin*isRepub, data = subset(data, !is.na(data$ConditionBin)))
bf[4] / bf[3]

bf <- generalTestBF(formula = truthDiscernBin ~ ConditionBin*isRepub, data = subset(data, !is.na(data$ConditionBin)))
bf[4] / bf[3]

bf <- generalTestBF(formula = partisanGapBin ~ ConditionBin*isRepub, data = subset(data, !is.na(data$ConditionBin)))
bf[4] / bf[3]

bf <- generalTestBF(formula = TruthDiscernSharing ~ ConditionBin*isRepub, data = subset(data, !is.na(data$ConditionBin)))
bf[4] / bf[3]

lm <- glm(truthDiscernBin ~ ConditionBin*isRepub, data = data)
summary(lm)

lm <- glm(IncongruentTrueBin ~ ConditionBin*isRepub, data = data)
summary(lm)

summary(fm1 <- lm(rating ~ ., data = attitude))

bf <- ttestBF(formula = IncongruentTrueBin ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
bf

bf <- ttestBF(formula = CongruentTrueBin ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
bf

bf <- ttestBF(formula = TrueBin ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
bf

bf <- ttestBF(formula = IncongruentFalseBin ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
bf

bf <- ttestBF(formula = CongruentFalseBin ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
bf

bf <- ttestBF(formula = TruthDiscernSharing ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
bf

bf <- ttestBF(formula = truthDiscernBin ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
bf

bf <- ttestBF(formula = partisanGapBin ~ ConditionBinFactor, data = subset(data, !is.na(data$ConditionBin)))
bf

?ttestBF()

t.test(TruthDiscernSharing ~ ConditionBin, data = data) %>% report()
t.test(IncongruentTrueBin ~ ConditionBinFactor, data = data) %>% report()
t.test(CongruentTrueBin ~ ConditionBinFactor, data = data) %>% report()
t.test(CongruentFalseBin ~ ConditionBinFactor, data = data) %>% report()
t.test(IncongruentFalseBin ~ ConditionBinFactor, data = data) %>% report()

t.test(truthDiscernBin ~ ConditionBinFactor, data = data) %>% report()

```

## Signal Detection Analysis

```{r}

xtabs(~data$ConditionBin)

# computing d' sensitivity index with log-linear rule correction 
# (Hautus, 1995)

data$real_accurate <- data$TrueBin + .5
data$real_inaccurate <- (8 - data$TrueBin) + .5
data$fake_accurate <- data$FalseBin + .5 
data$fake_inaccurate <- (8 - data$FalseBin) + .5

#compute hit rate and false alarm rate
data$hit_rate <- (data$real_accurate) / (data$real_inaccurate + data$real_accurate)
data$fa_rate <- (data$fake_accurate) / (data$fake_accurate + data$fake_inaccurate)

#compute d'
data$dprime <- qnorm(data$hit_rate) - qnorm(data$fa_rate)
max(data$dprime)

data$c <- -1*(qnorm(data$hit_rate) + qnorm(data$fa_rate)) / 2

t.test(dprime ~ ConditionBin, data = data) %>% report()
t.test(c ~ ConditionBin, data = data) %>% report()

#compute hit rate CONGRUENT 
data$real_accurate_C <- data$CongruentTrueBin + .5
data$real_inaccurate_C <- (4 - data$CongruentTrueBin) + .5
data$fake_accurate_C <- data$CongruentFalseBin + .5 
data$fake_inaccurate_C <- (4 - data$CongruentFalseBin) + .5

#compute hit rate and false alarm rate
data$hit_rate_C <- (data$real_accurate_C) / (data$real_inaccurate_C + data$real_accurate_C)
data$fa_rate_C <- (data$fake_accurate_C) / (data$fake_accurate_C + data$fake_inaccurate_C)

#compute d'
data$dprime_C <- qnorm(data$hit_rate_C) - qnorm(data$fa_rate_C)
max(data$dprime)

#compute c'
data$cprime_C <- -1*(qnorm(data$hit_rate_C) + qnorm(data$fa_rate_C)) / 2

t.test(dprime_C ~ ConditionBin, data = data) %>% report()
t.test(cprime_C ~ ConditionBin, data = data) %>% report()

#compute hit rate INCONGRUENT 
data$real_accurate_I <- data$IncongruentTrueBin + .5
data$real_inaccurate_I <- (4 - data$IncongruentTrueBin) + .5
data$fake_accurate_I <- data$IncongruentFalseBin + .5 
data$fake_inaccurate_I <- (4 - data$IncongruentFalseBin) + .5

#compute hit rate and false alarm rate
data$hit_rate_I <- (data$real_accurate_I) / (data$real_inaccurate_I + data$real_accurate_I)
data$fa_rate_I <- (data$fake_accurate_I) / (data$fake_accurate_I + data$fake_inaccurate_I)

#compute d'
data$dprime_I <- qnorm(data$hit_rate_I) - qnorm(data$fa_rate_I)
max(data$dprime)

#compute c'
data$cprime_I <- -1*(qnorm(data$hit_rate_I) + qnorm(data$fa_rate_I)) / 2

t.test(dprime_I ~ ConditionBin, data = data) %>% report()
t.test(cprime_I ~ ConditionBin, data = data) %>% report()

#DPrime ANOVA 
anova <- data %>%
  gather(key = "PoliticalCongruence", value = "DPrime", dprime_C, dprime_I) %>%
  convert_as_factor(PoliticalCongruence, ConditionBin)

anova$PoliticalCongruence <- ifelse(anova$PoliticalCongruence == "dprime_C", "Politically Congruent", "Politically Incongruent")

anova$Condition <- factor(anova$ConditionBin, levels = c(0, 1), labels = c("Accuracy","Control"))

anovagroup <- anova %>%
  dplyr::select(ResponseId, PoliticalCongruence, Condition, DPrime) %>% 
  dplyr::group_by(PoliticalCongruence, Condition) %>%
  get_summary_stats(type = "mean_ci") 

res.aov <- anova_test(data = anova, 
                      dv = DPrime,
                      between = Condition, 
                      wid = ResponseId,
                      within = PoliticalCongruence)

posthoc <- anova %>% 
  tukey_hsd(DPrime ~ Condition*PoliticalCongruence)
View(posthoc)

group.CI(DPrime ~ Condition*PoliticalCongruence, anova, ci = 0.95)

t.test(DPrime ~ Condition, data = anova) %>% report()
t.test(dprime_I ~ ConditionBin, data = data) %>% report()

#CPrime ANOVA 
anova <- data %>%
  gather(key = "PoliticalCongruence", value = "CPrime", cprime_C, cprime_I) %>%
  convert_as_factor(PoliticalCongruence, ConditionBin)

anova$PoliticalCongruence <- ifelse(anova$PoliticalCongruence == "cprime_C", "Politically Congruent", "Politically Incongruent")

anova$Condition <- factor(anova$ConditionBin, levels = c(0, 1), labels = c("Accuracy","Control"))

anovagroup <- anova %>%
  dplyr::select(ResponseId, PoliticalCongruence, Condition, CPrime) %>% 
  dplyr::group_by(PoliticalCongruence, Condition) %>%
  get_summary_stats(type = "mean_ci") 

res.aov <- anova_test(data = anova, 
                      dv = CPrime,
                      between = Condition, 
                      wid = ResponseId,
                      within = PoliticalCongruence)

posthoc <- anova %>% 
  tukey_hsd(CPrime ~ Condition*PoliticalCongruence)
View(posthoc)

t.test(cprime_I ~ ConditionBin, data = data) %>% report()

group.CI(dprime_I ~ ConditionBin, data = data)



```



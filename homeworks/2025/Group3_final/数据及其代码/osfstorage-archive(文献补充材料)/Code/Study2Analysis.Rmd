---
title: "Study2PilotAnalysis"
author: "Steve Rathje"
date: "1/20/2021"
output: html_document
---

## Set Working Directory
```{r setup, include=FALSE}
setwd("/Users/steverathje/Desktop/Financial\ Nudge\ fake\ News/Study\ 2\ Analysis")
knitr::opts_chunk$set(echo = TRUE)
```

## Install Packages
```{r cars, include = FALSE}
library(psych)
library(dplyr)
library(tidyverse)
library(jtools)
library(ggpubr)
library(rstatix)
library(tidyverse)
install.packages("Rmisc")
library(Rmisc)
library(jtools)
library(rockchalk)

if(!require(devtools)) install.packages("devtools")
devtools::install_github("kassambara/ggpubr")
```

## Read in file, exclusions, rename variables 
```{r}
data <- read_csv("Study2RawData.csv")

#get Prolific IDs of those who failed attention checks
FailedAttentionCheck <- ifelse(data$Q114 != 35, data$PROLIFIC_PID, NA)
count(FailedAttentionCheck)

count(data$Q114 != 35)
#FailedAttentionCheck

#Exclude those who failed the attention check and responded randomly (pre-registered exclusion criteria)
count(subset(data, data$Q114 == 35))
data <- subset(data, data$Q114 == 35)
count(subset(data, data$Random == 1))
data <- subset(data, data$Random == 2)

```

## Recode Important Variables 
```{r}

#Recode political oriention into binary (is Repub) variable
data$isRepub <- ifelse(data$DemRep_C > 3, 1, 0)

#Conservatism
data$PoliticalOrientation <- data$DemRep_C

#Vote
data$Vote <- ifelse(data$POTUS2016 == 1, 0, data$POTUS2016) 
data$Vote <- ifelse(data$Vote == 2, 1, data$Vote)
data$Vote <- ifelse(data$Vote > 1, NA, data$Vote)

#Recode Condition Variable (0 = Experimental, 1 = Control)
data$Condition <- as.factor(data$random)

#Split into Repub and Dem 
dataRepub <- subset(data, data$isRepub == 1)
dataDem <- subset(data, data$isRepub == 0)

#Outgroup hate variable
data$outgrouphate <- ifelse(data$isRepub == 1, (100 - data$FeelingDem_1), (100 - data$FeelingRepub_1))
data$ingrouplove <- ifelse(data$isRepub == 1, data$FeelingRepub_1, data$FeelingDem_1)
data$affectivepolarization <- data$ingrouplove + data$outgrouphate
data$strengthpartisanship <- recode(data$DemRep_C, "1 = 3; 2 = 2; 3 = 1; 4 = 1; 5 = 2; 6 = 3")

```

## Characteristics of sample
```{r}

#sample size
nrow(data)

#number of repubs (Repub = 1)
plyr::count(data$isRepub)

plyr::count(data$Condition)

#Political Orientation
plyr::count(data$DemRep_C)

#gender (1 = Male, 2 = Female, 4 = Trans Male, 5 = Trans/Non-Binary)
plyr::count(data$Gender)

data$isFemale <- ifelse(data$Gender == 2, 1, 0)

#race
plyr::count(data$Ethnicity)

#Mean Age
mean(data$Age, na.rm = TRUE)
SD(data$Age)

```

## Create Dichotomous Measures 
```{r}
#Binary Accuracy Scores
data$DT1Bin <- ifelse(data$AccuracyDT1 > 3, 1, 0)
data$DT2Bin <- ifelse(data$AccuracyDT2 > 3, 1, 0)
data$DT3Bin <- ifelse(data$AccuracyDT3 > 3, 1, 0)
data$DT4Bin <- ifelse(data$AccuracyDT4 > 3, 1, 0)
data$RT1Bin <- ifelse(data$AccuracyRT1 > 3, 1, 0)
data$RT2Bin <- ifelse(data$AccuracyRT2 > 3, 1, 0)
data$RT3Bin <- ifelse(data$AccuracyRT3 > 3, 1, 0)
data$RT4Bin <- ifelse(data$AccuracyRT4 > 3, 1, 0)
data$DF1Bin <- ifelse(data$AccuracyDF1 > 3, 1, 0)
data$DF2Bin <- ifelse(data$AccuracyDF2 > 3, 1, 0)
data$DF3Bin <- ifelse(data$AccuracyDF3 > 3, 1, 0)
data$DF4Bin <- ifelse(data$AccuracyDF4 > 3, 1, 0)
data$RF1Bin <- ifelse(data$AccuracyRF1 > 3, 1, 0)
data$RF2Bin <- ifelse(data$AccuracyRF2 > 3, 1, 0)
data$RF3Bin <- ifelse(data$AccuracyRF3 > 3, 1, 0)
data$RF4Bin <- ifelse(data$AccuracyRF4 > 3, 1, 0)

data$TrueBin <-     data$DT1Bin +
                      data$DT2Bin + 
                      data$DT3Bin +
                      data$DT4Bin +
                      data$RT1Bin +
                      data$RT2Bin + 
                      data$RT3Bin +
                      data$RT4Bin

data$FalseBin <-    data$DF1Bin +
                      data$DF2Bin + 
                      data$DF3Bin +
                      data$DF4Bin +
                      data$RF1Bin +
                      data$RF2Bin + 
                      data$RF3Bin +
                      data$RF4Bin

data$truthDiscernBin <- data$TrueBin - data$FalseBin

data$TrueDemBin <- data$DT1Bin +
                      data$DT2Bin + 
                      data$DT3Bin +
                      data$DT4Bin
  
data$TrueRepubBin <- data$RT1Bin +
                      data$RT2Bin + 
                      data$RT3Bin +
                      data$RT4Bin

data$FalseDemBin <- data$DF1Bin +
                      data$DF2Bin + 
                      data$DF3Bin +
                      data$DF4Bin 

data$FalseRepubBin <- data$RF1Bin +
                      data$RF2Bin + 
                      data$RF3Bin +
                      data$RF4Bin

data$DemBin <- data$TrueDemBin + data$FalseDemBin
data$RepubBin <- data$TrueRepubBin + data$FalseRepubBin
data$TrueBin <- data$TrueDemBin + data$TrueRepubBin

data$DemPercent <- (data$DemBin / 8)*100
data$RepubPercent <- (data$RepubBin / 8)*100

data$AccuracyScore <- data$TrueBin + (8 - data$FalseBin)

##FullBonus
fullbonus <- ifelse(data$AccuracyScore > 15 & (data$Condition == 0 | data$Condition == 3), data$PROLIFIC_PID, NA)

halfbonus <- ifelse(data$AccuracyScore > 13 & data$AccuracyScore < 16 & (data$Condition == 0 | data$Condition == 3), data$PROLIFIC_PID, NA)
  
data$PercentAccurate <- (data$AccuracyScore/16)*100

```

#Calculate Bonus Payments

```{r}
data$LikedDT1Bin <- ifelse(data$LikedDT1 > 3, 1, 0)
data$LikedDT2Bin <- ifelse(data$LikedDT2 > 3, 1, 0)
data$LikedDT3Bin <- ifelse(data$LikedDT3 > 3, 1, 0)
data$LikedDT4Bin <- ifelse(data$LikedDT4 > 3, 1, 0)

data$LikedRT1Bin <- ifelse(data$LikedRT1 > 3, 1, 0)
data$LikedRT2Bin <- ifelse(data$LikedRT2 > 3, 1, 0)
data$LikedRT3Bin <- ifelse(data$LikedRT3 > 3, 1, 0)
data$LikedRT4Bin <- ifelse(data$LikedRT4 > 3, 1, 0)

data$LikedDF1Bin <- ifelse(data$LikedDF1 > 3, 1, 0)
data$LikedDF2Bin <- ifelse(data$LikedDF2 > 3, 1, 0)
data$LikedDF3Bin <- ifelse(data$LikedDF3 > 3, 1, 0)
data$LikedDF4Bin <- ifelse(data$LikedDF4 > 3, 1, 0)

data$LikedRF1Bin <- ifelse(data$LikedRF1 > 3, 1, 0)
data$LikedRF2Bin <- ifelse(data$LikedRF2 > 3, 1, 0)
data$LikedRF3Bin <- ifelse(data$LikedRF3 > 3, 1, 0)
data$LikedRF4Bin <- ifelse(data$LikedRF4 > 3, 1, 0)

corr.test(data$LikedDT1, data$AccuracyDT1)
datamixed <- subset(data, data$Condition == 3)
corr.test(datamixed$LikedDT1, datamixed$AccuracyDT1)

corr.test(data$LikedDT2, data$AccuracyDT2)
corr.test(datamixed$LikedDT2, datamixed$LikedDT2)

corr.test(data$LikedDT3, data$AccuracyDT3)
corr.test(data$LikedDF1, data$AccuracyDF1)

data$LikedDem <- data$LikedDT1Bin + data$LikedDT2Bin + data$LikedDT3Bin + data$LikedDT3Bin + data$LikedDF1Bin + data$LikedDF2Bin + data$LikedDF3Bin + data$LikedDF4Bin

data$LikedRepub <- data$LikedRT1Bin + data$LikedRT2Bin + data$LikedRT3Bin + data$LikedRT4Bin + data$LikedRF1Bin + data$LikedRF2Bin + data$LikedRF3Bin + data$LikedRF4Bin

data$RewardLikedDem <- data$LikedDem + 8 - data$LikedRepub
data$RewardLikedRepub <- data$LikedRepub + 8 - data$LikedDem 
```

## Pre-Registered 1-Way and 2X2 ANOVA -- Truth Discernment
```{r}

#Get descriptive stats
data %>% 
  group_by(Condition) %>%
  get_summary_stats(truthDiscernBin, type = "mean_ci")

# 0 = accuracy, 1 = control, 2 = politics, 3 = mixed 

#Visualization
ggboxplot(data, x = "Condition", y = "truthDiscernBin")

#Identify Outliers
data %>% 
  group_by(Condition) %>%
  identify_outliers(truthDiscernBin)

# Analyze residuals by building a linear model
model  <- lm(truthDiscernBin  ~ Condition, data = data)

# Create a QQ plot of residuals
ggqqplot(residuals(model))
shapiro_test(residuals(model))

# Check normality by groups
data %>% 
  group_by(Condition) %>%
  shapiro_test(truthDiscernBin)

# Normality by groups plot 
ggqqplot(data, "truthDiscernBin", facet.by = "Condition")

# Homogeniety of Variance
plot(model, 1)

#data %>% levene_test(truthDiscernBin ~ Condition)

# If assumptions aren't met, do welch_anova_test()

# ANOVA test: 

res.aov <- data %>% anova_test(truthDiscernBin ~ Condition)
res.aov

# Pairwise comparisons
pwc <- data %>% tukey_hsd(truthDiscernBin ~ Condition)
pwc

View(pwc)

pwc2 <- data %>% tukey_hsd(truthDiscernBin ~ Condition)

group.CI(data$truthDiscernBin ~ Condition, data, ci = 0.95)
data %>% cohens_d(truthDiscernBin ~ Condition)

# 2 by 2 ANOVA

data$Social <- ifelse(data$Condition == 2 | data$Condition == 3, "Social", "No Social")
data$Social <- factor(data$Social)

data$Accuracy <- ifelse(data$Condition == 0 | data$Condition == 3, "Incentive", "No Incentive")
data$Accuracy <- factor(data$Accuracy)

data %>% anova_test(truthDiscernBin ~ Accuracy*Social)

pwc2 <- data %>% tukey_hsd(truthDiscernBin ~ Accuracy*Social)
View(pwc2)

data$partisa

group.CI(truthDiscernBin ~ Accuracy*Social, data, ci = 0.95)
data %>% cohens_d(truthDiscernBin ~ Condition)

```

# GGPlot - Truth Discernment

```{r}

data$ConditionFactor <- factor(data$Condition, levels = c(0, 1, 2, 3), labels = c("Accuracy","Control", "Social", "Mixed"))

TruthDiscernPlot <- ggplot(data, aes(ConditionFactor, truthDiscernBin)) + 
  stat_summary(fun = mean, geom = "bar",
                 fill = "#599ad3",
                 width = 0.6) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.7)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  xlab("") + 
  ylab("Truth Discernment") 
TruthDiscernPlot
```

## Political Congruence Variable (Dichotomous)

```{r}
data$CongruentBin <- ifelse(data$isRepub == 1, data$RepubBin, data$DemBin)
data$IncongruentBin <- ifelse(data$isRepub == 1, data$DemBin, data$RepubBin)

data$CongruentTrueBin <- ifelse(data$isRepub == 1, data$TrueRepubBin, data$TrueDemBin)
data$IncongruentTrueBin <- ifelse(data$isRepub == 1, data$TrueDemBin, data$TrueRepubBin)
data$CongruentFalseBin <- ifelse(data$isRepub == 1, data$FalseRepubBin, data$FalseDemBin)
data$IncongruentFalseBin <- ifelse(data$isRepub == 1, data$FalseDemBin, data$FalseRepubBin)

data$partisanGapBin <- data$CongruentBin - data$IncongruentBin
data$partisanGapTrueBin <- data$CongruentTrueBin - data$IncongruentTrueBin
data$partisanGapFalseBin <- data$CongruentFalseBin - data$IncongruentFalseBin
```

## 1-Way and 2X2 ANOVA -- Partisan Bias
```{r}

#Get descriptive stats
data %>% 
  group_by(Condition) %>%
  get_summary_stats(partisanGapBin, type = "mean_ci")

# 0 = accuracy, 1 = control, 2 = politics, 3 = mixed 

#Visualization
ggboxplot(data, x = "Condition", y = "partisanGapBin")

#Identify Outliers
data %>% 
  group_by(Condition) %>%
  identify_outliers(partisanGapBin)

# Analyze residuals by building a linear model
model  <- lm(partisanGapBin ~ Condition, data = data)

# Create a QQ plot of residuals
ggqqplot(residuals(model))
shapiro_test(residuals(model))

# Check normality by groups
data %>% 
  group_by(Condition) %>%
  shapiro_test(partisanGapBin)

# Normality by groups plot 
ggqqplot(data, "partisanGapBin", facet.by = "Condition")

# Homogeniety of Variance
plot(model, 1)

data %>% levene_test(partisanGapBin ~ Condition)

# If assumptions aren't met, do welch_anova_test()

# ANOVA test: 

res.aov <- data %>% anova_test(partisanGapBin ~ Condition)
res.aov

# Pairwise comparisons with corrections for multiple comparisons
pwc <- data %>% tukey_hsd(partisanGapBin ~ Condition)
pwc

group.CI(data$partisanGapTrueBin ~ Condition, data, ci = 0.95)
data %>% cohens_d(partisanGapBin ~ Condition)

# 2X2 ANOVA 
data %>% anova_test(partisanGapBin ~ Accuracy*Social)

pwc2 <- data %>% tukey_hsd(partisanGapBin ~ Accuracy*Social)
View(pwc2)

group.CI(partisanGapBin ~ Accuracy*Social, data, ci = 0.95)
data %>% cohens_d(truthDiscernBin ~ Condition)

```

## Create Combined Plots

```{r}
metagrid <- plot_grid(TruthDiscernPlot,
                      PartisanBiasPlot,
                      ncol = 2,
                      labels = c("A", "B"),
                      rel_widths = c(1, 1))
metagrid
ggsave("MainGraphStudy2.png", width = 8, height = 4)
```

# Truth Discern Sharing 
```{r}
data$TrueShare <- (data$ShareDT1 +
                       data$ShareDT2 + 
                       data$ShareDT2_1 + ##Correct this 
                       data$ShareDT4 +
                       data$ShareRT1 + 
                       data$ShareRT2 + 
                       data$ShareRT3 + 
                       data$ShareRT4 ) / 8

data$FalseShare <- (data$ShareDF1 + 
                       data$ShareDF2 + 
                       data$ShareDF3 + 
                       data$ShareDF4 + 
                       data$ShareRF1 +
                       data$ShareRF2 + 
                       data$ShareRF3 + 
                       data$ShareRF4) / 8

data$FalseShareFull <- (data$ShareDF1 + 
                       data$ShareDF2 + 
                       data$ShareDF3 + 
                       data$ShareDF4 + 
                       data$ShareRF1 +
                       data$ShareRF2 + 
                       data$ShareRF3 + 
                       data$ShareRF4) / 8

data$TruthDiscernSharing <- data$TrueShare - data$FalseShare 
data$TruthDiscernSharingFull <- data$TrueShare - data$FalseShare 

data$TrueDemShare <- (data$ShareDT1 +
                       data$ShareDT2 + 
                       data$ShareDT2_1 + 
                       data$ShareDT4) / 4

data$TrueRepubShare <- (data$ShareRT1 + 
                       data$ShareRT2 + 
                       data$ShareRT3 + 
                       data$ShareRT4) / 4

data$FalseDemShare <- (data$ShareDF1 + 
                       data$ShareDF2 + 
                       data$ShareDF3 + 
                       data$ShareDF4) / 4

data$FalseRepubShare <- (data$ShareRF1 +
                       data$ShareRF2 + 
                       data$ShareRF3 + 
                       data$ShareRF4) / 4

data$DemShare <- (data$TrueDemShare + data$FalseDemShare)/2
data$RepubShare <- (data$TrueRepubShare + data$FalseRepubShare)/2
```

## Political Congruence SHARING

```{r}
data$CongruentShare <- ifelse(data$isRepub == 1, data$RepubShare, data$DemShare)
data$IncongruentShare <- ifelse(data$isRepub == 1, data$DemShare, data$RepubShare)

data$CongruentTrueShare <- ifelse(data$isRepub == 1, data$TrueRepubShare, data$TrueDemShare)
data$IncongruentTrueShare <- ifelse(data$isRepub == 1, data$TrueDemShare, data$TrueRepubShare)
data$CongruentFalseShare <- ifelse(data$isRepub == 1, data$FalseRepubShare, data$FalseDemShare)
data$IncongruentFalseShare <- ifelse(data$isRepub == 1, data$FalseDemShare, data$FalseRepubShare)

data$partisanGapShare <- data$CongruentShare - data$IncongruentShare
data$partisanGapTrueShare <- data$CongruentTrueShare - data$IncongruentTrueShare
data$partisanGapFalseShare <- data$CongruentFalseShare - data$IncongruentFalseBin
```

#ANOVA Truth Discern Sharing
```{r}

res.aov <- data %>% anova_test(TruthDiscernSharing ~ Accuracy*Social)

aov(TruthDiscernSharing ~ Accuracy*Social, data = data) %>%
  report()

res.aov <- data %>% anova_test(TrueShare ~ Condition)
res.aov

res.aov <- data %>% anova_test(FalseShare ~ Condition)
res.aov

ggboxplot(data, x = "Condition", y = "TrueShare")

pwc <- data %>% tukey_hsd(FalseShare ~ Condition)
pwc

# Pairwise comparisons with corrections for multiple comparisons
pwc <- data %>% tukey_hsd(TruthDiscernSharing ~ Condition)
pwc

```

## 2X2X2X2 ANOVA
```{r}

cleanup = theme(panel.grid.major = element_blank(),
                panel.grid.minor = element_blank(), 
                panel.background = element_blank(),
                axis.line = element_line(color = "black"))

data$CongruentTruePercent <- (data$CongruentTrueBin / 4)*100 
data$IncongruentTruePercent <- (data$IncongruentTrueBin / 4)*100 
data$CongruentFalsePercent <- (data$CongruentFalseBin / 4)*100 
data$IncongruentFalsePercent <- (data$IncongruentFalseBin / 4)*100 

anova <- data %>%
  gather(key = "PoliticalCongruence", value = "PerceivedAccuracy", CongruentTruePercent, IncongruentTruePercent, CongruentFalsePercent, IncongruentFalsePercent) %>%
  convert_as_factor(PoliticalCongruence)

anova$Veracity <- ifelse(anova$PoliticalCongruence == "CongruentTruePercent" | anova$PoliticalCongruence == "IncongruentTruePercent", "True", "False")

anova$PoliticalCongruence <- ifelse(anova$PoliticalCongruence == "CongruentTruePercent" | anova$PoliticalCongruence == "CongruentFalsePercent", "Congruent", "Incongruent")

anova$Veracity <- factor(anova$Veracity, levels = c("True", "False"))

anovagroup <- anova %>%
  dplyr::select(ResponseId, PoliticalCongruence, Accuracy, Social, Veracity, PerceivedAccuracy) %>% 
  dplyr::group_by(PoliticalCongruence, Accuracy, Social, Veracity) %>%
  get_summary_stats(type = "mean_ci") 

View(anovagroup)

#Calculate Anova

options(scipen = )

res.aov <- anova_test(data = anova, 
                      dv = PerceivedAccuracy,
                      between = c(Accuracy, Social),
                      wid = ResponseId,
                      within = c(PoliticalCongruence, Veracity))
View(res.aov)

cohen.d(anova$PoliticalCongruence, anova$PerceivedAccuracy)

##Tukey Pairwise Comparisons
pwc <- anova %>% tukey_hsd(PerceivedAccuracy ~ PoliticalCongruence*Accuracy*Social*Veracity)

View(pwc)

group.CI(data$IncongruentTruePercent ~ data$ConditionFactor, data, ci = 0.95)
data %>% cohens_d(IncongruentTruePercent ~ ConditionFactor)
data %>% cohens_d(CongruentTruePercent ~ ConditionFactor)
data %>% cohens_d(IncongruentFalsePercent ~ ConditionFactor)
data %>% cohens_d(CongruentFalsePercent ~ ConditionFactor)

# ggboxplot(anova, x = "ConditionFactor", y = "PerceivedAccuracy", color = "Veracity", palette = "jco", facet.by = "PoliticalCongruence") 

```

## 2X2X2X2 ANOVA Sharing

```{r}
anova <- data %>%
  gather(key = "PoliticalCongruence", value = "LikelihoodSharing", CongruentTrueShare , IncongruentTrueShare, CongruentFalseShare, IncongruentFalseShare) %>%
  convert_as_factor(PoliticalCongruence)

anova$Veracity <- ifelse(anova$PoliticalCongruence == "CongruentTrueShare" | anova$PoliticalCongruence == "IncongruentTrueShare", "True", "False")

anova$PoliticalCongruence <- ifelse(anova$PoliticalCongruence == "CongruentTrueShare" | anova$PoliticalCongruence == "CongruentFalseShare", "Congruent", "Incongruent")

anova$Veracity <- factor(anova$Veracity, levels = c("True", "False"))

anovagroup <- anova %>%
  dplyr::select(ResponseId, PoliticalCongruence, Accuracy, Social, Veracity, LikelihoodSharing) %>% 
  dplyr::group_by(PoliticalCongruence, Accuracy, Social, Veracity) %>%
  get_summary_stats(type = "mean_ci") 

res.aov <- anova_test(data = anova, 
                      dv = LikelihoodSharing,
                      between = c(Accuracy, Social),
                      wid = ResponseId,
                      within = c(PoliticalCongruence, Veracity))
View(res.aov)

pwc <- anova%>% tukey_hsd(LikelihoodSharing ~ Accuracy*Social*Veracity*PoliticalCongruence)
View(pwc)

group.CI(anova$LikelihoodSharing ~ anova$ConditionFactor, anova, ci = 0.95)
data %>% cohens_d(CongruentShare ~ConditionFactor)

```

## Broken Up Sharing Graph

```{r}
BrokenUpSharingGraph <- ggplot(anova, aes(ConditionFactor, LikelihoodSharing, fill = Veracity)) + 
  stat_summary(fun = mean, geom = "bar", position = "dodge", width = 0.7) + 
  stat_summary(fun.data = mean_cl_normal,  position = position_dodge(0.7), width = 0.3, geom = "errorbar") + 
  coord_cartesian(ylim = c(1, 3)) +
  facet_wrap(~PoliticalCongruence) + 
  scale_fill_manual("Veracity",values = c("#599ad3", "#F8766D")) + 
  ylab("Likelihood of Sharing") +
  xlab("") + 
  theme_apa()
BrokenUpSharingGraph
ggsave("BrokenUpSharingGraph.png", width = 8, height = 4)
```

## Cognitive Reflection
```{r}
data$CR1Correct <- ifelse(data$CR1 == 4, 1, 0)
data$CR2Correct <- ifelse(data$CR2 == 10, 1, 0)
data$CR3Correct <- ifelse(data$CR3 == 39, 1, 0)

data$CRSum <- data$CR1Correct + data$CR2Correct + data$CR3Correct

```

## Political Knowledge
```{r}
data$PK1Correct <- ifelse(data$`PK1(3)` == 3, 1, 0) 
data$PK2Correct <- ifelse(data$`PK2(2)` == 2, 1, 0)
data$PK3Correct <- ifelse(data$`PK3(1)` == 1, 1, 0)
data$PK4Correct <- ifelse(data$`PK4(2)` == 2, 1, 0)
data$PK5Correct <- ifelse(data$`PK5(1)` == 1, 1, 0)

data$PKSum <- data$PK1Correct + data$PK2Correct + data$PK3Correct + data$PK4Correct + data$PK5Correct
```

## APA Correlation Tables
```{r}

corrdata <- cbind(data$truthDiscernBin, 
                  data$TruthDiscernSharing,
                  data$partisanGapBin, 
                  data$CRSum, 
                  data$PKSum,
                  data$outgrouphate, 
                  data$ingrouplove,
                  data$PoliticalOrientation,
                  data$Vote,
                  data$SM_Freq)
labels = c("Truth Discernment", "Sharing Discernment", "Partisan Gap", "Cognitive Reflection", "Political Knowledge", "Outgroup Hate", "Ingroup Love", "Political Conservatism", "Voted Trump", "Social Use") 
colnames(corrdata) = labels

corrdata2 <- cbind(
                  data$Age,
                  data$isFemale,
                  data$Education,
                  data$Income, 
                  data$SM_Freq)

#labels2 = ("Age", "Gender", "Education", "Income", "Social Media Use")

#APA Correlation Table
apa.cor.table(corrdata, filename="corrtable.doc", table.number=1)

#Create Correlation Matrix
M <- cor(corrdata, use = "pairwise.complete.obs", method = "pearson")

res1 <- cor.mtest(M, conf.level = 0.95, adjust = "none")

#mutal information 
#Create Correlation Plot
corrplot(M, p.mat = res1$p, method = "color", type = "upper", tl.srt = 45,
         sig.level = c(.001, .01, .05), pch.cex = .9, number.font = 0.25,  tl.col = "black", tl.cex = 0.6, 
         insig = "label_sig", pch.col = "white", order = "original")

```

## Continuous Scores

```{r}
data$True <- (data$AccuracyDT1 + 
                       data$AccuracyDT2 + 
                       data$AccuracyDT3 + 
                       data$AccuracyDT4 + 
                       data$AccuracyRT1 + #Typo here, fix in the survey
                       data$AccuracyRT2 + 
                       data$AccuracyRT3 + 
                       data$AccuracyRT4) / 8

data$False <- (data$AccuracyDF1 +
                     data$AccuracyDF2 + 
                     data$AccuracyDF3 + #AccuracyDF3 is share DF3, fix this
                     data$AccuracyDF4 +
                     data$AccuracyRF1 + 
                     data$AccuracyRF2 + 
                     data$AccuracyRF3 + 
                     data$AccuracyRF4) / 8

data$TruthDiscern <- data$True - data$False
```

## Moderation Analysis 
```{r}

lm <- glm(partisanGapShare ~ ConditionFactor*outgrouphate, data = data)
summary(lm)

lm <- glm(truthDiscernBin ~ Age, data = data)
summary(lm)

plotSlopes(lm, plotLegend = FALSE, plotx="Education", 
           modx="Condition")
```

## Condition Binary

```{r}

data$Condition <- as.numeric(data$Condition)
data$Condition <- data$Condition - 1 
data$ConditionBinary <- ifelse(data$Condition < 2, data$Condition, NA)

t.test(partisanGapBin ~ ConditionBinary, data = data)
cohen.d(data$partisanGapBin, data$ConditionBinary)

## Looking item by item 

t.test(DT1Bin ~ ConditionBinary, data = data)
t.test(DT2Bin ~ ConditionBinary, data = data)
t.test(DT3Bin ~ ConditionBinary, data = data)
t.test(DT4Bin ~ ConditionBinary, data = data)
t.test(RT1Bin ~ ConditionBinary, data = data)
t.test(RT2Bin ~ ConditionBinary, data = data)
t.test(RT3Bin ~ ConditionBinary, data = data)
t.test(RT4Bin ~ ConditionBinary, data = data)
t.test(DF1Bin ~ ConditionBinary, data = data)
t.test(DF2Bin ~ ConditionBinary, data = data)
t.test(DF3Bin ~ ConditionBinary, data = data)
t.test(DF4Bin ~ ConditionBinary, data = data)
t.test(RF1Bin ~ ConditionBinary, data = data)
t.test(RF2Bin ~ ConditionBinary, data = data)
t.test(RF3Bin ~ ConditionBinary, data = data)
t.test(RF4Bin ~ ConditionBinary, data = data)

t.test(partisanGapTrueBin ~ ConditionBinary, data = data)
t.test(partisanGapFalseBin ~ ConditionBinary, data = data)

t.test(partisanGapFalseBin ~ ConditionBinary, data = data)

```

## Correlation between "liked by party" ratings and perceived accuracy

```{r}
corr.test(data$LikedDT1, data$AccuracyDT1)
corr.test(data$LikedDT2, data$AccuracyDT2)
corr.test(data$LikedDT3, data$AccuracyDT3)
corr.test(data$LikedDF1, data$AccuracyDF1)
```

## Free Response
```{r}

count(data$KnowlinglyShareFalse)
count(data$AnswerNotReflect)
count(data$Answerliking)
count(data$InfluencedByIncentiv)
count(data$InfluencedbyTask)

```

```{r}
install.packages("remotes")
remotes::install_github("easystats/report")

library("report")
```

# GGPlot - Truth Discernment

```{r}

data$ConditionFactor <- factor(data$Condition, levels = c(0, 1, 2, 3), labels = c("Accuracy","Control", "Social", "Mixed"))

TruthDiscernPlot2 <- ggplot(data, aes(ConditionFactor, truthDiscernBin)) + 
  stat_summary(fun = mean, geom = "bar",
                 fill = "#00869A",
                 width = 0.6) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.5)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  xlab("") + 
  ylab("Truth Discernment")
TruthDiscernPlot2

```

## Partisan Bias PLOT 
```{r}

data$ConditionFactor <- factor(data$Condition, levels = c(0, 1, 2, 3), labels = c("Accuracy","Control", "Social", "Mixed"))

PartisanBiasPlot2 <- ggplot(data, aes(ConditionFactor, partisanGapBin)) + 
  stat_summary(fun = mean, geom = "bar", 
                 fill = "#C23C59",
                 width = 0.6) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  coord_cartesian(ylim = c(0, 3.5)) +
  scale_fill_manual(values=colors) + 
  ##geom_point(position=position_jitter(width =.15)) +
  theme_apa() +
  xlab("") + 
  ylab("Partisan Bias") 
PartisanBiasPlot2

```

## 4X2X2 PLOT

```{r}

anova$ConditionFactor <- factor(anova$Condition, levels = c(0, 1, 2, 3), labels = c("Accuracy","Control", "Social", "Mixed"))

BrokenUpGraph2 <- ggplot(anova, aes(ConditionFactor, PerceivedAccuracy, fill = Veracity)) + 
  stat_summary(fun = mean, geom = "bar", position = "dodge", width = 0.7) + 
  stat_summary(fun.data = mean_cl_normal,  position = position_dodge(0.7), width = 0.3, geom = "errorbar") + 
  facet_wrap(~PoliticalCongruence) + 
  scale_fill_manual("Veracity",values = c("#3AA6D0", "#FFB600")) + 
  ylab("Percent Rated as Accurate") +
  xlab("") + 
  theme_apa() +
  theme(legend.position = "none")
BrokenUpGraph2
#ggsave("BrokenUpGraph.png", width = 8, height = 4)

leg <- get_legend(ggplot(anova, aes(ConditionFactor, PerceivedAccuracy, fill = Veracity)) + 
  stat_summary(fun = mean, geom = "bar", position = "dodge", width = 0.7) + 
  stat_summary(fun.data = mean_cl_normal,  position = position_dodge(0.7), width = 0.3, geom = "errorbar") + 
  facet_wrap(~PoliticalCongruence) + 
  scale_fill_manual("Veracity",values = c("#3AA6D0", "#FFB600")) + 
  ylab("Percent Rated as Accurate") +
  xlab("") + 
  theme_apa(legend.pos = "bottom", legend.font.size = 12))


```

## Combine the graphs into one

```{r}

combinedPlotsStudy2UpperPanel <- plot_grid(TruthDiscernPlot2,
                            PartisanBiasPlot2,
                            labels = c("A", "B"))

#ggsave("combinedPlotsStudy1.png", width = 11, height = 5)

BrokenUpGraph3

#ggsave("BrokenUpGraph3.png", width = 12, height = 5)

combinedPlotsStudy2 <- plot_grid(combinedPlotsStudy2UpperPanel,
                            BrokenUpGraph2,
                            nrow = 3,
                            rel_heights = c(1, 1.1, 0.3),
                            labels = c('', 'C')) + draw_grob(leg, vjust = 0.4)
combinedPlotsStudy2

ggsave("CombinedStudy2.png", width = 11, height = 8)

#                            labels = c('', 'C')) + draw_grob(leg, vjust = 0.3, hjust = -0.6)

# combinedStudy3Plots <- plot_grid(TruthDiscernPlot1,
#                                   PartisanBiasPlot1, 
#                                   BrokenUpGraph1, 
#                                   ncol = 2,
#                                   nrow = 2,
#                                   rel_widths = c(1, 1, 2),
#                                   rel_heights = c(1, 1, 1.5),
#                                   labels = c("A", "B", "C"))
# combinedStudy3Plots
# 
# combinedStudy3Plots <- plot_grid(BrokenUpGraph1,
#                                   BrokenUpGraph2,
#                                   BrokenUpGraph3,
#                                   nrow = 3,
#                                   rel_heights = c(1, 1, 1),
#                                   labels = c("Study 1", "Study 2", "Study 3"))
# combinedStudy3Plots

ggsave("combinedStudy3Plots.png", width = 10, height = 12)

?ggsave()

```

